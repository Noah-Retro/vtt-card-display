{
  "version": 3,
  "sources": ["src/main.ts", "src/constants.ts", "src/search-apis.ts", "src/popout-html.ts"],
  "sourcesContent": ["/**\n * VTT Card Display - Obsidian Plugin\n * \n * Display game cards and project them to a second monitor for tabletop RPG sessions.\n * Cards are stored directly as image files (PNG, JPG, SVG, etc.) in a configurable folder.\n * \n * Features:\n * - Card/Map projection to popout window\n * - Image rotation with automatic centering\n * - Statblock rendering from notes\n * - Multi-monitor support\n * - Grid overlay and Fog of War\n * - Monster/Map image search\n */\nimport { Plugin, PluginSettingTab, Setting, SuggestModal, ItemView, Notice, MarkdownRenderer, Modal, requestUrl, arrayBufferToBase64, TFile } from 'obsidian';\n\n// Import from modules\nimport type { Settings, CardEntry, MapEntry, SearchResult, BattleMapResult } from './types';\nimport { DEFAULT_SETTINGS, IMAGE_EXTENSIONS, VIEW_TYPE_CARD } from './constants';\nimport { \n  searchLocalVault, \n  searchFandomWikis, \n  searchDndBeyond, \n  searchArtStation, \n  searchDeviantArt, \n  searchReddit,\n  searchRedditBattlemaps,\n  searchDeviantArtMaps,\n  deduplicateResults \n} from './search-apis';\nimport { buildPopoutHtml } from './popout-html';\n\n/** Main plugin class */\nexport default class VttCardDisplay extends Plugin {\n  settings!: Settings;\n  /** Loaded card entries (image files from Cards folder) */\n  cards: Array<{ src: string; path?: string }> = [];\n  /** Loaded map entries (images/notes from Maps folder) */\n  maps: Array<{ src?: string; path: string; title?: string }> = [];\n  current = 0;\n  popoutWindow: any = null; // Window or in-app proxy\n  inAppPopoutEl: HTMLElement | null = null;\n  inAppWindowProxy: any = null;\n  _lastPopoutBlobUrl: string | null = null;\n\n  async onload() {\n    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());\n    await this.loadCards();\n    await this.loadMaps();\n    this.addCommand({ id: 'vtt-open-popout', name: 'Open Cards Popout', callback: () => this.openPopout() });\n    this.addCommand({ id: 'vtt-close-popout', name: 'Close Popout', callback: () => this.closePopout() });\n\n    // Popout helpers\n    this.addCommand({ id: 'vtt-popout-save-position', name: 'Save popout position (from current popout)', callback: () => this.savePopoutPosition() });\n    this.addCommand({ id: 'vtt-popout-move-second-monitor', name: 'Move popout to second monitor (approx)', callback: () => this.movePopoutToSecondMonitor() });\n    this.addCommand({ id: 'vtt-open-card-viewer', name: 'Open Card Viewer Pane', callback: () => this.openViewerPane() });\n\n    // Add ribbon icon (left sidebar button)\n    this.addRibbonIcon('projector', 'VTT Card Viewer', () => {\n      this.openViewerPane();\n    });\n\n    // register settings UI\n    this.addSettingTab(new VttCardDisplaySettingTab(this.app, this));\n\n    // Message listener for popout\n    // Message listener for popout\n    window.addEventListener('message', (ev) => {\n      if (!ev.data || ev.data.plugin !== 'vtt-card-display') return;\n      if (ev.data.type === 'next') this.nextCard();\n      if (ev.data.type === 'prev') this.prevCard();\n      if (ev.data.type === 'requestCurrent') {\n        // If we recently opened the popout with suppression, ignore the first automatic request\n        if ((this as any)._suppressNextRequest) {\n          \n          (this as any)._suppressNextRequest = false;\n          return;\n        }\n        this.sendCurrentToPopout();\n      }\n    });\n\n    // Postprocessor replacement for [[project:ID]] buttons\n    // @ts-ignore registerMarkdownPostProcessor may exist in runtime\n    try {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      (this as any).registerMarkdownPostProcessor((el: HTMLElement, ctx: any) => {\n        try {\n          const regex = /\\[\\[project:([^\\]]+)\\]\\]/g;\n          el.querySelectorAll('div, p').forEach((node) => {\n            if (!node.innerHTML || !regex.test(node.innerHTML)) return;\n            node.innerHTML = node.innerHTML.replace(regex, (m, id) => {\n              const item = (this.settings.items || []).find(x => x.id === id);\n              const label = item ? item.title : `Project ${id}`;\n              return `<button class=\"vtt-project-btn\" data-id=\"${id}\">${label}</button>`;\n            });\n          });\n          el.querySelectorAll('.vtt-project-btn').forEach((btn: Element) => {\n            btn.addEventListener('click', (e: any) => {\n              const id = e.currentTarget.dataset.id;\n              this.projectItemById(id);\n            });\n          });\n        } catch (e) {\n          // eslint-disable-next-line no-console\n          \n        }\n      });\n    } catch (e) {\n      // ignore if postprocessor not available in environment\n    }\n\n    // Register code block handler for ```vtt-project``` blocks\n    // This allows embedding a \"Project this note\" button directly in notes\n    try {\n      this.registerMarkdownCodeBlockProcessor('vtt-project', (source, el, ctx) => {\n        const config = source.trim();\n        const lines = config.split('\\n').map(l => l.trim()).filter(l => l);\n        \n        // Parse options\n        let buttonText = '\uD83D\uDDA5\uFE0F Project to Screen';\n        let style = 'default'; // default, minimal, large\n        \n        for (const line of lines) {\n          if (line.startsWith('text:')) {\n            buttonText = line.substring(5).trim();\n          } else if (line.startsWith('style:')) {\n            style = line.substring(6).trim();\n          }\n        }\n        \n        // Create button container\n        const container = el.createDiv({ cls: 'vtt-project-block' });\n        \n        // Style the container\n        const containerStyles: Record<string, string> = {\n          default: 'display:flex;justify-content:center;padding:12px;',\n          minimal: 'display:inline-block;',\n          large: 'display:flex;justify-content:center;padding:20px;'\n        };\n        container.style.cssText = containerStyles[style] || containerStyles.default;\n        \n        // Create the button\n        const btn = container.createEl('button', { cls: 'vtt-project-note-btn' });\n        btn.textContent = buttonText;\n        \n        // Style the button based on style option\n        const buttonStyles: Record<string, string> = {\n          default: 'padding:10px 20px;font-size:14px;background:var(--interactive-accent);color:var(--text-on-accent);border:none;border-radius:8px;cursor:pointer;font-weight:500;transition:all 150ms ease;box-shadow:0 2px 8px rgba(0,0,0,0.2);',\n          minimal: 'padding:6px 12px;font-size:12px;background:var(--background-secondary);color:var(--text-normal);border:1px solid var(--background-modifier-border);border-radius:4px;cursor:pointer;',\n          large: 'padding:16px 32px;font-size:18px;background:linear-gradient(135deg,var(--interactive-accent),var(--interactive-accent-hover));color:var(--text-on-accent);border:none;border-radius:12px;cursor:pointer;font-weight:600;box-shadow:0 4px 16px rgba(0,0,0,0.3);'\n        };\n        btn.style.cssText = buttonStyles[style] || buttonStyles.default;\n        \n        // Hover effect\n        btn.addEventListener('mouseenter', () => {\n          btn.style.transform = 'translateY(-2px)';\n          btn.style.boxShadow = '0 4px 12px rgba(0,0,0,0.3)';\n        });\n        btn.addEventListener('mouseleave', () => {\n          btn.style.transform = 'translateY(0)';\n          btn.style.boxShadow = style === 'large' ? '0 4px 16px rgba(0,0,0,0.3)' : '0 2px 8px rgba(0,0,0,0.2)';\n        });\n        \n        // Click handler - project the current note\n        btn.addEventListener('click', async () => {\n          const filePath = ctx.sourcePath;\n          if (filePath) {\n            btn.textContent = '\u23F3 Loading...';\n            btn.style.opacity = '0.7';\n            await this.projectNoteByPath(filePath);\n            setTimeout(() => {\n              btn.textContent = buttonText;\n              btn.style.opacity = '1';\n            }, 500);\n          } else {\n            new Notice('Could not determine note path');\n          }\n        });\n      });\n    } catch (e) {\n      \n    }\n\n    // Commands for projection\n    this.addCommand({ id: 'vtt-project-current-statblock', name: 'Project current file (rendered)', callback: () => this.projectCurrentFileAsRendered() });\n    this.addCommand({ id: 'vtt-project-current-image', name: 'Project first image in current note', callback: () => this.projectFirstImageInCurrentFile() });\n    \n    // Monster image search command\n    this.addCommand({ \n      id: 'vtt-search-monster-image', \n      name: 'Search D&D Monster Image...', \n      callback: () => this.openMonsterImageSearch() \n    });\n    \n    // Battle map search command\n    this.addCommand({ \n      id: 'vtt-search-battle-map', \n      name: 'Search Battle Map...', \n      callback: () => this.openBattleMapSearch() \n    });\n\n    // Register commands per item\n    this._registerItemCommands();\n\n    // interval to detect closed popout\n    this.registerInterval(window.setInterval(() => {\n      if (this.popoutWindow && this.popoutWindow.closed) this.popoutWindow = null;\n    }, 2000));\n\n    // Auto-delete video thumbnails when video files are deleted\n    this.registerEvent(this.app.vault.on('delete', async (file) => {\n      if (file instanceof TFile && IMAGE_EXTENSIONS.includes(file.extension.toLowerCase())) {\n        // Check if it's a video file\n        const videoExtensions = ['mp4', 'webm', 'ogg', 'mov'];\n        if (videoExtensions.includes(file.extension.toLowerCase())) {\n          // Delete corresponding thumbnail\n          const safeName = file.path.replace(/[\\/\\\\:*?\"<>|]/g, '_');\n          const thumbnailPath = `_vtt_thumbnails/thumb_${safeName}.jpg`;\n          const thumbnailFile = this.app.vault.getAbstractFileByPath(thumbnailPath);\n          if (thumbnailFile instanceof TFile) {\n            try {\n              await this.app.vault.delete(thumbnailFile);\n              console.log('Deleted thumbnail:', thumbnailPath);\n            } catch (e) {\n              console.error('Failed to delete thumbnail:', e);\n            }\n          }\n        }\n      }\n    }));\n\n    // register view type\n    try { this.registerView('vtt-card-view', (leaf: any) => new CardView(leaf, this)); } catch (e) {}\n  }\n\n  private _registeredItemCommands = new Set<string>();\n\n  onunload() {\n    if (this.popoutWindow && !this.popoutWindow.closed && typeof this.popoutWindow.close === 'function') this.popoutWindow.close();\n    try { this.app.workspace.detachLeavesOfType('vtt-card-view'); } catch (e) {}\n    this.closeInAppPopout();\n  }\n\n  createInAppPopout() {\n    if (this.inAppPopoutEl) return;\n    const el = document.createElement('div');\n    el.className = 'vtt-inapp-popout';\n    el.style.position = 'fixed'; el.style.left = '0'; el.style.top = '0'; el.style.width = '100%'; el.style.height = '100%'; el.style.zIndex = '99999'; el.style.background = '#0b0b0b'; el.style.color = '#fff';\n    el.style.display = 'flex'; el.style.flexDirection = 'column';\n\n    const header = document.createElement('div');\n    header.style.padding = '8px'; header.style.display = 'flex'; header.style.justifyContent = 'space-between'; header.style.gap = '8px'; header.style.background = '#00000088';\n    const title = document.createElement('div'); title.textContent = 'VTT Cards'; title.style.fontWeight = 'bold';\n    const controls = document.createElement('div');\n    const prevBtn = document.createElement('button'); prevBtn.textContent = '\u25C0 Prev'; prevBtn.style.marginRight = '6px'; prevBtn.addEventListener('click', () => this.prevCard());\n    const nextBtn = document.createElement('button'); nextBtn.textContent = 'Next \u25B6'; nextBtn.style.marginRight = '6px'; nextBtn.addEventListener('click', () => this.nextCard());\n    const closeBtn = document.createElement('button'); closeBtn.textContent = 'Close'; closeBtn.addEventListener('click', () => this.closeInAppPopout());\n    controls.appendChild(prevBtn); controls.appendChild(nextBtn); controls.appendChild(closeBtn);\n    header.appendChild(title); header.appendChild(controls);\n\n    const content = document.createElement('div'); content.style.flex = '1'; content.style.overflow = 'auto'; content.style.display = 'flex'; content.style.justifyContent = 'center'; content.style.alignItems = 'center'; content.style.padding = '12px';\n    const img = document.createElement('img'); img.id = 'vtt-inapp-img'; img.style.maxWidth = '100%'; img.style.maxHeight = '100%'; img.style.display = 'block';\n    // make content positioning relative so overlay controls can be positioned\n    (content as HTMLElement).style.position = 'relative';\n    content.appendChild(img);\n\n    // In-app rotate button: create/ensure it exists when needed. This avoids it being removed\n    // when we set content.innerHTML during showHTML.\n    let _inapp_rot = 0;\n    const applyInappRotation = () => {\n      try {\n        const imgEl = content.querySelector('img');\n        const vidEl = content.querySelector('video');\n        const el = imgEl && (imgEl as HTMLImageElement).style.display !== 'none' ? imgEl : (vidEl && (vidEl as HTMLVideoElement).style.display !== 'none' ? vidEl : null);\n          if (el) {\n            const h = (el as HTMLElement) as any;\n            h.style.transformOrigin = 'center center';\n            h.style.transform = `rotate(${_inapp_rot}deg)`;\n            // Resize to preserve natural aspect ratio based on rotation and container size\n            try {\n              const container = content as HTMLElement;\n              // Use getBoundingClientRect for accurate rendered size\n              const rect = container.getBoundingClientRect();\n              const cw = rect.width;\n              const ch = rect.height;\n              const natW = (h.naturalWidth || (h as HTMLVideoElement).videoWidth) || 0;\n              const natH = (h.naturalHeight || (h as HTMLVideoElement).videoHeight) || 0;\n              const isRotated = (_inapp_rot % 180) !== 0;\n              if (natW && natH) {\n                let scale: number;\n                // Always use contain so image fits fully without clipping\n                if (!isRotated) scale = Math.min(cw / natW, ch / natH);\n                else scale = Math.min(cw / natH, ch / natW); // contain when rotated\n                // Apply explicit pixel sizing and disable max constraints; center via margin\n                try { } catch(e){}\n                h.style.width = Math.round(natW * scale) + 'px';\n                h.style.height = Math.round(natH * scale) + 'px';\n                h.style.maxWidth = 'none'; h.style.maxHeight = 'none';\n                h.style.margin = 'auto';\n                try { const pf = (h as HTMLElement).closest && (h as HTMLElement).closest('.img-frame'); if (pf && (pf as HTMLElement).style) { (pf as HTMLElement).style.display = 'flex'; (pf as HTMLElement).style.alignItems = 'center'; (pf as HTMLElement).style.justifyContent = 'center'; (pf as HTMLElement).style.height = '100%'; (pf as HTMLElement).style.width = '100%'; (pf as HTMLElement).style.overflow = 'hidden'; } } catch(e){}\n              } else {\n                // fallback\n                if (isRotated) { h.style.height = '100%'; h.style.width = 'auto'; h.style.maxWidth = 'none'; h.style.maxHeight = '100%'; }\n                else { h.style.width = '100%'; h.style.height = 'auto'; h.style.maxWidth = '100%'; h.style.maxHeight = '100%'; }\n              }\n            } catch (e) { /* ignore */ }\n          }\n      } catch (e) { }\n    };\n\n    const showInappRotate = (transientMs = 1200) => {\n      try {\n        const rotateBtnEl = document.getElementById('vtt-inapp-rotate') as HTMLButtonElement | null;\n        if (!rotateBtnEl) return;\n        rotateBtnEl.style.transform = 'translateY(0)'; rotateBtnEl.style.opacity = '1';\n        if (transientMs) setTimeout(()=>{ rotateBtnEl.style.transform='translateY(-120%)'; rotateBtnEl.style.opacity='0'; }, transientMs);\n      } catch(e){}\n    };\n\n    const createInappRotateButton = () => {\n      const rotateBtn = document.createElement('button'); rotateBtn.id = 'vtt-inapp-rotate'; rotateBtn.textContent = '\u293E';\n      rotateBtn.title = 'Rotate image';\n      // Position relative to the popout root so innerHTML changes in `content` won't remove it\n      rotateBtn.style.position = 'absolute'; rotateBtn.style.top = '12px'; rotateBtn.style.right = '12px'; rotateBtn.style.zIndex = '10000';\n      // Make button visually distinct on dark background\n      rotateBtn.style.background = 'rgba(255,255,255,0.08)'; rotateBtn.style.color = '#fff'; rotateBtn.style.border = '1px solid rgba(255,255,255,0.12)'; rotateBtn.style.padding = '8px'; rotateBtn.style.borderRadius = '8px';\n      rotateBtn.style.boxShadow = '0 4px 14px rgba(0,0,0,0.6)';\n      rotateBtn.style.pointerEvents = 'auto';\n      rotateBtn.style.transform = 'translateY(-120%)'; rotateBtn.style.transition = 'transform 220ms ease, opacity 220ms ease'; rotateBtn.style.opacity = '0';\n      rotateBtn.addEventListener('click', (ev) => { ev.stopPropagation(); _inapp_rot = (_inapp_rot + 90) % 360; applyInappRotation(); showInappRotate(1500); });\n      // Append to top-level element so it's not removed by content.innerHTML changes\n      el.appendChild(rotateBtn);\n      return rotateBtn;\n    };\n\n    const ensureInappRotate = () => { if (!document.getElementById('vtt-inapp-rotate')) createInappRotateButton(); };\n\n    // ensure rotate exists initially\n    ensureInappRotate();\n\n    content.addEventListener('mouseenter', () => showInappRotate(0));\n    content.addEventListener('mouseleave', () => { const r = document.getElementById('vtt-inapp-rotate'); if (r) { (r as HTMLButtonElement).style.transform='translateY(-120%)'; (r as HTMLButtonElement).style.opacity='0'; } });\n\n    el.appendChild(header); el.appendChild(content);\n    document.body.appendChild(el);\n\n    this.inAppPopoutEl = el;\n    \n\n    this.inAppWindowProxy = {\n      closed: false,\n      postMessage: (msg: any) => {\n        if (!msg || !msg.type) return;\n        if (msg.type === 'show') {\n          const i = el.querySelector('#vtt-inapp-img') as HTMLImageElement;\n          if (i) {\n            i.style.display = 'block';\n            i.src = msg.src || '';\n            // Ensure image is wrapped in .img-frame for consistent centering\n              try {\n              const contentEl = content as HTMLElement;\n              if (contentEl && i && (!i.parentElement || !i.parentElement.classList.contains('img-frame'))) {\n                const f = document.createElement('div'); f.className = 'img-frame';\n                // Ensure the in-app frame fills available area and centers content\n                f.style.width = '100%'; f.style.height = '100%'; f.style.display = 'flex'; f.style.alignItems = 'center'; f.style.justifyContent = 'center'; f.style.overflow = 'hidden'; f.style.boxSizing = 'border-box';\n                i.parentElement && i.parentElement.replaceChild(f, i);\n                f.appendChild(i);\n              }\n              // Reset rotation and run sizing after the image loads\n              i.addEventListener('load', () => { try { _inapp_rot = 0; applyInappRotation(); showInappRotate(1500); } catch(e){} });\n            } catch(e) { /* ignore */ }\n          }\n          // ensure rotate control exists and reset rotation immediately\n          try { ensureInappRotate(); _inapp_rot = 0; applyInappRotation(); showInappRotate(1500); } catch(e){}\n        } else if (msg.type === 'showHTML') {\n          const i = el.querySelector('#vtt-inapp-img') as HTMLImageElement;\n          if (i) i.style.display = 'none';\n          content.innerHTML = msg.html || '';\n          // If content now contains images/videos, ensure rotate button exists and show it briefly\n          try {\n            // Recreate rotate control if it was removed by innerHTML replace\n            ensureInappRotate();\n            const imgs = content.getElementsByTagName('img');\n            const vids = content.getElementsByTagName('video');\n            if ((imgs && imgs.length>0) || (vids && vids.length>0)) {\n              _inapp_rot = 0; // reset rotation for new content\n              applyInappRotation();\n              showInappRotate(1500);\n              // attach listeners to images/videos for diagnostics and to briefly show rotate when they load\n              for (let i = 0; i < imgs.length; i++) {\n                try { imgs[i].addEventListener('load', () => { showInappRotate(1500); }); imgs[i].addEventListener('error', () => { }); } catch(e){}\n              }\n              for (let v = 0; v < vids.length; v++) {\n                try { vids[v].addEventListener('loadeddata', () => { showInappRotate(1500); }); vids[v].addEventListener('error', () => { }); } catch(e){}\n              }\n            }\n          } catch(e){}\n        } else if (msg.type === 'requestCurrent') {\n          this.sendCurrentToPopout();\n        }\n      },\n      focus: () => { if (this.inAppPopoutEl) (this.inAppPopoutEl as HTMLElement).focus(); },\n      close: () => this.closeInAppPopout()\n    };\n\n    // Register the in-app proxy as the active popout window so sendCurrentToPopout posts to it\n    this.popoutWindow = this.inAppWindowProxy;\n\n    // Keyboard handling inside in-app popout\n    el.addEventListener('keydown', (e: KeyboardEvent) => {\n      if (e.key === 'ArrowRight') this.nextCard();\n      if (e.key === 'ArrowLeft') this.prevCard();\n      if (e.key === 'Escape') this.closeInAppPopout();\n    });\n    // Allow focusing the popout container to receive key events\n    el.tabIndex = -1;\n\n    // When created, send current card\n    setTimeout(() => this.sendCurrentToPopout(), 100);\n  }\n\n  closeInAppPopout() {\n    if (this.inAppPopoutEl) {\n      try { document.body.removeChild(this.inAppPopoutEl); } catch (e) {}\n      this.inAppPopoutEl = null;\n    }\n    if (this.inAppWindowProxy) { this.inAppWindowProxy.closed = true; this.inAppWindowProxy = null; }\n    // if this.popoutWindow points to this proxy, clear it\n    if (this.popoutWindow && this.popoutWindow === this.inAppWindowProxy) this.popoutWindow = null;\n  }\n\n  async _convertFileToDataUrl(path: string): Promise<string> {\n    try {\n      \n      const file: any = this.app.vault.getAbstractFileByPath(path);\n      if (!file) throw new Error('file not found: ' + path);\n      \n      // Use vault.readBinary properly bound to vault\n      \n      const data = await this.app.vault.readBinary(file);\n      // data may be Uint8Array, ArrayBuffer, or string\n      let bytes: Uint8Array;\n      if (data instanceof Uint8Array) bytes = data;\n      else if (data instanceof ArrayBuffer) bytes = new Uint8Array(data);\n      else if (typeof data === 'string') {\n        // string fallback: assume it's base64 or text - convert to utf8 bytes\n        const encoder = new TextEncoder(); bytes = encoder.encode(data);\n      } else bytes = new Uint8Array(0);\n\n      const b64 = this._uint8ArrayToBase64(bytes);\n      \n      const mime = this._mimeForPath(path) || 'application/octet-stream';\n      return `data:${mime};base64,${b64}`;\n    } catch (e) {\n      // next fallback: try to read the file via the app:// src or via fs if available\n      try {\n        // Try to find in cards or maps\n        const entry = (this.cards.find((c: any) => c.path === path) || this.maps.find((m: any) => m.path === path)) as any;\n        if (entry && entry.src && entry.src.startsWith('app://')) {\n          // app://<id>/absolute/path?query -> extract absolute path\n          const withoutQuery = entry.src.split('?')[0];\n          const absPath = withoutQuery.replace(/^app:\\/\\/[^\\/]+\\//, '/');\n          \n          try {\n            const req = (globalThis as any).require || null;\n            if (req) {\n              const fs = req('fs');\n              const buf = fs.readFileSync(absPath);\n              // Buffer -> base64\n              const globalBuffer = (globalThis as any).Buffer;\n              const b64 = (typeof globalBuffer !== 'undefined' && globalBuffer.from ? globalBuffer.from(buf).toString('base64') : this._uint8ArrayToBase64(new Uint8Array(buf)));\n              const mime = this._mimeForPath(path) || 'application/octet-stream';\n              return `data:${mime};base64,${b64}`;\n            }\n          } catch (fsErr) {\n            \n          }\n        }\n\n        // last resort: try fetching the URL directly\n        const srcUrl = (this.cards.find((c: any) => c.path === path)?.src || this.maps.find((m: any) => m.path === path)?.src);\n        \n        if (!srcUrl) throw e;\n        const resp = await fetch(srcUrl);\n        if (!resp.ok) throw new Error('fetch failed ' + resp.status);\n        const blob = await resp.blob();\n        return await this._blobToDataUrl(blob);\n      } catch (e2) {\n        throw e2;\n      }\n    }\n  }\n\n  _uint8ArrayToBase64(u8: Uint8Array) {\n    let s = '';\n    const chunk = 0x8000;\n    for (let i = 0; i < u8.length; i += chunk) {\n      s += String.fromCharCode.apply(null, Array.prototype.slice.call(u8, i, i + chunk));\n    }\n    return btoa(s);\n  }\n\n  _blobToDataUrl(blob: Blob): Promise<string> {\n    return new Promise((res, rej) => {\n      const fr = new FileReader();\n      fr.onload = () => res(fr.result as string);\n      fr.onerror = rej;\n      fr.readAsDataURL(blob);\n    });\n  }\n\n  async _convertFileToPopoutUrl(path: string): Promise<string> {\n    try {\n      const file: any = this.app.vault.getAbstractFileByPath(path);\n      if (!file) throw new Error('file not found: ' + path);\n\n      const data = await this.app.vault.readBinary(file);\n      let blob: Blob;\n      const mime = this._mimeForPath(path) || 'application/octet-stream';\n      if (data instanceof Uint8Array) {\n        blob = new Blob([data], { type: mime });\n      } else if (data instanceof ArrayBuffer) {\n        blob = new Blob([new Uint8Array(data)], { type: mime });\n      } else if (typeof data === 'string') {\n        blob = new Blob([data], { type: mime });\n      } else {\n        blob = new Blob([], { type: mime });\n      }\n\n      // Create blob URL usable by external popout window\n      const url = URL.createObjectURL(blob);\n      return url;\n    } catch (e) {\n      // Fallback to data URL if blob approach fails\n      try {\n        return await this._convertFileToDataUrl(path);\n      } catch (e2) {\n        throw e2;\n      }\n    }\n  }\n\n  _mimeForPath(path: string) {\n    const ext = path.split('.').pop()?.toLowerCase() || '';\n    switch (ext) {\n      case 'png': return 'image/png';\n      case 'jpg': case 'jpeg': return 'image/jpeg';\n      case 'bmp': return 'image/bmp';\n      case 'tif': case 'tiff': return 'image/tiff';\n      case 'ico': return 'image/x-icon';\n      case 'gif': return 'image/gif';\n      case 'webp': return 'image/webp';\n      case 'svg': return 'image/svg+xml';\n      case 'mp4': return 'video/mp4';\n      case 'webm': return 'video/webm';\n      case 'ogg': return 'video/ogg';\n      case 'mov': return 'video/quicktime';\n      default: return null;\n    }\n  }\n\n  /**\n   * Get or create a cached video thumbnail.\n   * Thumbnails are stored in the vault's _thumbnails folder (hidden with underscore).\n   * Returns the app:// URL to the cached thumbnail, or null if it couldn't be created.\n   */\n  async _getOrCreateVideoThumbnail(videoPath: string): Promise<string | null> {\n    try {\n      // Generate a unique thumbnail filename based on the video path\n      const videoFile = this.app.vault.getAbstractFileByPath(videoPath);\n      if (!videoFile) return null;\n      \n      // Create a hash-like identifier from the path\n      const safeFileName = videoPath.replace(/[^a-zA-Z0-9]/g, '_').substring(0, 100);\n      const thumbnailFileName = `thumb_${safeFileName}.jpg`;\n      \n      // Thumbnail cache folder path (in vault root, starts with _ to be ignored/hidden)\n      const thumbnailFolder = '_vtt_thumbnails';\n      const thumbnailPath = `${thumbnailFolder}/${thumbnailFileName}`;\n      \n      // Check if thumbnail already exists\n      const existingThumb = this.app.vault.getAbstractFileByPath(thumbnailPath);\n      if (existingThumb) {\n        // Thumbnail exists - return its resource path\n        return this.app.vault.getResourcePath(existingThumb as any);\n      }\n      \n      // Thumbnail doesn't exist - create it\n      // First, ensure the thumbnails folder exists\n      try {\n        const folder = this.app.vault.getAbstractFileByPath(thumbnailFolder);\n        if (!folder) {\n          await this.app.vault.createFolder(thumbnailFolder);\n        }\n      } catch (e) { /* folder might exist */ }\n      \n      // Get video resource path to load it\n      const videoUrl = this.app.vault.getResourcePath(videoFile as any);\n      \n      // Create thumbnail by extracting a frame from the video\n      const thumbnailData = await this._extractVideoFrame(videoUrl);\n      if (!thumbnailData) return null;\n      \n      // Convert base64 to binary and save\n      const base64Data = thumbnailData.split(',')[1];\n      const binaryString = atob(base64Data);\n      const bytes = new Uint8Array(binaryString.length);\n      for (let i = 0; i < binaryString.length; i++) {\n        bytes[i] = binaryString.charCodeAt(i);\n      }\n      \n      await this.app.vault.createBinary(thumbnailPath, bytes);\n      \n      // Return the resource path to the new thumbnail\n      const newThumb = this.app.vault.getAbstractFileByPath(thumbnailPath);\n      if (newThumb) {\n        return this.app.vault.getResourcePath(newThumb as any);\n      }\n      \n      return null;\n    } catch (e) {\n      console.error('Failed to get/create video thumbnail:', e);\n      return null;\n    }\n  }\n  \n  /**\n   * Extract a single frame from a video URL and return as base64 JPEG\n   */\n  async _extractVideoFrame(videoUrl: string): Promise<string | null> {\n    return new Promise((resolve) => {\n      const video = document.createElement('video');\n      video.crossOrigin = 'anonymous';\n      video.muted = true;\n      video.preload = 'metadata';\n      \n      // Timeout fallback - don't wait forever\n      const timeout = setTimeout(() => {\n        video.src = '';\n        resolve(null);\n      }, 10000);\n      \n      video.onloadeddata = () => {\n        // Seek to 1 second or 10% of duration, whichever is smaller\n        video.currentTime = Math.min(1, video.duration * 0.1);\n      };\n      \n      video.onseeked = () => {\n        try {\n          clearTimeout(timeout);\n          \n          // Create canvas and draw video frame\n          const canvas = document.createElement('canvas');\n          // Use smaller size for thumbnails (max 200px)\n          const maxSize = 200;\n          const scale = Math.min(maxSize / video.videoWidth, maxSize / video.videoHeight, 1);\n          canvas.width = Math.floor(video.videoWidth * scale);\n          canvas.height = Math.floor(video.videoHeight * scale);\n          \n          const ctx = canvas.getContext('2d');\n          if (ctx) {\n            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n            const thumbnail = canvas.toDataURL('image/jpeg', 0.7);\n            video.src = ''; // Release video\n            resolve(thumbnail);\n          } else {\n            video.src = '';\n            resolve(null);\n          }\n        } catch (e) {\n          console.error('Error extracting video frame:', e);\n          video.src = '';\n          resolve(null);\n        }\n      };\n      \n      video.onerror = () => {\n        clearTimeout(timeout);\n        video.src = '';\n        resolve(null);\n      };\n      \n      video.src = videoUrl;\n      video.load();\n    });\n  }\n\n  // Convert resource URLs inside rendered HTML to inline data URLs when possible\n  async _inlineResourcesInHtml(html: string, contextPath?: string): Promise<string> {\n    try {\n      const parser = new DOMParser();\n      const doc = parser.parseFromString(html, 'text/html');\n      \n      // Determine context directory for relative path resolution\n      let contextDir = '';\n      if (contextPath) {\n        const lastSlash = contextPath.lastIndexOf('/');\n        contextDir = lastSlash > 0 ? contextPath.substring(0, lastSlash) : '';\n      }\n      \n      // Handle Obsidian's internal-embed spans (from ![[image.jpg]] syntax)\n      const spans = Array.from(doc.querySelectorAll('span.internal-embed')) as HTMLElement[];\n      \n      for (const span of spans) {\n        const src = span.getAttribute('src');\n        const alt = span.getAttribute('alt') || 'image';\n        if (!src) continue;\n        \n        try {\n          // Try to resolve the src as a vault path\n          let dataUrl: string | null = null;\n          let foundFile: any = null;\n          \n          // First try the src as-is (might be a full path)\n          foundFile = this.app.vault.getAbstractFileByPath(src);\n          \n          // Try relative to context directory\n          if (!foundFile && contextDir) {\n            const fullPath = contextDir + '/' + src;\n            foundFile = this.app.vault.getAbstractFileByPath(fullPath);\n          }\n          \n          // Try as relative to the active file (fallback)\n          if (!foundFile) {\n            const activeFile = this.app.workspace.getActiveFile();\n            if (activeFile && activeFile.parent) {\n              const parentPath = activeFile.parent.path;\n              const fullPath = parentPath ? parentPath + '/' + src : src;\n              foundFile = this.app.vault.getAbstractFileByPath(fullPath);\n            }\n          }\n          \n          // Search in entire vault by filename\n          if (!foundFile) {\n            const baseName = src.split('/').pop();\n            const allFiles = this.app.vault.getFiles();\n            foundFile = allFiles.find((f: any) => f.name === baseName || f.path.endsWith(src));\n          }\n          \n          if (foundFile) {\n            dataUrl = await this._convertFileToDataUrl((foundFile as any).path);\n          }\n          \n          if (dataUrl) {\n            // Replace the span with an actual img element\n            const img = doc.createElement('img');\n            img.setAttribute('src', dataUrl);\n            img.setAttribute('alt', alt);\n            img.style.maxWidth = '100%';\n            img.style.height = 'auto';\n            span.parentNode?.replaceChild(img, span);\n            \n          } else {\n            \n          }\n        } catch (e) { }\n      }\n      \n      const imgs = Array.from(doc.getElementsByTagName('img')) as HTMLImageElement[];\n      for (const img of imgs) {\n        const src = img.getAttribute('src') || '';\n        if (!src || src.startsWith('data:')) continue;\n        try {\n          const data = await this._urlToDataUrl(src);\n          if (data) img.setAttribute('src', data);\n        } catch (e) { }\n      }\n      const videos = Array.from(doc.getElementsByTagName('video')) as HTMLVideoElement[];\n      for (const v of videos) {\n        // handle <video src=...> and <source> children\n        const s = v.getAttribute('src');\n        if (s && !s.startsWith('data:')) {\n          try { \n            const data = await this._urlToDataUrl(s); \n            if (data) {\n              v.setAttribute('src', data);\n            } else if (s.startsWith('app://')) {\n              // For large videos that can't be converted, try to keep the app:// URL\n              // This works in in-app popouts but not external windows\n              // External windows will show a broken video, which is better than nothing\n            }\n          } catch (e) { }\n        }\n        const sources = Array.from(v.getElementsByTagName('source')) as HTMLSourceElement[];\n        for (const srcEl of sources) {\n          const s2 = srcEl.getAttribute('src');\n          if (!s2 || s2.startsWith('data:')) continue;\n          try { \n            const data = await this._urlToDataUrl(s2); \n            if (data) srcEl.setAttribute('src', data); \n          } catch (e) { }\n        }\n      }\n      // srcset handling\n      for (const img of imgs) {\n        const ss = img.getAttribute('srcset');\n        if (!ss) continue;\n        try {\n          const parts = ss.split(',').map(p => p.trim()).map(p => {\n            const [url, desc] = p.split(/\\s+/);\n            return { url, desc };\n          });\n          for (const p of parts) {\n            try {\n              const data = await this._urlToDataUrl(p.url);\n              if (data) p.url = data;\n            } catch (e) { /* ignore */ }\n          }\n          const newSrcSet = parts.map(p => p.url + (p.desc ? ' ' + p.desc : '')).join(', ');\n          img.setAttribute('srcset', newSrcSet);\n        } catch (e) { }\n      }\n      // Remove any <script> tags from the rendered HTML to avoid running embedded scripts (and TypeScript 'as' casts)\n      try {\n        const scripts = Array.from(doc.getElementsByTagName('script'));\n        for (const s of scripts) { s.parentNode?.removeChild(s); }\n      } catch(e) { /* ignore */ }\n      return doc.body.innerHTML;\n    } catch (e) {\n      \n      return html;\n    }\n  }\n\n  // Convert a URL (possibly app:// or remote) to a data URL when possible\n  // For in-app popouts, returns app:// URLs without conversion for large files\n  async _urlToDataUrl(url: string): Promise<string | null> {\n    try {\n      if (!url) return null;\n      const clean = url.split('?')[0];\n      \n      // Check if this is an in-app popout\n      const isInAppPopout = this.popoutWindow === this.inAppWindowProxy;\n      \n      // For in-app popouts, return app:// URLs directly\n      if (isInAppPopout && url.startsWith('app://')) {\n        return url;\n      }\n      \n      // try to match known cards/maps entries\n      const all: any[] = ([] as any[]).concat(this.cards || [], this.maps || []);\n      for (const entry of all) {\n        if (entry && entry.src && entry.src.split('?')[0] === clean) {\n          if (entry.path) {\n            try { return await this._convertFileToDataUrl(entry.path); } catch (e) { }\n          }\n        }\n      }\n      // If URL is a relative path or plain filename, try resolving it in the vault\n      if (!/^([a-zA-Z]+:)?\\/\\//.test(url) && !url.startsWith('data:')) {\n        // try absolute path\n        let candidate = url;\n        try {\n          let file = this.app.vault.getAbstractFileByPath(candidate);\n          if (!file && this.app.workspace.getActiveFile()) {\n            const base = this.app.workspace.getActiveFile().parent?.path || '';\n            candidate = base.replace(/\\/$/, '') + '/' + url.replace(/^\\//, '');\n            file = this.app.vault.getAbstractFileByPath(candidate);\n          }\n          if (file) {\n            const filePath = (file as any).path;\n            try { return await this._convertFileToDataUrl(filePath); } catch (e) { }\n          }\n        } catch (e) { /* ignore */ }\n      }\n      // fallback: try fetch and convert to blob data url\n      try {\n        const resp = await fetch(url);\n        if (!resp.ok) throw new Error('fetch failed ' + resp.status);\n        const blob = await resp.blob();\n        return await this._blobToDataUrl(blob);\n      } catch (e) {\n        \n      }\n      return null;\n    } catch (e) { return null; }\n  }\n\n  /**\n   * Extract content from a note for projection.\n   * Notes can have sections:\n   * - Content before any header or under other headers: always shown (image/main content)\n   * - # Player Infos: shown only if showPlayerInfo is true\n   * - # DM Info: never shown in popout\n   * \n   * @param content - Raw markdown content\n   * @param includePlayerInfo - Whether to include Player Infos section\n   * @returns Processed markdown content for projection\n   */\n  _extractNoteContentForProjection(content: string, includePlayerInfo: boolean): string {\n    const lines = content.split('\\n');\n    const result: string[] = [];\n    let currentSection: 'main' | 'player' | 'dm' = 'main';\n    \n    for (const line of lines) {\n      // Check for section headers (case-insensitive)\n      const headerMatch = line.match(/^(#+)\\s*(.+)$/);\n      if (headerMatch) {\n        const headerText = headerMatch[2].toLowerCase().trim();\n        if (headerText.includes('player info') || headerText.includes('player-info') || headerText.includes('playerinfo') || headerText === 'player infos') {\n          currentSection = 'player';\n          if (includePlayerInfo) {\n            result.push(line); // Include the header too\n          }\n          continue;\n        } else if (headerText.includes('dm info') || headerText.includes('dm-info') || headerText.includes('dminfo') || headerText.includes('gm info') || headerText.includes('gamemaster') || headerText === 'dm') {\n          currentSection = 'dm';\n          continue; // Never include DM header\n        } else {\n          // Other header - back to main content\n          currentSection = 'main';\n        }\n      }\n      \n      // Add line based on current section\n      if (currentSection === 'main') {\n        result.push(line);\n      } else if (currentSection === 'player' && includePlayerInfo) {\n        result.push(line);\n      }\n      // DM section lines are never added\n    }\n    \n    return result.join('\\n');\n  }\n\n  /**\n   * Parse note content into separate image and player info sections.\n   * Structure: Everything before first section header OR after images = image content\n   * # Player Infos section = player info (shown in top-right box if enabled)\n   * # DM Info section = never shown\n   * Other sections after DM Info = still hidden (DM notes)\n   * \n   * Expected note format:\n   * ![[image.jpg]]\n   * # Player Infos\n   * (player visible text)\n   * # DM Info\n   * (dm only text - never shown)\n   * \n   * @returns Object with imageContent (main/image part) and playerInfoContent (player info text)\n   */\n  _parseNoteContent(content: string, includePlayerInfo: boolean): { imageContent: string; playerInfoContent: string } {\n    // First, remove all ```vtt-project ... ``` code blocks from the content\n    const cleanedContent = content.replace(/```vtt-project[\\s\\S]*?```/g, '');\n    \n    const lines = cleanedContent.split('\\n');\n    const imageLines: string[] = [];\n    const playerInfoLines: string[] = [];\n    let currentSection: 'main' | 'player' | 'dm' = 'main';\n    \n    for (const line of lines) {\n      // Check for section headers (case-insensitive)\n      const headerMatch = line.match(/^(#+)\\s*(.*)$/);\n      if (headerMatch) {\n        const headerText = headerMatch[2].toLowerCase().trim();\n        \n        // Check for DM Info section FIRST (various formats) - these are never shown\n        if (headerText.includes('dm info') || headerText.includes('dm-info') || \n            headerText.includes('dminfo') || headerText.includes('gm info') || \n            headerText.includes('gamemaster') || headerText === 'dm' ||\n            headerText.startsWith('dm info') || headerText.startsWith('dm-info') ||\n            headerText === 'story' || headerText.includes('dm note') ||\n            headerText === 'story generator') {\n          currentSection = 'dm';\n          \n          continue; // Never include DM header\n        }\n        \n        // Check for Player Info section (various formats) - can switch back from DM section!\n        if (headerText.includes('player info') || headerText.includes('player-info') || \n            headerText.includes('playerinfo') || headerText.startsWith('player info') ||\n            headerText === 'player infos' || headerText === 'player info' ||\n            headerText.includes('introduction to player') || headerText.includes('player introduction') ||\n            headerText.includes('to player') || headerText.includes('for player')) {\n          currentSection = 'player';\n          // Include the header for player sections (except \"Player Infos\" itself)\n          if (!headerText.match(/^player\\s*info/)) {\n            playerInfoLines.push(line);\n          }\n          \n          continue;\n        }\n        \n        // Other headers: stay in current section\n      }\n      \n      // Add line based on current section\n      if (currentSection === 'main') {\n        imageLines.push(line);\n      } else if (currentSection === 'player' && includePlayerInfo) {\n        playerInfoLines.push(line);\n      }\n      // DM section lines are never added\n    }\n    \n    \n    \n    return {\n      imageContent: imageLines.join('\\n'),\n      playerInfoContent: playerInfoLines.join('\\n')\n    };\n  }\n\n  /**\n   * Build HTML for note projection with image/video centered and text in top-right box\n   */\n  _buildNoteProjectionHtml(imageHtml: string, playerInfoHtml: string): string {\n    // Use very explicit inline styles to ensure the box appears correctly\n    const infoBoxStyle = `position:absolute!important;top:16px!important;right:16px!important;max-width:350px!important;max-height:60%!important;overflow-y:auto!important;background:rgba(0,0,0,0.9)!important;border:2px solid rgba(255,255,255,0.3)!important;border-radius:8px!important;padding:16px 20px!important;color:#fff!important;font-size:14px!important;line-height:1.6!important;box-shadow:0 4px 24px rgba(0,0,0,0.7)!important;z-index:9999!important;text-align:left!important;`;\n\n    const containerStyle = `position:relative!important;width:100%!important;height:100%!important;display:flex!important;align-items:center!important;justify-content:center!important;`;\n\n    const mediaStyle = `position:relative!important;width:100%!important;height:100%!important;display:flex!important;align-items:center!important;justify-content:center!important;`;\n\n    let html = `<div class=\"vtt-note-container\" style=\"${containerStyle}\">`;\n    html += `<div class=\"vtt-note-image\" style=\"${mediaStyle}\">${imageHtml}</div>`;\n    \n    if (playerInfoHtml && playerInfoHtml.trim()) {\n      html += `<div class=\"vtt-player-info-box\" style=\"${infoBoxStyle}\">${playerInfoHtml}</div>`;\n    }\n    \n    html += '</div>';\n    return html;\n  }\n\n  /**\n   * Resolve ![[image]] and ![[video]] links in markdown content to actual file paths.\n   * Also handles video file extensions for proper rendering.\n   */\n  _resolveEmbeddedMedia(content: string, noteDir: string): string {\n    const videoExtensions = ['.mp4', '.webm', '.ogg', '.mov'];\n    \n    return content.replace(/!\\[\\[([^\\]]+)\\]\\]/g, (match, filename) => {\n      // Try to find the file\n      const allFiles = this.app.vault.getFiles();\n      const baseName = filename.split('/').pop();\n      const isVideo = videoExtensions.some(ext => filename.toLowerCase().endsWith(ext));\n      \n      // Try to find the file in vault - prioritize relative paths\n      let foundFile: any = null;\n      \n      // First try: relative to note directory (e.g., _resources/image.png -> Maps/_resources/image.png)\n      if (noteDir) {\n        const relativePath = noteDir + '/' + filename;\n        foundFile = this.app.vault.getAbstractFileByPath(relativePath);\n      }\n      \n      // Second try: absolute path\n      if (!foundFile) {\n        foundFile = this.app.vault.getAbstractFileByPath(filename);\n      }\n      \n      // Third try: by filename or path ending\n      if (!foundFile) {\n        const fileMatches = allFiles.filter((f: any) => f.name === baseName || f.path.endsWith(filename));\n        if (fileMatches.length > 0) {\n          foundFile = fileMatches[0];\n        }\n      }\n      \n      // Fourth try: common folders\n      if (!foundFile) {\n        const candidates = [\n          'images/' + baseName,\n          '_resources/' + baseName,\n        ];\n        for (const candidate of candidates) {\n          const f = this.app.vault.getAbstractFileByPath(candidate);\n          if (f) { foundFile = f; break; }\n        }\n      }\n      \n      if (foundFile) {\n        if (isVideo) {\n          // Get resource URL for the video file\n          const resourceUrl = this.app.vault.getResourcePath(foundFile);\n          return `<video controls autoplay muted loop style=\"max-width:100%;max-height:100%;display:block;margin:auto\"><source src=\"${resourceUrl}\" type=\"video/${foundFile.extension}\"></video>`;\n        }\n        return `![${filename}](${foundFile.path})`;\n      }\n      \n      // Fallback\n      if (isVideo) {\n        return `<video controls style=\"max-width:100%;max-height:100%\"><source src=\"${filename}\"></video>`;\n      }\n      return `![${filename}](${filename})`;\n    });\n  }\n\n  /** Check if a file path contains an underscore-prefixed folder (to be ignored) */\n  _isInIgnoredFolder(filePath: string, baseFolder: string): boolean {\n    // Get the relative path after the base folder\n    const relativePath = baseFolder ? filePath.substring(baseFolder.length + 1) : filePath;\n    // Check if any folder component starts with underscore\n    const parts = relativePath.split('/');\n    // Check all parts except the filename itself\n    for (let i = 0; i < parts.length - 1; i++) {\n      if (parts[i].startsWith('_')) return true;\n    }\n    return false;\n  }\n\n  /** Load card image files from the configured Cards folder */\n  async loadCards() {\n    const folder = (this.settings.folderPath || '').trim();\n    const files: any[] = this.app.vault.getFiles();\n    this.cards = files\n      .filter(f => folder === '' || f.path.startsWith(folder + '/'))\n      .filter(f => !this._isInIgnoredFolder(f.path, folder))\n      .filter(f => IMAGE_EXTENSIONS.some(e => f.name.toLowerCase().endsWith(e)))\n      .map(f => ({ src: this.app.vault.getResourcePath(f), path: f.path }));\n    this.current = 0;\n    \n  }\n\n  /** Load map files (images and markdown) from the configured Maps folder */\n  async loadMaps() {\n    const folder = (this.settings.mapsFolderPath || '').trim();\n    const files: any[] = this.app.vault.getFiles();\n    const mapExtensions = [...IMAGE_EXTENSIONS, '.md'];\n    \n    this.maps = files\n      .filter(f => folder === '' || f.path.startsWith(folder + '/'))\n      .filter(f => !this._isInIgnoredFolder(f.path, folder))\n      .filter(f => mapExtensions.some(e => f.name.toLowerCase().endsWith(e)))\n      .map(f => ({ src: f.extension === 'md' ? undefined : this.app.vault.getResourcePath(f), path: f.path, title: f.name.replace(/\\.[^.]+$/, '') }));\n    \n  }\n\n  /** Close the popout window */\n  closePopout() {\n    // Close in-app popout if exists\n    if (this.inAppPopoutEl) {\n      this.closeInAppPopout();\n      return;\n    }\n    // Close external popout window\n    if (this.popoutWindow && !this.popoutWindow.closed) {\n      try {\n        this.popoutWindow.close();\n      } catch (e) {\n        \n      }\n      this.popoutWindow = null;\n      new Notice('Popout closed');\n    } else {\n      new Notice('No popout open');\n    }\n  }\n\n  /** Open or focus the popout window */\n  openPopout(suppressInitialSend: boolean = false) {\n    if (this.popoutWindow && !this.popoutWindow.closed) { this.popoutWindow.focus(); if (!suppressInitialSend) this.sendCurrentToPopout(); this.sendSettingsToPopout(); return; }\n    // When caller requests suppression, set a flag to ignore the first requestCurrent coming from the popout\n    if (suppressInitialSend) { (this as any)._suppressNextRequest = true; setTimeout(() => { (this as any)._suppressNextRequest = false; }, 2000); }\n    const html = buildPopoutHtml(this.settings);\n\n    // Try Electron BrowserWindow fallback first (if available)\n    try {\n      const ep = this.tryOpenElectronWindow(html);\n      if (ep) { this.popoutWindow = ep; if (!suppressInitialSend) setTimeout(() => this.sendCurrentToPopout(), 300); setTimeout(() => this.sendSettingsToPopout(), 350); return; }\n    } catch (e) { }\n    const opts = `width=${this.settings.popoutWidth},height=${this.settings.popoutHeight},left=${this.settings.popoutLeft},top=${this.settings.popoutTop}`;\n    try {\n      // 1) Try opening an empty window and write the HTML\n      this.popoutWindow = window.open('', 'vtt-card-popout', opts);\n      \n      if (this.popoutWindow) {\n      try { this.popoutWindow.document.open(); this.popoutWindow.document.write(html); this.popoutWindow.document.close(); }\n        catch (e) {\n          new (globalThis as any).Notice('Could not initialize popout content');\n        }\n        if (!suppressInitialSend) setTimeout(() => this.sendCurrentToPopout(), 300);\n        setTimeout(() => this.sendSettingsToPopout(), 350);\n        return;\n      }\n\n      // 2) Try opening about:blank explicitly\n      this.popoutWindow = window.open('about:blank', 'vtt-card-popout', opts);\n      \n        if (this.popoutWindow) {\n        try { this.popoutWindow.document.open(); this.popoutWindow.document.write(html); this.popoutWindow.document.close(); }\n        catch (e) { }\n        if (!suppressInitialSend) setTimeout(() => this.sendCurrentToPopout(), 300);\n        setTimeout(() => this.sendSettingsToPopout(), 350);\n        return;\n      }\n\n      // 3) Fallback: create an iframe inside the newly opened window and set srcdoc (avoids blob: URLs)\n      try {\n        const w = window.open('', 'vtt-card-popout', opts);\n        \n        if (w && w.document) {\n          try {\n            w.document.open();\n            w.document.write('<!doctype html><html><body><div id=\"vtt-iframe-root\"></div></body></html>');\n            w.document.close();\n            const iframe = w.document.createElement('iframe');\n            iframe.style.width = '100%'; iframe.style.height = '100%'; iframe.style.border = 'none';\n            iframe.srcdoc = html;\n            const root = w.document.getElementById('vtt-iframe-root');\n            if (root) root.appendChild(iframe);\n            this.popoutWindow = w;\n            if (!suppressInitialSend) setTimeout(() => this.sendCurrentToPopout(), 300);\n            setTimeout(() => this.sendSettingsToPopout(), 350);\n            return;\n          } catch (e) { }\n        }\n      } catch (e) { }\n\n      // If we reach here nothing worked \u2014 create in-app fallback\n      \n      new (globalThis as any).Notice('Could not open external popout (blocked). Opening in-app popout instead.');\n      this.createInAppPopout();\n    } catch (e) {\n      \n      new (globalThis as any).Notice('Could not open popout window');\n    }\n  }\n\n  tryOpenElectronWindow(html: string) {\n    try {\n      const req = (window as any).require || ((globalThis as any).require ? (globalThis as any).require : null);\n      if (!req) { return null; }\n\n      // Try multiple electron entry points\n      const tryNames = ['electron', '@electron/remote'];\n      let electron: any = null;\n      for (const n of tryNames) {\n        try { electron = req(n); if (electron) { break; } } catch (e) { /* ignore */ }\n      }\n      if (!electron) { return null; }\n\n      const BrowserWindow = electron.BrowserWindow || (electron.remote && electron.remote.BrowserWindow) || (electron.remote && electron.remote.getCurrentWindow && electron.remote.getCurrentWindow().constructor);\n      if (!BrowserWindow) { return null; }\n\n      // Create a BrowserWindow\n      const win = new (BrowserWindow as any)({ width: this.settings.popoutWidth || 800, height: this.settings.popoutHeight || 600, x: this.settings.popoutLeft, y: this.settings.popoutTop, webPreferences: { nodeIntegration: false, contextIsolation: true } });\n      try {\n        // Load blank page and inject HTML after DOM is ready; executing too early can leave a blank page\n        try { win.loadURL('about:blank'); } catch (e) { }\n        const safeHtml = JSON.stringify(html);\n        // Inject HTML and create a message handler that dispatches to the window's message event listener\n        // The buildPopoutHtml already includes proper message handlers, we just need to dispatch messages to them\n        const inject = `(function(html){ \n          try { document.open(); document.write(html); document.close(); } catch (e) { } \n          window._vtt_handle = function(msg){ \n            try { \n              if (!msg) return;\n              // Dispatch as a MessageEvent to trigger the existing message listener in the HTML\n              var ev = new MessageEvent('message', { data: msg });\n              window.dispatchEvent(ev);\n            } catch(e){ } \n          }; \n          window._vtt_ready = true; \n        })( ${safeHtml} );`;\n        try {\n          const exec = () => {\n            try {\n              win.webContents && win.webContents.executeJavaScript && win.webContents.executeJavaScript(inject).then(()=>{}).catch((err:any)=>{\n                // Injection failed\n              });\n            } catch (e) { }\n            try { win.show && win.show(); } catch (e) {}\n          };\n          if (win.webContents && typeof win.webContents.once === 'function') {\n              win.webContents.once('dom-ready', () => {\n                exec();\n                // mark ready and flush any queued messages\n                try {\n                  proxy._ready = true;\n                  if ((proxy as any)._pending && (proxy as any)._pending.length) {\n                    const arr = (proxy as any)._pending.splice(0);\n                    arr.forEach((m: any) => {\n                      try { win.webContents.executeJavaScript(`(window._vtt_handle && window._vtt_handle(${JSON.stringify(m)}))`).catch(()=>{}); } catch(e){}\n                    });\n                    \n                  }\n                } catch(e) { }\n              });\n            } else exec();\n        } catch (e) { }\n      } catch (e) { }\n\n      const pending: any[] = [] as any[];\n      const proxy: any = {\n        closed: false,\n        _ready: false,\n        _pending: pending,\n        postMessage: (msg: any) => {\n          try {\n            \n            if (!proxy._ready) {\n              pending.push(msg);\n              \n              return;\n            }\n            // Call the in-window handler\n            win.webContents && win.webContents.executeJavaScript && win.webContents.executeJavaScript(`(window._vtt_handle && window._vtt_handle(${JSON.stringify(msg)}))`).catch(()=>{});\n          } catch (e) { }\n        },\n        focus: () => { try { win.focus && win.focus(); } catch (e) { } },\n        close: () => { try { win.close && win.close(); proxy.closed = true; } catch (e) { } }\n      };\n      try { win.on && win.on('closed', () => { proxy.closed = true; if (this.popoutWindow === proxy) this.popoutWindow = null; }); } catch (e) { /* ignore */ }\n      return proxy;\n    } catch (e) { return null; }\n  }\n\n  tryForcedExternalPopout() {\n    const html = buildPopoutHtml(this.settings);\n    const ep = this.tryOpenElectronWindow(html);\n    if (ep) { this.popoutWindow = ep; new (globalThis as any).Notice('Opened external popout via Electron.'); setTimeout(() => this.sendCurrentToPopout(), 300); return; }\n    new (globalThis as any).Notice('Could not open external popout via Electron. See README for instructions to enable BrowserWindow fallback (AppImage/non-sandboxed).');\n    \n  }\n\n  // Send grid and fog settings to popout\n  sendSettingsToPopout() {\n    if (!this.popoutWindow || this.popoutWindow.closed) return;\n    \n    try {\n      this.popoutWindow.postMessage({ \n        plugin: 'vtt-card-display', \n        type: 'settings', \n        gridSize: this.settings.gridSize ?? 50,\n        gridColor: this.settings.gridColor ?? '#ffffff',\n        gridOpacity: this.settings.gridOpacity ?? 0.3,\n        fogRevealSize: this.settings.fogRevealSize ?? 30,\n        showPlayerInfo: this.settings.showPlayerInfo ?? false,\n      }, '*');\n    } catch (e) {\n      \n    }\n  }\n\n  async sendCurrentToPopout() {\n    if (!this.popoutWindow || this.popoutWindow.closed) return;\n    \n    const entry: any = this.cards[this.current];\n    \n    if (!entry) {\n      if (!this.cards || this.cards.length === 0) {\n        new (globalThis as any).Notice('No cards available to project \u2014 add images to the Cards folder or set the folder path in settings');\n        return;\n      }\n      \n      try {\n        this.popoutWindow.postMessage({ plugin: 'vtt-card-display', type: 'showHTML', html: '<div style=\"color:#fff;padding:24px;text-align:center\">No card image available</div>' }, '*');\n      } catch (e) { }\n      return;\n    }\n\n    // Normalize src\n    let src: string | null = null;\n    if (typeof entry === 'string') src = entry;\n    else if (entry && typeof entry.src === 'string') src = entry.src;\n    else src = null;\n\n    // Check if this is an in-app popout (can use app:// URLs directly)\n    const isInAppPopout = this.popoutWindow === this.inAppWindowProxy;\n    \n    // For in-app popouts, we can use app:// URLs directly without conversion\n    if (isInAppPopout && src && src.startsWith('app://')) {\n      // Use the app:// URL directly - no conversion needed\n      try {\n        const message = { plugin: 'vtt-card-display', type: 'show', src };\n        this.popoutWindow.postMessage(message, '*');\n        (this as any)._suppressNextRequest = true; setTimeout(() => { (this as any)._suppressNextRequest = false; }, 500);\n      } catch (e) { }\n      return;\n    }\n\n    // For external popouts, convert files to a URL usable by the popout (prefer blob: URLs)\n    if ((!src || src.startsWith('app://') || src.startsWith('file://')) && entry && entry.path) {\n      try {\n        // Revoke previous blob URL if any\n        try { if (this._lastPopoutBlobUrl) { URL.revokeObjectURL(this._lastPopoutBlobUrl); this._lastPopoutBlobUrl = null; } } catch (e) {}\n        src = await this._convertFileToPopoutUrl(entry.path);\n        // If we got a blob URL, remember it so we can revoke later\n        if (src && src.startsWith('blob:')) this._lastPopoutBlobUrl = src;\n      } catch (e) { }\n    }\n\n    // As a last resort, if src still looks like an app:// URL, try to convert by parsing the path\n    if (src && src.startsWith('app://') && entry && entry.path) {\n      try {\n        src = await this._convertFileToPopoutUrl(entry.path);\n        if (src && src.startsWith('blob:')) this._lastPopoutBlobUrl = src;\n      } catch (e) { }\n    }\n\n    if (!src) {\n      try { this.popoutWindow.postMessage({ plugin: 'vtt-card-display', type: 'showHTML', html: '<div style=\"color:#fff;padding:24px;text-align:center\">Unable to resolve card image</div>' }, '*'); }\n      catch (e) { }\n      return;\n    }\n\n    try {\n      // For external popouts, prefer sending a blob/data URL converted from the vault file\n      let outSrc = src;\n      if (!isInAppPopout && entry && entry.path) {\n        try {\n          if (this._lastPopoutBlobUrl) { try { URL.revokeObjectURL(this._lastPopoutBlobUrl); } catch (e) {} this._lastPopoutBlobUrl = null; }\n          outSrc = await this._convertFileToPopoutUrl(entry.path);\n          if (outSrc && outSrc.startsWith('blob:')) this._lastPopoutBlobUrl = outSrc;\n        } catch (e) {\n          // fallback to previously resolved src\n          outSrc = src;\n        }\n      }\n\n      // Determine kind for the popout so it can choose video vs image explicitly\n      let kind: string | undefined = undefined;\n      try {\n        const mime = this._mimeForPath(entry?.path || '') || '';\n        if (mime.startsWith('video/')) kind = 'video';\n        else if (mime.startsWith('image/')) kind = 'image';\n      } catch (e) {}\n\n      const message = { plugin: 'vtt-card-display', type: 'show', src: outSrc, kind };\n      this.popoutWindow.postMessage(message, '*');\n      // set suppress flag briefly so popout-initiated requestCurrent doesn't immediately overwrite\n      (this as any)._suppressNextRequest = true; setTimeout(() => { (this as any)._suppressNextRequest = false; }, 500);\n    } catch (e) {\n      \n    }\n  }\n\n  nextCard() { if (!this.cards || this.cards.length === 0) return; this.current = (this.current + 1) % this.cards.length; this.sendCurrentToPopout(); }\n  prevCard() { if (!this.cards || this.cards.length === 0) return; this.current = (this.current - 1 + this.cards.length) % this.cards.length; this.sendCurrentToPopout(); }\n\n  // Project helpers\n  async projectItemById(id: string) {\n    const item = (this.settings.items || []).find(x => x.id === id as string);\n    if (!item) { new Notice(`Item ${id} not found`); return; }\n    try {\n      if (item.type === 'image') {\n        const file: any = this.app.vault.getAbstractFileByPath(item.value);\n        if (!file) { new (globalThis as any).Notice('Image file not found: ' + item.value); return; }\n        let src = this.app.vault.getResourcePath(file);\n        // Convert to data URL for external popout\n        try { src = await this._convertFileToDataUrl(file.path); } catch (e) { }\n        this.openPopout(true);\n        await this._sendToPopoutWhenReady({ plugin: 'vtt-card-display', type: 'show', kind: 'image', src, title: item.title });\n      } else if (item.type === 'statblock') {\n        const file: any = this.app.vault.getAbstractFileByPath(item.value);\n        if (!file) { new (globalThis as any).Notice('Note not found: ' + item.value); return; }\n        const content = await this.app.vault.read(file);\n          // Open the popout immediately to preserve the user gesture (avoid popup blockers), then render and send content\n          this.openPopout(true);\n          const div = document.createElement('div');\n          await MarkdownRenderer.renderMarkdown(content, div, file.path, this);\n          const inlined = await this._inlineResourcesInHtml(div.innerHTML);\n          await this._sendToPopoutWhenReady({ plugin: 'vtt-card-display', type: 'showHTML', html: inlined, title: item.title });\n      } else if (item.type === 'note-image') {\n        const path = item.value || (this.app.workspace.getActiveFile() ? this.app.workspace.getActiveFile().path : null);\n        if (!path) { new (globalThis as any).Notice('No note to find image from'); return; }\n        const file: any = this.app.vault.getAbstractFileByPath(path);\n        if (!file) { new (globalThis as any).Notice('Note not found: ' + path); return; }\n        const md = await this.app.vault.read(file);\n        const m = md.match(/!\\[[^\\]]*\\]\\(([^)]+)\\)/);\n        if (!m) { new Notice('No image found in note'); return; }\n        const imgPath = m[1];\n        const target = this.app.vault.getAbstractFileByPath(imgPath) || this.app.vault.getAbstractFileByPath((file.parent && file.parent.path ? file.parent.path + '/' : '') + imgPath);\n        if (!target) { new (globalThis as any).Notice('Image not found: ' + imgPath); return; }\n        let src = this.app.vault.getResourcePath(target);\n        // Convert to data URL for external popout\n        try { src = await this._convertFileToDataUrl((target as any).path); } catch (e) { }\n        this.openPopout(true);\n        await this._sendToPopoutWhenReady({ plugin: 'vtt-card-display', type: 'show', kind: 'image', src, title: item.title });\n      }\n      else if (item.type === 'card') {\n        // value should be a card path (relative vault path)\n        const cardPath = item.value;\n        if (!cardPath) { new (globalThis as any).Notice('No card selected'); return; }\n        const entry = (this.cards || []).find((c: any) => c.path === cardPath);\n        if (!entry) { new (globalThis as any).Notice('Card not found: ' + cardPath); return; }\n        let src = entry.src;\n        // If it's a local file (path exists), convert to data URL for external popout reliability\n        if (entry.path && (entry.path.toLowerCase().endsWith('.mp4') || entry.path.toLowerCase().endsWith('.png') || entry.path.toLowerCase().endsWith('.jpg') || entry.path.toLowerCase().endsWith('.jpeg') || entry.path.toLowerCase().endsWith('.svg') || entry.path.toLowerCase().endsWith('.webp') || entry.path.toLowerCase().endsWith('.gif'))) {\n          try { src = await this._convertFileToDataUrl(entry.path); } catch (e) { }\n        }\n        this.openPopout(true);\n        await this._sendToPopoutWhenReady({ plugin: 'vtt-card-display', type: 'show', kind: 'card', src, title: item.title });\n      }\n      else if (item.type === 'map') {\n        // value should be a map path (media or markdown)\n        const mapPath = item.value;\n        if (!mapPath) { new (globalThis as any).Notice('No map selected'); return; }\n        const entry = (this.maps || []).find((c: any) => c.path === mapPath);\n        if (!entry) { new (globalThis as any).Notice('Map not found: ' + mapPath); return; }\n        if (entry.path && entry.path.toLowerCase().endsWith('.md')) {\n          // Render the note as HTML into the popout\n          const file: any = this.app.vault.getAbstractFileByPath(entry.path);\n          if (!file) { new (globalThis as any).Notice('Map note not found: ' + entry.path); return; }\n          const content = await this.app.vault.read(file);\n          this.openPopout(true);\n          const div = document.createElement('div');\n          await MarkdownRenderer.renderMarkdown(content, div, file.path, this);\n          await this._sendToPopoutWhenReady({ plugin: 'vtt-card-display', type: 'showHTML', html: div.innerHTML, title: item.title });\n        } else {\n          // media map\n          let src = entry.src;\n          try { if (entry.path) src = await this._convertFileToDataUrl(entry.path); } catch (e) { }\n          this.openPopout(true);\n          await this._sendToPopoutWhenReady({ plugin: 'vtt-card-display', type: 'show', kind: 'map', src, title: item.title });\n        }\n      }\n      else if (item.type === 'note') {\n        // Project a note from any folder - with Player/DM info filtering\n        const notePath = item.value;\n        if (!notePath) { new (globalThis as any).Notice('No note selected'); return; }\n        const file: any = this.app.vault.getAbstractFileByPath(notePath);\n        if (!file) { new (globalThis as any).Notice('Note not found: ' + notePath); return; }\n        \n        const rawContent = await this.app.vault.read(file);\n        const noteDir = (file.parent && file.parent.path) ? file.parent.path : '';\n        \n        // Parse the note into image and text sections\n        const { imageContent, playerInfoContent } = this._parseNoteContent(rawContent, this.settings.showPlayerInfo || false);\n        \n        // Resolve ![[image]] and ![[video]] links in image content\n        const resolvedImageContent = this._resolveEmbeddedMedia(imageContent, noteDir);\n        \n        // Render image/video part\n        const imageDiv = document.createElement('div');\n        await MarkdownRenderer.renderMarkdown(resolvedImageContent, imageDiv, file.path, this);\n        const inlinedImage = await this._inlineResourcesInHtml(imageDiv.innerHTML, file.path);\n        \n        // Render player info part if present\n        let inlinedPlayerInfo = '';\n        if (playerInfoContent.trim()) {\n          const infoDiv = document.createElement('div');\n          await MarkdownRenderer.renderMarkdown(playerInfoContent, infoDiv, file.path, this);\n          inlinedPlayerInfo = await this._inlineResourcesInHtml(infoDiv.innerHTML, file.path);\n        }\n        \n        // Build combined HTML with special layout (without player info - we send that separately)\n        const combinedHtml = this._buildNoteProjectionHtml(inlinedImage, '');\n        \n        // Open popout and wait for ready\n        this.openPopout(true);\n        await this._sendToPopoutWhenReady({ \n          plugin: 'vtt-card-display', \n          type: 'showHTML', \n          html: combinedHtml, \n          title: item.title || file.basename,\n          playerInfo: inlinedPlayerInfo || ''\n        });\n      }\n    } catch (e: any) { new Notice('Error projecting item: ' + (e && e.message)); }\n  }\n\n  async projectCurrentFileAsRendered() {\n    const file: any = this.app.workspace.getActiveFile();\n    if (!file) { new Notice('No active file'); return; }\n    const content = await this.app.vault.read(file);\n    // Open the popout immediately to preserve the user gesture (avoid popup blockers)\n    this.openPopout(true);\n    const div = document.createElement('div');\n    await MarkdownRenderer.renderMarkdown(content, div, file.path, this);\n    setTimeout(async () => {\n      const selectors = (this.settings.statblockSelectors && this.settings.statblockSelectors.trim())\n        ? this.settings.statblockSelectors.split(',').map((s: string) => s.trim()).filter(Boolean)\n        : ['.statblock', '.stat-block', '.quickmonster', '.qm', '.statblock-render', '.statblock-container'];\n      let found: HTMLElement | null = null;\n      for (const s of selectors) {\n        try {\n          const el = div.querySelector(s) as HTMLElement;\n          if (el) { found = el; break; }\n        } catch (e) { /* invalid selector - ignore */ }\n      }\n\n      let html: string;\n      if (found && found.innerHTML) {\n        html = found.outerHTML;\n      } else {\n        // Fallback: look for fenced statblock code block in the source markdown\n        const codeMatch = content.match(/```(?:statblock|stat-block)\\n([\\s\\S]*?)```/i);\n        if (codeMatch) {\n          const tmp = document.createElement('div');\n          await MarkdownRenderer.renderMarkdown(codeMatch[0], tmp, file.path, this);\n          html = tmp.innerHTML || div.innerHTML;\n        } else {\n          html = div.innerHTML;\n        }\n      }\n\n      this.openPopout(true);\n      const inlined = await this._inlineResourcesInHtml(html);\n      await this._sendToPopoutWhenReady({ plugin: 'vtt-card-display', type: 'showHTML', html: inlined, title: file.basename });\n    }, 120);\n  }\n\n  /** Wait for popout window to be ready and send a message */\n  async _sendToPopoutWhenReady(message: any, maxWaitMs: number = 2000): Promise<boolean> {\n    \n    const startTime = Date.now();\n    const checkInterval = 50;\n    \n    while (Date.now() - startTime < maxWaitMs) {\n      if (this.popoutWindow && !this.popoutWindow.closed) {\n        try {\n          \n          this.popoutWindow.postMessage(message, '*');\n          // Set suppress flag to prevent requestCurrent from overwriting\n          (this as any)._suppressNextRequest = true;\n          setTimeout(() => { (this as any)._suppressNextRequest = false; }, 500);\n          return true;\n        } catch (e) {\n          \n        }\n      }\n      await new Promise(resolve => setTimeout(resolve, checkInterval));\n    }\n    \n    return false;\n  }\n\n  /**\n   * Project any note file as a map/note to the popout display.\n   * This works for any note in the vault, not just registered maps.\n   * Used by the ```vtt-project``` code block.\n   * @param notePath Path to the note file\n   */\n  async projectNoteByPath(notePath: string) {\n    \n    const file: any = this.app.vault.getAbstractFileByPath(notePath);\n    if (!file) { \n      new (globalThis as any).Notice('Note not found: ' + notePath); \n      return; \n    }\n    \n    const rawContent = await this.app.vault.read(file);\n    \n    \n    \n    const noteDir = (file.parent && file.parent.path) ? file.parent.path : '';\n    \n    // Get title from filename without extension\n    const title = file.basename || notePath.split('/').pop()?.replace('.md', '') || 'Note';\n    \n    // Parse the note into image and text sections\n    const showPlayerInfo = this.settings.showPlayerInfo ?? true; // Default to true if not set\n    \n    const { imageContent, playerInfoContent } = this._parseNoteContent(rawContent, showPlayerInfo);\n    \n    \n    \n    \n    \n    // Resolve ![[image]] and ![[video]] links in image content\n    const resolvedImageContent = this._resolveEmbeddedMedia(imageContent, noteDir);\n    \n    \n    \n    \n    \n    // Render image/video part\n    const imageDiv = document.createElement('div');\n    await MarkdownRenderer.renderMarkdown(resolvedImageContent, imageDiv, file.path, this);\n    \n    \n    const inlinedImage = await this._inlineResourcesInHtml(imageDiv.innerHTML, file.path);\n    \n    \n    \n    // Render player info part if present\n    let inlinedPlayerInfo = '';\n    if (playerInfoContent.trim()) {\n      const infoDiv = document.createElement('div');\n      await MarkdownRenderer.renderMarkdown(playerInfoContent, infoDiv, file.path, this);\n      inlinedPlayerInfo = await this._inlineResourcesInHtml(infoDiv.innerHTML, file.path);\n    }\n    \n    // Build combined HTML with special layout (without player info - we send that separately)\n    const combinedHtml = this._buildNoteProjectionHtml(inlinedImage, '');\n    \n    // Open popout and wait for it to be ready before sending\n    this.openPopout(true);\n    await this._sendToPopoutWhenReady({ \n      plugin: 'vtt-card-display', \n      type: 'showHTML', \n      html: combinedHtml, \n      title,\n      playerInfo: inlinedPlayerInfo || ''\n    });\n    (this as any)._suppressNextRequest = true; \n    setTimeout(() => { (this as any)._suppressNextRequest = false; }, 1000);\n  }\n\n  async projectMapByPath(mapPath: string) {\n    const entry = (this.maps || []).find((m: any) => m.path === mapPath);\n    if (!entry) { new (globalThis as any).Notice('Map not found: ' + mapPath); return; }\n    if (entry.path && entry.path.toLowerCase().endsWith('.md')) {\n      const file: any = this.app.vault.getAbstractFileByPath(entry.path);\n      if (!file) { new (globalThis as any).Notice('Map note not found: ' + entry.path); return; }\n      const rawContent = await this.app.vault.read(file);\n      const mapDir = (file.parent && file.parent.path) ? file.parent.path : '';\n      \n      // Parse the note into image and text sections (same as note projection)\n      const { imageContent, playerInfoContent } = this._parseNoteContent(rawContent, this.settings.showPlayerInfo || false);\n      \n      // Resolve ![[image]] and ![[video]] links in image content\n      const resolvedImageContent = this._resolveEmbeddedMedia(imageContent, mapDir);\n      \n      \n      \n      // Render image/video part\n      const imageDiv = document.createElement('div');\n      await MarkdownRenderer.renderMarkdown(resolvedImageContent, imageDiv, file.path, this);\n      const inlinedImage = await this._inlineResourcesInHtml(imageDiv.innerHTML, file.path);\n      \n      // Render player info part if present\n      let inlinedPlayerInfo = '';\n      if (playerInfoContent.trim()) {\n        const infoDiv = document.createElement('div');\n        await MarkdownRenderer.renderMarkdown(playerInfoContent, infoDiv, file.path, this);\n        inlinedPlayerInfo = await this._inlineResourcesInHtml(infoDiv.innerHTML, file.path);\n      }\n      \n      // Build combined HTML with special layout (without player info - we send that separately)\n      const combinedHtml = this._buildNoteProjectionHtml(inlinedImage, '');\n      \n      \n      \n      // Open popout and wait for it to be ready before sending\n      this.openPopout(true);\n      await this._sendToPopoutWhenReady({ \n        plugin: 'vtt-card-display', \n        type: 'showHTML', \n        html: combinedHtml, \n        title: entry.title,\n        playerInfo: inlinedPlayerInfo || ''\n      });\n      (this as any)._suppressNextRequest = true; setTimeout(() => { (this as any)._suppressNextRequest = false; }, 1000);\n    } else {\n      // Image/video map\n      let src = entry.src;\n      \n      // Check if this is an in-app popout (can use app:// URLs directly)\n      const isInAppPopout = this.popoutWindow === this.inAppWindowProxy;\n      \n      // For in-app popouts, we can use app:// URLs directly\n      if (isInAppPopout && src && src.startsWith('app://')) {\n        this.openPopout(true);\n        await this._sendToPopoutWhenReady({ plugin: 'vtt-card-display', type: 'show', kind: 'map', src, title: entry.title });\n        (this as any)._suppressNextRequest = true; setTimeout(() => { (this as any)._suppressNextRequest = false; }, 1000);\n        return;\n      }\n      \n      // For external popouts, convert to data URL\n      try { \n        if (entry.path) {\n          src = await this._convertFileToDataUrl(entry.path);\n        }\n      } catch (e) { }\n      \n      // Open popout and wait for it to be ready before sending\n      this.openPopout(true);\n      await this._sendToPopoutWhenReady({ plugin: 'vtt-card-display', type: 'show', kind: 'map', src, title: entry.title });\n      (this as any)._suppressNextRequest = true; setTimeout(() => { (this as any)._suppressNextRequest = false; }, 1000);\n    }\n  }\n\n  async projectFirstImageInCurrentFile() {\n    const file: any = this.app.workspace.getActiveFile();\n    if (!file) { new Notice('No active file'); return; }\n    const md = await this.app.vault.read(file);\n    const m = md.match(/!\\[[^\\]]*\\]\\(([^)]+)\\)/);\n    if (!m) { new (globalThis as any).Notice('No image found in note'); return; }\n    const imgPath = m[1];\n    const target = this.app.vault.getAbstractFileByPath(imgPath) || this.app.vault.getAbstractFileByPath((file.parent && file.parent.path ? file.parent.path + '/' : '') + imgPath);\n    if (!target) { new (globalThis as any).Notice('Image not found: ' + imgPath); return; }\n    let src = this.app.vault.getResourcePath(target);\n    // Convert to data URL for external popout\n    try { src = await this._convertFileToDataUrl((target as any).path); } catch (e) { }\n    this.openPopout(true);\n    await this._sendToPopoutWhenReady({ plugin: 'vtt-card-display', type: 'show', kind: 'image', src, title: file.basename });\n  }\n\n  async savePopoutPosition() {\n    if (!this.popoutWindow || this.popoutWindow.closed) { new (globalThis as any).Notice('No popout open'); return; }\n    try {\n      const left = typeof (this.popoutWindow as any).screenX !== 'undefined' ? (this.popoutWindow as any).screenX : (this.popoutWindow as any).screenLeft || 0;\n      const top = typeof (this.popoutWindow as any).screenY !== 'undefined' ? (this.popoutWindow as any).screenY : (this.popoutWindow as any).screenTop || 0;\n      const width = (this.popoutWindow as any).outerWidth || (this.popoutWindow as any).innerWidth || this.settings.popoutWidth;\n      const height = (this.popoutWindow as any).outerHeight || (this.popoutWindow as any).innerHeight || this.settings.popoutHeight;\n      this.settings.popoutLeft = left; this.settings.popoutTop = top; this.settings.popoutWidth = width; this.settings.popoutHeight = height;\n      await this.saveData(this.settings);\n      new (globalThis as any).Notice('Saved popout position');\n    } catch (e) { new (globalThis as any).Notice('Error saving popout position'); }\n  }\n\n  async movePopoutToSecondMonitor() {\n    try {\n      const left = (window.screen && window.screen.width) ? (window.screen.width + 10) : (this.settings.popoutLeft + 1920);\n      this.settings.popoutLeft = left;\n      await this.saveData(this.settings);\n      if (this.popoutWindow && !this.popoutWindow.closed && typeof (this.popoutWindow as any).moveTo === 'function') (this.popoutWindow as any).moveTo(this.settings.popoutLeft, this.settings.popoutTop);\n      new (globalThis as any).Notice('Moved popout position to approx second monitor');\n    } catch (e) { new (globalThis as any).Notice('Could not move popout'); }\n  }\n\n  async openViewerPane() {\n    try {\n      const leaf = this.app.workspace.getRightLeaf(false);\n      await leaf.setViewState({ type: 'vtt-card-view', active: true });\n      this.app.workspace.revealLeaf(leaf);\n    } catch (e) { }\n  }\n\n  /**\n   * Open a modal to search for D&D monster images\n   */\n  openMonsterImageSearch() {\n    new MonsterImageSearchModal(this.app, this).open();\n  }\n\n  /**\n   * Open a modal to search for battle maps\n   */\n  openBattleMapSearch() {\n    new BattleMapSearchModal(this.app, this).open();\n  }\n\n  /**\n   * Search for monster images using multiple sources\n   */\n  async searchMonsterImages(monsterName: string): Promise<{ url: string; source: string; title: string }[]> {\n    const results: { url: string; source: string; title: string }[] = [];\n    \n    try {\n      // Run searches in parallel for speed - use imported functions\n      const [localResults, dndBeyondResults, fandomResults, artStationResults, deviantArtResults, redditResults] = await Promise.all([\n        searchLocalVault(this.app.vault, monsterName),\n        searchDndBeyond(monsterName),\n        searchFandomWikis(monsterName),\n        searchArtStation(monsterName),\n        searchDeviantArt(monsterName),\n        searchReddit(monsterName),\n      ]);\n      \n      // Add results in priority order (local first, then online)\n      results.push(...localResults);\n      results.push(...dndBeyondResults);\n      results.push(...fandomResults);\n      results.push(...artStationResults);\n      results.push(...deviantArtResults);\n      results.push(...redditResults);\n      \n    } catch (e) {\n      \n    }\n    \n    // Remove duplicates\n    return deduplicateResults(results);\n  }\n\n  /**\n   * Project a monster image directly to the popout\n   */\n  async projectMonsterImage(imageUrl: string, monsterName: string) {\n    try {\n      // Try to fetch and convert to data URL for better compatibility\n      let src = imageUrl;\n      try {\n        const response = await fetch(imageUrl);\n        if (response.ok) {\n          const blob = await response.blob();\n          src = await new Promise((resolve) => {\n            const reader = new FileReader();\n            reader.onloadend = () => resolve(reader.result as string);\n            reader.readAsDataURL(blob);\n          });\n        }\n      } catch (e) {\n        \n      }\n      \n      // Open popout with suppression to prevent requestCurrent from overwriting\n      this.openPopout(true);\n      \n      // Force send to popout - use _sendToPopoutWhenReady to handle timing\n      const message = { \n        plugin: 'vtt-card-display', \n        type: 'show', \n        kind: 'image', \n        src, \n        title: monsterName \n      };\n      \n      // Always use _sendToPopoutWhenReady for reliable delivery\n      \n      await this._sendToPopoutWhenReady(message);\n      \n    } catch (e) {\n      \n      new Notice('Failed to project monster image');\n    }\n  }\n\n  /**\n   * Download and save a monster image to the vault\n   * Uses Obsidian's requestUrl to bypass CORS restrictions\n   */\n  async saveMonsterImage(imageUrl: string, monsterName: string): Promise<string | null> {\n    try {\n      // Use Obsidian's requestUrl to bypass CORS\n      const response = await requestUrl({ url: imageUrl, method: 'GET' });\n      \n      if (!response.arrayBuffer || response.arrayBuffer.byteLength === 0) {\n        throw new Error('Could not fetch image');\n      }\n      \n      const arrayBuffer = response.arrayBuffer;\n      const contentType = (response.headers['content-type'] || '').toLowerCase();\n      \n      // First try to get extension from URL\n      let ext = '';\n      const urlLower = imageUrl.toLowerCase();\n      const urlMatch = urlLower.match(/\\.([a-z0-9]+)(?:\\?|$)/);\n      if (urlMatch) {\n        const urlExt = urlMatch[1];\n        if (['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(urlExt)) {\n          ext = urlExt === 'jpeg' ? 'jpg' : urlExt;\n        }\n      }\n      \n      // If no valid extension from URL, determine from content-type\n      if (!ext) {\n        if (contentType.includes('jpeg') || contentType.includes('jpg')) {\n          ext = 'jpg';\n        } else if (contentType.includes('gif')) {\n          ext = 'gif';\n        } else if (contentType.includes('webp')) {\n          ext = 'webp';\n        } else {\n          ext = 'png';\n        }\n      }\n      \n      // Create filename (allow German umlauts)\n      const safeName = monsterName.replace(/[^a-zA-Z0-9\u00E4\u00F6\u00FC\u00C4\u00D6\u00DC\u00DF\\s\\-_]/g, '').trim().substring(0, 50) || 'monster';\n      const safeFileName = safeName.replace(/\\s+/g, '_').toLowerCase();\n      const timestamp = Date.now();\n      const fileName = `${safeFileName}_${timestamp}.${ext}`;\n      \n      // Save to Cards folder (create images subfolder if needed)\n      const cardsFolder = this.settings.folderPath || 'Cards';\n      const folderPath = `${cardsFolder}/images`;\n      const filePath = `${folderPath}/${fileName}`;\n      \n      // Create folders if needed\n      try {\n        const folder = this.app.vault.getAbstractFileByPath(cardsFolder);\n        if (!folder) {\n          await this.app.vault.createFolder(cardsFolder);\n        }\n      } catch (e) { /* folder might exist */ }\n      \n      try {\n        const imagesFolder = this.app.vault.getAbstractFileByPath(folderPath);\n        if (!imagesFolder) {\n          await this.app.vault.createFolder(folderPath);\n        }\n      } catch (e) { /* folder might exist */ }\n      \n      // Save file\n      await this.app.vault.createBinary(filePath, new Uint8Array(arrayBuffer));\n      new Notice(`Saved: ${filePath}`);\n      \n      // Reload cards to include the new image\n      await this.loadCards();\n      \n      return filePath;\n    } catch (e) {\n      console.error('Failed to save monster image:', e);\n      new Notice('Failed to save monster image - CORS or network error');\n      return null;\n    }\n  }\n\n  /**\n   * Search for battle maps from various sources\n   * @param query Search query\n   * @param animatedOnly If true, only return animated maps (GIF, MP4, WebM)\n   */\n  async searchBattleMaps(query: string, animatedOnly: boolean = false): Promise<Array<{url: string, title: string, source: string, thumbnail?: string}>> {\n    const results: Array<{url: string, title: string, source: string, thumbnail?: string}> = [];\n    \n    // Search multiple sources in parallel\n    const searches = await Promise.allSettled([\n      this._searchRedditBattlemaps(query, animatedOnly),\n      this._searchRedditAnimatedMaps(query, animatedOnly), // Additional animated search\n      this._search2MinuteTabletop(query, animatedOnly), // 2-Minute Tabletop\n      this._searchDynamicDungeons(query, animatedOnly), // Dynamic Dungeons for animated\n      this._searchDeviantArtMaps(query, animatedOnly),\n      this._searchImgurMaps(query, animatedOnly),\n    ]);\n    \n    for (const result of searches) {\n      if (result.status === 'fulfilled' && result.value) {\n        results.push(...result.value);\n      }\n    }\n    \n    // Remove duplicates based on URL\n    const seen = new Set<string>();\n    return results.filter(r => {\n      if (seen.has(r.url)) return false;\n      seen.add(r.url);\n      return true;\n    });\n  }\n\n  /**\n   * Additional search specifically for animated battle maps\n   */\n  async _searchRedditAnimatedMaps(query: string, animatedOnly: boolean): Promise<Array<{url: string, title: string, source: string, thumbnail?: string}>> {\n    // Only run this search when looking for animated content\n    if (!animatedOnly) return [];\n    \n    const results: Array<{url: string, title: string, source: string, thumbnail?: string}> = [];\n    try {\n      // Search multiple animated-focused queries\n      const searches = [\n        `${query} animated`,\n        `${query} gif`,\n        `animated battle map ${query}`,\n      ];\n      \n      for (const searchTerms of searches) {\n        const searchQuery = encodeURIComponent(searchTerms);\n        const url = `https://www.reddit.com/r/battlemaps+dndmaps+dungeondraft/search.json?q=${searchQuery}&restrict_sr=1&limit=25&sort=top&t=year`;\n        \n        const response = await fetch(url, {\n          headers: { 'User-Agent': 'ObsidianVTTCardDisplay/1.0' }\n        });\n        \n        if (response.ok) {\n          const data = await response.json();\n          const posts = data?.data?.children || [];\n          \n          for (const post of posts) {\n            const postData = post.data;\n            if (!postData) continue;\n            \n            let imageUrl = '';\n            let thumbnail = '';\n            let isAnimated = false;\n            \n            // Get thumbnail for preview\n            if (postData.preview?.images?.[0]?.source?.url) {\n              thumbnail = postData.preview.images[0].source.url.replace(/&amp;/g, '&');\n            } else if (postData.thumbnail && postData.thumbnail.startsWith('http')) {\n              thumbnail = postData.thumbnail;\n            }\n            \n            // Check for video content\n            if (postData.is_video && postData.media?.reddit_video?.fallback_url) {\n              imageUrl = postData.media.reddit_video.fallback_url;\n              isAnimated = true;\n            } else if (postData.url && /\\.gif$/i.test(postData.url)) {\n              imageUrl = postData.url;\n              isAnimated = true;\n            } else if (postData.preview?.images?.[0]?.variants?.mp4?.source?.url) {\n              imageUrl = postData.preview.images[0].variants.mp4.source.url.replace(/&amp;/g, '&');\n              isAnimated = true;\n            } else if (postData.preview?.images?.[0]?.variants?.gif?.source?.url) {\n              imageUrl = postData.preview.images[0].variants.gif.source.url.replace(/&amp;/g, '&');\n              isAnimated = true;\n            }\n            \n            if (isAnimated && imageUrl) {\n              results.push({\n                url: imageUrl,\n                title: postData.title || 'Animated Battle Map',\n                source: 'Reddit (Animated)',\n                thumbnail: thumbnail || undefined\n              });\n            }\n          }\n        }\n      }\n    } catch (e) {\n      \n    }\n    return results;\n  }\n\n  /**\n   * Search Reddit r/battlemaps for map images\n   * @param animatedOnly If true, search for animated maps only\n   */\n  async _searchRedditBattlemaps(query: string, animatedOnly: boolean = false): Promise<Array<{url: string, title: string, source: string, thumbnail?: string}>> {\n    const results: Array<{url: string, title: string, source: string, thumbnail?: string}> = [];\n    try {\n      // Build search query - for animated, search with \"animated\" keyword and sort by top\n      const searchTerms = animatedOnly \n        ? `${query} animated`\n        : `${query} battle map`;\n      const searchQuery = encodeURIComponent(searchTerms);\n      \n      // Search subreddits - include animated-focused subreddits when searching for animated\n      const subreddit = animatedOnly ? 'battlemaps+dndmaps' : 'battlemaps';\n      // For animated, sort by top of all time to get better results\n      const sortParam = animatedOnly ? 'top&t=all' : 'relevance';\n      const url = `https://www.reddit.com/r/${subreddit}/search.json?q=${searchQuery}&restrict_sr=1&limit=50&sort=${sortParam}`;\n      \n      \n      \n      const response = await fetch(url, {\n        headers: { 'User-Agent': 'ObsidianVTTCardDisplay/1.0' }\n      });\n      \n      if (response.ok) {\n        const data = await response.json();\n        const posts = data?.data?.children || [];\n        \n        \n        for (const post of posts) {\n          const postData = post.data;\n          if (!postData) continue;\n          \n          // Check for direct image/video URLs\n          let imageUrl = '';\n          let isAnimated = false;\n          \n          const isAnimatedUrl = (url: string) => /\\.(gif|mp4|webm|gifv)$/i.test(url) || url.includes('v.redd.it');\n          const isImageUrl = (url: string) => /\\.(jpg|jpeg|png|gif|webp|mp4|webm|gifv)$/i.test(url);\n          \n          // Check for video content (Reddit hosted videos) - these are animated!\n          if (postData.is_video && postData.media?.reddit_video?.fallback_url) {\n            imageUrl = postData.media.reddit_video.fallback_url;\n            isAnimated = true;\n          } else if (postData.url && postData.url.includes('v.redd.it')) {\n            // v.redd.it video - try to get the fallback URL\n            if (postData.media?.reddit_video?.fallback_url) {\n              imageUrl = postData.media.reddit_video.fallback_url;\n            } else {\n              // Try secure_media as fallback\n              imageUrl = postData.secure_media?.reddit_video?.fallback_url || '';\n            }\n            isAnimated = true;\n            \n          } else if (postData.url && /\\.gif$/i.test(postData.url)) {\n            // Direct GIF URL\n            imageUrl = postData.url;\n            isAnimated = true;\n            \n          } else if (postData.url && isImageUrl(postData.url)) {\n            // Handle gifv -> mp4 conversion for imgur\n            if (postData.url.endsWith('.gifv')) {\n              imageUrl = postData.url.replace('.gifv', '.mp4');\n              isAnimated = true;\n            } else {\n              imageUrl = postData.url;\n              isAnimated = isAnimatedUrl(postData.url);\n            }\n          } else if (postData.preview?.images?.[0]?.variants?.mp4?.source?.url) {\n            // Reddit's mp4 variant - this is animated\n            imageUrl = postData.preview.images[0].variants.mp4.source.url.replace(/&amp;/g, '&');\n            isAnimated = true;\n            \n          } else if (postData.preview?.images?.[0]?.variants?.gif?.source?.url) {\n            // Reddit's gif variant - this is animated\n            imageUrl = postData.preview.images[0].variants.gif.source.url.replace(/&amp;/g, '&');\n            isAnimated = true;\n            \n          } else if (!animatedOnly) {\n            // Only try static fallbacks if not searching for animated only\n            if (postData.preview?.images?.[0]?.source?.url) {\n              imageUrl = postData.preview.images[0].source.url.replace(/&amp;/g, '&');\n            } else if (postData.thumbnail && postData.thumbnail.startsWith('http')) {\n              if (postData.url_overridden_by_dest && isImageUrl(postData.url_overridden_by_dest)) {\n                imageUrl = postData.url_overridden_by_dest;\n              }\n            }\n          }\n          \n          // Get thumbnail for videos (preview image)\n          let thumbnail = '';\n          if (postData.preview?.images?.[0]?.source?.url) {\n            thumbnail = postData.preview.images[0].source.url.replace(/&amp;/g, '&');\n          } else if (postData.thumbnail && postData.thumbnail.startsWith('http') && postData.thumbnail !== 'self' && postData.thumbnail !== 'default') {\n            thumbnail = postData.thumbnail;\n          }\n          \n          // Filter for animated only if requested\n          if (animatedOnly && !isAnimated) {\n            \n            continue;\n          }\n          \n          if (imageUrl) {\n            \n            results.push({\n              url: imageUrl,\n              title: postData.title || 'Battle Map',\n              source: isAnimated ? 'Reddit (Animated)' : 'Reddit r/battlemaps',\n              thumbnail: (isAnimated && thumbnail) ? thumbnail : undefined\n            });\n          }\n        }\n      }\n      \n    } catch (e) {\n      \n    }\n    return results;\n  }\n\n  /**\n   * Search DeviantArt for battle maps\n   * @param animatedOnly If true, only return animated content\n   */\n  /**\n   * Search 2-Minute Tabletop for battle maps\n   * Popular battle map creator site\n   */\n  async _search2MinuteTabletop(query: string, animatedOnly: boolean): Promise<Array<{url: string, title: string, source: string, thumbnail?: string}>> {\n    // 2-Minute Tabletop mostly has static maps\n    if (animatedOnly) return [];\n    \n    const results: Array<{url: string, title: string, source: string, thumbnail?: string}> = [];\n    try {\n      // Search via their site's search or via Google site search\n      const searchTerms = encodeURIComponent(`site:2minutetabletop.com ${query} battle map`);\n      const url = `https://www.google.com/search?q=${searchTerms}&tbm=isch`;\n      \n      // Alternative: try to fetch from their Patreon/main site RSS or search\n      // Since direct scraping is unreliable, we search Reddit for 2minutetabletop mentions\n      const redditUrl = `https://www.reddit.com/r/battlemaps/search.json?q=${encodeURIComponent(query + ' 2minutetabletop OR 2-minute')}&restrict_sr=1&limit=15&sort=top&t=year`;\n      \n      const response = await fetch(redditUrl, {\n        headers: { 'User-Agent': 'ObsidianVTTCardDisplay/1.0' }\n      });\n      \n      if (response.ok) {\n        const data = await response.json();\n        const posts = data?.data?.children || [];\n        \n        for (const post of posts) {\n          const postData = post.data;\n          if (!postData) continue;\n          \n          // Look for image URLs\n          let imageUrl = '';\n          if (postData.url && /\\.(jpg|jpeg|png|webp)$/i.test(postData.url)) {\n            imageUrl = postData.url;\n          } else if (postData.preview?.images?.[0]?.source?.url) {\n            imageUrl = postData.preview.images[0].source.url.replace(/&amp;/g, '&');\n          }\n          \n          if (imageUrl && (postData.title?.toLowerCase().includes('2minute') || postData.title?.toLowerCase().includes('2-minute') || postData.url?.includes('2minutetabletop'))) {\n            results.push({\n              url: imageUrl,\n              title: postData.title || 'Battle Map',\n              source: '2-Minute Tabletop',\n              thumbnail: postData.thumbnail && postData.thumbnail.startsWith('http') ? postData.thumbnail : undefined\n            });\n          }\n        }\n      }\n    } catch (e) {\n      \n    }\n    return results;\n  }\n\n  /**\n   * Search Dynamic Dungeons for animated battle maps\n   * Known source for animated/video battle maps\n   */\n  async _searchDynamicDungeons(query: string, animatedOnly: boolean): Promise<Array<{url: string, title: string, source: string, thumbnail?: string}>> {\n    const results: Array<{url: string, title: string, source: string, thumbnail?: string}> = [];\n    try {\n      // Search Reddit for dynamic dungeons animated maps\n      const searchTerms = animatedOnly \n        ? `${query} dynamic dungeons animated OR video`\n        : `${query} dynamic dungeons`;\n      const redditUrl = `https://www.reddit.com/r/battlemaps+dndmaps+FoundryVTT/search.json?q=${encodeURIComponent(searchTerms)}&restrict_sr=1&limit=20&sort=top&t=year`;\n      \n      const response = await fetch(redditUrl, {\n        headers: { 'User-Agent': 'ObsidianVTTCardDisplay/1.0' }\n      });\n      \n      if (response.ok) {\n        const data = await response.json();\n        const posts = data?.data?.children || [];\n        \n        for (const post of posts) {\n          const postData = post.data;\n          if (!postData) continue;\n          \n          let imageUrl = '';\n          let thumbnail = '';\n          let isAnimated = false;\n          \n          // Get thumbnail\n          if (postData.preview?.images?.[0]?.source?.url) {\n            thumbnail = postData.preview.images[0].source.url.replace(/&amp;/g, '&');\n          } else if (postData.thumbnail && postData.thumbnail.startsWith('http')) {\n            thumbnail = postData.thumbnail;\n          }\n          \n          // Check for video/animated content\n          if (postData.is_video && postData.media?.reddit_video?.fallback_url) {\n            imageUrl = postData.media.reddit_video.fallback_url;\n            isAnimated = true;\n          } else if (postData.url && /\\.gif$/i.test(postData.url)) {\n            imageUrl = postData.url;\n            isAnimated = true;\n          } else if (postData.preview?.images?.[0]?.variants?.mp4?.source?.url) {\n            imageUrl = postData.preview.images[0].variants.mp4.source.url.replace(/&amp;/g, '&');\n            isAnimated = true;\n          } else if (!animatedOnly && postData.url && /\\.(jpg|jpeg|png|webp)$/i.test(postData.url)) {\n            imageUrl = postData.url;\n          } else if (!animatedOnly && postData.preview?.images?.[0]?.source?.url) {\n            imageUrl = postData.preview.images[0].source.url.replace(/&amp;/g, '&');\n          }\n          \n          // Only add if relevant to dynamic dungeons style content\n          const title = postData.title?.toLowerCase() || '';\n          const isDynamic = title.includes('dynamic') || title.includes('animated') || title.includes('video') || postData.url?.includes('dynamic');\n          \n          if (imageUrl && (!animatedOnly || isAnimated) && (isDynamic || isAnimated)) {\n            results.push({\n              url: imageUrl,\n              title: postData.title || 'Animated Battle Map',\n              source: 'Dynamic Dungeons',\n              thumbnail: thumbnail || undefined\n            });\n          }\n        }\n      }\n      \n      // Also search for living maps / animated battlemaps subreddit\n      if (animatedOnly) {\n        const livingMapsUrl = `https://www.reddit.com/r/LivingBattleMaps+animatedbattlemaps/search.json?q=${encodeURIComponent(query)}&restrict_sr=1&limit=15&sort=top&t=year`;\n        \n        const response2 = await fetch(livingMapsUrl, {\n          headers: { 'User-Agent': 'ObsidianVTTCardDisplay/1.0' }\n        });\n        \n        if (response2.ok) {\n          const data = await response2.json();\n          const posts = data?.data?.children || [];\n          \n          for (const post of posts) {\n            const postData = post.data;\n            if (!postData) continue;\n            \n            let imageUrl = '';\n            let thumbnail = '';\n            \n            if (postData.preview?.images?.[0]?.source?.url) {\n              thumbnail = postData.preview.images[0].source.url.replace(/&amp;/g, '&');\n            } else if (postData.thumbnail && postData.thumbnail.startsWith('http')) {\n              thumbnail = postData.thumbnail;\n            }\n            \n            if (postData.is_video && postData.media?.reddit_video?.fallback_url) {\n              imageUrl = postData.media.reddit_video.fallback_url;\n            } else if (postData.url && /\\.gif$/i.test(postData.url)) {\n              imageUrl = postData.url;\n            } else if (postData.preview?.images?.[0]?.variants?.mp4?.source?.url) {\n              imageUrl = postData.preview.images[0].variants.mp4.source.url.replace(/&amp;/g, '&');\n            }\n            \n            if (imageUrl) {\n              results.push({\n                url: imageUrl,\n                title: postData.title || 'Animated Battle Map',\n                source: 'Living Battle Maps',\n                thumbnail: thumbnail || undefined\n              });\n            }\n          }\n        }\n      }\n    } catch (e) {\n      \n    }\n    return results;\n  }\n\n  /**\n   * Search DeviantArt for battle maps\n   * @param animatedOnly If true, only return animated content\n   */\n  async _searchDeviantArtMaps(query: string, animatedOnly: boolean = false): Promise<Array<{url: string, title: string, source: string}>> {\n    const results: Array<{url: string, title: string, source: string}> = [];\n    \n    // DeviantArt doesn't have many animated battle maps, skip if animated only\n    if (animatedOnly) {\n      return results;\n    }\n    \n    try {\n      const searchQuery = encodeURIComponent(query + ' battlemap battle map dnd rpg');\n      const url = `https://backend.deviantart.com/rss.xml?type=deviation&q=${searchQuery}`;\n      \n      const response = await fetch(url);\n      if (response.ok) {\n        const text = await response.text();\n        const parser = new DOMParser();\n        const doc = parser.parseFromString(text, 'text/xml');\n        const items = doc.querySelectorAll('item');\n        \n        items.forEach((item, index) => {\n          if (index >= 15) return; // Limit results\n          \n          const title = item.querySelector('title')?.textContent || 'Battle Map';\n          // Look for media:content or media:thumbnail\n          const mediaContent = item.querySelector('content[url]');\n          const mediaThumbnail = item.querySelector('thumbnail[url]');\n          \n          let imageUrl = '';\n          if (mediaContent) {\n            imageUrl = mediaContent.getAttribute('url') || '';\n          } else if (mediaThumbnail) {\n            imageUrl = mediaThumbnail.getAttribute('url') || '';\n          }\n          \n          // Try to get larger image from description\n          const description = item.querySelector('description')?.textContent || '';\n          const imgMatch = description.match(/src=\"([^\"]+)\"/);\n          if (imgMatch && imgMatch[1]) {\n            imageUrl = imgMatch[1];\n          }\n          \n          if (imageUrl) {\n            results.push({\n              url: imageUrl,\n              title: title,\n              source: 'DeviantArt'\n            });\n          }\n        });\n      }\n    } catch (e) {\n      \n    }\n    return results;\n  }\n\n  /**\n   * Search Imgur for battle maps\n   * @param animatedOnly If true, only return animated content (GIF/MP4)\n   */\n  async _searchImgurMaps(query: string, animatedOnly: boolean = false): Promise<Array<{url: string, title: string, source: string}>> {\n    const results: Array<{url: string, title: string, source: string}> = [];\n    try {\n      // Add animated keyword if searching for animated\n      const searchTerms = animatedOnly \n        ? query + ' animated battlemap battle map gif'\n        : query + ' battlemap battle map dnd';\n      const searchQuery = encodeURIComponent(searchTerms);\n      const url = `https://imgur.com/search?q=${searchQuery}`;\n      \n      const response = await fetch(url);\n      if (response.ok) {\n        const html = await response.text();\n        // Look for image IDs in the response\n        const idMatches = html.matchAll(/data-id=\"([a-zA-Z0-9]+)\"/g);\n        let count = 0;\n        for (const match of idMatches) {\n          if (count >= 10) break;\n          const id = match[1];\n          if (id) {\n            results.push({\n              url: `https://i.imgur.com/${id}.jpg`,\n              title: `Map ${id}`,\n              source: 'Imgur'\n            });\n            count++;\n          }\n        }\n      }\n    } catch (e) {\n      \n    }\n    return results;\n  }\n\n  /**\n   * Project a battle map image directly to the popout\n   */\n  async projectBattleMapImage(imageUrl: string, mapName: string) {\n    try {\n      // Use Obsidian's requestUrl to bypass CORS\n      let src = imageUrl;\n      \n      try {\n        const response = await requestUrl({ url: imageUrl, method: 'GET' });\n        if (response.arrayBuffer && response.arrayBuffer.byteLength > 0) {\n          // Convert to base64 data URL\n          const contentType = response.headers['content-type'] || 'image/png';\n          const base64 = arrayBufferToBase64(response.arrayBuffer);\n          src = `data:${contentType};base64,${base64}`;\n          \n        }\n      } catch (e) {\n        \n      }\n      \n      this.openPopout(true);\n      \n      const message = { \n        plugin: 'vtt-card-display', \n        type: 'show', \n        kind: 'map', \n        src, \n        title: mapName \n      };\n      \n      \n      await this._sendToPopoutWhenReady(message);\n      \n    } catch (e) {\n      \n      new Notice('Failed to project battle map');\n    }\n  }\n\n  /**\n   * Download and save a battle map image to the vault and create a map note\n   */\n  async saveBattleMapImage(imageUrl: string, mapName: string): Promise<string | null> {\n    try {\n      \n      \n      // Use Obsidian's requestUrl to bypass CORS\n      const response = await requestUrl({ url: imageUrl, method: 'GET' });\n      \n      if (!response.arrayBuffer || response.arrayBuffer.byteLength === 0) {\n        throw new Error('Could not fetch image');\n      }\n      \n      \n      const contentType = (response.headers['content-type'] || '').toLowerCase();\n      const arrayBuffer = response.arrayBuffer;\n      \n      // First try to get extension from URL\n      let ext = '';\n      const urlLower = imageUrl.toLowerCase();\n      const urlMatch = urlLower.match(/\\.([a-z0-9]+)(?:\\?|$)/);\n      if (urlMatch) {\n        const urlExt = urlMatch[1];\n        // Validate known extensions\n        if (['jpg', 'jpeg', 'png', 'gif', 'webp', 'mp4', 'webm', 'mov', 'gifv'].includes(urlExt)) {\n          ext = urlExt === 'jpeg' ? 'jpg' : urlExt === 'gifv' ? 'mp4' : urlExt;\n        }\n      }\n      \n      // If no valid extension from URL, determine from content-type\n      if (!ext) {\n        if (contentType.includes('jpeg') || contentType.includes('jpg')) {\n          ext = 'jpg';\n        } else if (contentType.includes('gif')) {\n          ext = 'gif';\n        } else if (contentType.includes('webp')) {\n          ext = 'webp';\n        } else if (contentType.includes('mp4') || contentType.includes('video/mp4')) {\n          ext = 'mp4';\n        } else if (contentType.includes('webm') || contentType.includes('video/webm')) {\n          ext = 'webm';\n        } else if (contentType.includes('video')) {\n          ext = 'mp4'; // Default video to mp4\n        } else {\n          ext = 'png'; // Default image to png\n        }\n      }\n      \n      \n      \n      // Clean up the name for file system (allow German umlauts)\n      const safeName = (mapName || 'Battle Map').replace(/[^a-zA-Z0-9\\s\\-_\u00E4\u00F6\u00FC\u00C4\u00D6\u00DC\u00DF]/g, '').trim().substring(0, 50) || 'Battle_Map';\n      const safeFileName = safeName.replace(/\\s+/g, '_').toLowerCase();\n      const timestamp = Date.now();\n      const imageFileName = `${safeFileName}_${timestamp}.${ext}`;\n      \n      // Save image to Maps/_resources folder\n      const folderPath = this.settings.mapsFolderPath || 'Maps';\n      const resourcesPath = `${folderPath}/_resources`;\n      const imageFilePath = `${resourcesPath}/${imageFileName}`;\n      \n      \n      \n      // Create folders if needed\n      try {\n        const folder = this.app.vault.getAbstractFileByPath(folderPath);\n        if (!folder) {\n          \n          await this.app.vault.createFolder(folderPath);\n        }\n      } catch (e) { \n        \n      }\n      \n      try {\n        const resourcesFolder = this.app.vault.getAbstractFileByPath(resourcesPath);\n        if (!resourcesFolder) {\n          \n          await this.app.vault.createFolder(resourcesPath);\n        }\n      } catch (e) { \n        \n      }\n      \n      // Save the image file\n      try {\n        await this.app.vault.createBinary(imageFilePath, new Uint8Array(arrayBuffer));\n        \n      } catch (e: any) {\n        \n        throw new Error('Failed to save image: ' + (e.message || e));\n      }\n      \n      // Create a map note with the two sections\n      const noteFileName = `${safeName}.md`;\n      const noteFilePath = `${folderPath}/${noteFileName}`;\n      \n      // Check if note already exists, add timestamp if so\n      let finalNotePath = noteFilePath;\n      const existingNote = this.app.vault.getAbstractFileByPath(noteFilePath);\n      if (existingNote) {\n        finalNotePath = `${folderPath}/${safeName}_${timestamp}.md`;\n      }\n      \n      \n      \n      // Create the note content with the image and sections\n      // Reference image from _resources subfolder (no title, just image and sections)\n      const noteContent = `![[_resources/${imageFileName}]]\n\n# Player Infos\n\n*Beschreibung f\u00FCr die Spieler...*\n\n\n\n# DM Info\n\n**Quelle:** ${mapName}\n\n*Notizen f\u00FCr den DM...*\n\n`;\n      \n      try {\n        await this.app.vault.create(finalNotePath, noteContent);\n        \n      } catch (e: any) {\n        \n        // Note creation failed but image was saved\n        new Notice(`Image saved but note creation failed: ${imageFilePath}`);\n        return imageFilePath;\n      }\n      \n      new Notice(`Map saved: ${finalNotePath}`);\n      \n      // Reload maps to include the new one\n      await this.loadMaps();\n      \n      // Open the new note\n      try {\n        const newFile = this.app.vault.getAbstractFileByPath(finalNotePath);\n        if (newFile) {\n          await this.app.workspace.getLeaf().openFile(newFile as any);\n        }\n      } catch (e) {\n        \n      }\n      \n      return finalNotePath;\n    } catch (e) {\n      \n      new Notice('Failed to save battle map');\n      return null;\n    }\n  }\n\n  _registerItemCommands() {\n    (this.settings.items || []).forEach(it => {\n      if (!it.id) return;\n      if (this._registeredItemCommands.has(it.id)) return;\n      try { this.addCommand({ id: `vtt-project-${it.id}`, name: `Project: ${it.title || it.id}`, callback: () => this.projectItemById(it.id) }); this._registeredItemCommands.add(it.id); } catch (e) { }\n    });\n  }\n}\n\nclass VttCardDisplaySettingTab extends PluginSettingTab {\n  plugin: VttCardDisplay;\n  constructor(app: any, plugin: VttCardDisplay) { super(app, plugin); this.plugin = plugin; }\n  display(): void {\n    const { containerEl } = this;\n    containerEl.empty();\n\n    new Setting(containerEl)\n      .setName('Cards folder path')\n      .setDesc('Relative path in vault to images (e.g., \"Cards\"). Leave blank to use all images in vault.')\n      .addText((text: any) => text\n        .setPlaceholder('Cards')\n        .setValue(this.plugin.settings.folderPath)\n        .onChange(async (v: any) => {\n          this.plugin.settings.folderPath = v;\n          await this.plugin.saveData(this.plugin.settings);\n          await this.plugin.loadCards();\n          await this.plugin.loadMaps();\n          this.plugin.sendCurrentToPopout();\n        }));\n\n    new Setting(containerEl)\n      .setName('Maps folder path')\n      .setDesc('Relative path in vault to map pages and media (e.g., \"Maps\"). Leave blank to use all notes/media in vault.')\n      .addText((text: any) => text\n        .setPlaceholder('Maps')\n        .setValue(this.plugin.settings.mapsFolderPath || '')\n        .onChange(async (v: any) => {\n          this.plugin.settings.mapsFolderPath = v;\n          await this.plugin.saveData(this.plugin.settings);\n          await this.plugin.loadMaps();\n        }));\n\n    new Setting(containerEl)\n      .setName('Popout left,top,width,height')\n      .addText((text: any) => text\n        .setPlaceholder('left,top,width,height')\n        .setValue(`${this.plugin.settings.popoutLeft},${this.plugin.settings.popoutTop},${this.plugin.settings.popoutWidth},${this.plugin.settings.popoutHeight}`)\n        .onChange(async (v: any) => {\n          const [l, t, w, h] = v.split(',').map((x: any) => parseInt(x.trim()) || 0);\n          this.plugin.settings.popoutLeft = l; this.plugin.settings.popoutTop = t;\n          this.plugin.settings.popoutWidth = w; this.plugin.settings.popoutHeight = h;\n          await this.plugin.saveData(this.plugin.settings);\n        }));\n\n    new Setting(containerEl)\n      .setName('Statblock selectors')\n      .setDesc('Comma-separated CSS selectors used to locate the statblock in rendered HTML (e.g. .statblock,.quickmonster).')\n      .addText((text: any) => text.setPlaceholder('.statblock,.quickmonster')\n        .setValue(this.plugin.settings.statblockSelectors || '')\n        .onChange(async (v: any) => { this.plugin.settings.statblockSelectors = v; await this.plugin.saveData(this.plugin.settings); }));\n\n    new Setting(containerEl)\n      .setName('Show Player Info')\n      .setDesc('When enabled, the \"# Player Infos\" section from notes will be shown in the popout. The \"# DM Info\" section is never shown.')\n      .addToggle((toggle: any) => toggle\n        .setValue(this.plugin.settings.showPlayerInfo || false)\n        .onChange(async (v: any) => {\n          this.plugin.settings.showPlayerInfo = v;\n          await this.plugin.saveData(this.plugin.settings);\n        }));\n\n    // Grid and Fog of War Settings\n    containerEl.createEl('h3', { text: 'Grid & Fog of War' });\n\n    new Setting(containerEl)\n      .setName('Default Grid Size')\n      .setDesc('Default size of grid squares in pixels (10-200)')\n      .addSlider((slider: any) => slider\n        .setLimits(10, 200, 5)\n        .setValue(this.plugin.settings.gridSize ?? 50)\n        .setDynamicTooltip()\n        .onChange(async (v: number) => {\n          this.plugin.settings.gridSize = v;\n          await this.plugin.saveData(this.plugin.settings);\n          this.plugin.sendSettingsToPopout();\n        }));\n\n    new Setting(containerEl)\n      .setName('Default Grid Color')\n      .setDesc('Default color of the grid overlay')\n      .addColorPicker((picker: any) => picker\n        .setValue(this.plugin.settings.gridColor ?? '#ffffff')\n        .onChange(async (v: string) => {\n          this.plugin.settings.gridColor = v;\n          await this.plugin.saveData(this.plugin.settings);\n          this.plugin.sendSettingsToPopout();\n        }));\n\n    new Setting(containerEl)\n      .setName('Default Grid Opacity')\n      .setDesc('Default opacity of the grid (5-100%)')\n      .addSlider((slider: any) => slider\n        .setLimits(5, 100, 5)\n        .setValue(Math.round((this.plugin.settings.gridOpacity ?? 0.3) * 100))\n        .setDynamicTooltip()\n        .onChange(async (v: number) => {\n          this.plugin.settings.gridOpacity = v / 100;\n          await this.plugin.saveData(this.plugin.settings);\n          this.plugin.sendSettingsToPopout();\n        }));\n\n    new Setting(containerEl)\n      .setName('Default Fog Reveal Size')\n      .setDesc('Default brush size for revealing fog of war in pixels (10-150)')\n      .addSlider((slider: any) => slider\n        .setLimits(10, 150, 5)\n        .setValue(this.plugin.settings.fogRevealSize ?? 30)\n        .setDynamicTooltip()\n        .onChange(async (v: number) => {\n          this.plugin.settings.fogRevealSize = v;\n          await this.plugin.saveData(this.plugin.settings);\n          this.plugin.sendSettingsToPopout();\n        }));\n\n    containerEl.createEl('h3', { text: 'Registered items (projectable)' });\n    const list = containerEl.createEl('div');\n    const renderList = () => {\n      list.empty();\n      (this.plugin.settings.items || []).forEach((it, idx) => {\n        const row = list.createDiv({ cls: 'vtt-item-row' });\n        row.createEl('strong', { text: it.title || it.id });\n        row.createEl('div', { text: `id: ${it.id}` });\n          const s = new Setting(row);\n          s.addDropdown((dd: any) => dd\n            .addOption('image', 'Image')\n            .addOption('card', 'Card (from Cards folder)')\n            .addOption('map', 'Map (from Maps folder)')\n            .addOption('note', 'Note (any folder)')\n            .addOption('statblock', 'Statblock (note)')\n            .addOption('note-image', 'First image in note')\n            .setValue(it.type || 'image')\n            .onChange(async (v: any) => { it.type = v as any; await this.plugin.saveData(this.plugin.settings); renderList(); }));\n          // For value: if type is 'card' or 'map', render a dropdown of available items; otherwise render a text input with file suggester\n          if (it.type === 'card' || it.type === 'map') {\n            s.addDropdown((dd2: any) => {\n              dd2.addOption('', '-- select --');\n              const itemList = it.type === 'map' ? (this.plugin.maps || []) : (this.plugin.cards || []);\n              itemList.forEach((c: any) => dd2.addOption(c.path, c.path));\n              dd2.setValue(it.value || '');\n              dd2.onChange(async (v: any) => { it.value = v; await this.plugin.saveData(this.plugin.settings); });\n            });\n          } else if (it.type === 'note') {\n            // For notes, show a text input but also add a button to pick from vault\n            s.addText((text: any) => text.setPlaceholder('path/to/note.md').setValue(it.value || '').onChange(async (v: any) => { it.value = v; await this.plugin.saveData(this.plugin.settings); }));\n            s.addButton((btn: any) => btn.setButtonText('Browse').onClick(() => {\n              // Open a simple file picker modal\n              const modal = new NotePickerModal(this.plugin.app, async (path: string) => {\n                it.value = path;\n                await this.plugin.saveData(this.plugin.settings);\n                renderList();\n              });\n              modal.open();\n            }));\n          } else {\n            s.addText((text: any) => text.setPlaceholder('value (path)').setValue(it.value || '').onChange(async (v: any) => { it.value = v; await this.plugin.saveData(this.plugin.settings); }));\n          }\n          s.addButton((bt: any) => bt.setButtonText('Delete').setWarning().onClick(async () => {\n            this.plugin.settings.items!.splice(idx, 1);\n            await this.plugin.saveData(this.plugin.settings);\n            renderList();\n          }));\n      });\n    };\n    renderList();\n\n    new Setting(containerEl)\n      .addButton((b: any) => b.setButtonText('Add item').onClick(async () => {\n        const id = `item${Date.now()}`;\n        this.plugin.settings.items = this.plugin.settings.items || [];\n        this.plugin.settings.items.push({ id, title: `Note ${this.plugin.settings.items.length + 1}`, type: 'note', value: '' });\n        await this.plugin.saveData(this.plugin.settings);\n        renderList();\n        (this.plugin as any)._registerItemCommands();\n      }));\n\n    // Small helper: create a new map page in the Maps folder\n    new Setting(containerEl)\n      .addButton((b: any) => b.setButtonText('Create Map Page').onClick(async () => {\n        const modal = new MapCreateModal(this.plugin.app, this.plugin as VttCardDisplay);\n        modal.open();\n      }));\n  }\n}\n\n/**\n * Modal to search for D&D monster images\n */\nclass MonsterImageSearchModal extends Modal {\n  plugin: VttCardDisplay;\n  searchInput: HTMLInputElement | null = null;\n  resultsContainer: HTMLElement | null = null;\n  loadingEl: HTMLElement | null = null;\n  \n  constructor(app: any, plugin: VttCardDisplay) {\n    super(app);\n    this.plugin = plugin;\n  }\n  \n  onOpen() {\n    const { contentEl } = this;\n    contentEl.empty();\n    contentEl.addClass('vtt-monster-search-modal');\n    \n    // Add styles\n    const style = contentEl.createEl('style');\n    style.textContent = `\n      .vtt-monster-search-modal { min-width: 500px; }\n      .vtt-monster-search-header { margin-bottom: 16px; }\n      .vtt-monster-search-header h2 { margin: 0 0 8px 0; }\n      .vtt-monster-search-input-row { display: flex; gap: 8px; margin-bottom: 16px; }\n      .vtt-monster-search-input { \n        flex: 1; \n        padding: 8px 12px; \n        border: 1px solid var(--background-modifier-border); \n        border-radius: 6px;\n        background: var(--background-primary);\n        color: var(--text-normal);\n        font-size: 14px;\n      }\n      .vtt-monster-search-btn {\n        padding: 8px 16px;\n        background: var(--interactive-accent);\n        color: var(--text-on-accent);\n        border: none;\n        border-radius: 6px;\n        cursor: pointer;\n        font-weight: 500;\n      }\n      .vtt-monster-search-btn:hover { opacity: 0.9; }\n      .vtt-monster-search-btn:disabled { opacity: 0.5; cursor: not-allowed; }\n      .vtt-monster-results { \n        display: grid; \n        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); \n        gap: 12px;\n        max-height: 400px;\n        overflow-y: auto;\n      }\n      .vtt-monster-result {\n        border: 2px solid var(--background-modifier-border);\n        border-radius: 8px;\n        overflow: hidden;\n        cursor: pointer;\n        transition: all 150ms ease;\n        background: var(--background-secondary);\n      }\n      .vtt-monster-result:hover {\n        border-color: var(--interactive-accent);\n        transform: translateY(-2px);\n        box-shadow: 0 4px 12px rgba(0,0,0,0.2);\n      }\n      .vtt-monster-result img {\n        width: 100%;\n        height: 120px;\n        object-fit: cover;\n        display: block;\n      }\n      .vtt-monster-result-info {\n        padding: 8px;\n      }\n      .vtt-monster-result-title {\n        font-size: 11px;\n        font-weight: 500;\n        color: var(--text-normal);\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n      .vtt-monster-result-source {\n        font-size: 9px;\n        color: var(--text-muted);\n        margin-top: 2px;\n      }\n      .vtt-monster-result-actions {\n        display: flex;\n        gap: 4px;\n        padding: 6px 8px;\n        border-top: 1px solid var(--background-modifier-border);\n      }\n      .vtt-monster-result-actions button {\n        flex: 1;\n        padding: 4px 8px;\n        font-size: 10px;\n        border: none;\n        border-radius: 4px;\n        cursor: pointer;\n      }\n      .vtt-monster-action-project {\n        background: var(--interactive-accent);\n        color: var(--text-on-accent);\n      }\n      .vtt-monster-action-save {\n        background: var(--background-modifier-border);\n        color: var(--text-normal);\n      }\n      .vtt-monster-loading {\n        text-align: center;\n        padding: 24px;\n        color: var(--text-muted);\n      }\n      .vtt-monster-empty {\n        text-align: center;\n        padding: 24px;\n        color: var(--text-muted);\n      }\n      .vtt-monster-tips {\n        margin-top: 16px;\n        padding: 12px;\n        background: var(--background-secondary);\n        border-radius: 6px;\n        font-size: 12px;\n        color: var(--text-muted);\n      }\n      .vtt-monster-tips strong { color: var(--text-normal); }\n    `;\n    \n    // Header\n    const header = contentEl.createDiv({ cls: 'vtt-monster-search-header' });\n    header.createEl('h2', { text: '\uD83D\uDC09 D&D Monster Image Search' });\n    header.createEl('p', { text: 'Search for monster artwork from free sources' });\n    \n    // Search input row\n    const inputRow = contentEl.createDiv({ cls: 'vtt-monster-search-input-row' });\n    this.searchInput = inputRow.createEl('input', { \n      cls: 'vtt-monster-search-input',\n      attr: { \n        type: 'text', \n        placeholder: 'Enter monster name (e.g., \"Beholder\", \"Mind Flayer\", \"Owlbear\")...'\n      }\n    });\n    \n    const searchBtn = inputRow.createEl('button', { text: '\uD83D\uDD0D Search', cls: 'vtt-monster-search-btn' });\n    \n    // Results container\n    this.resultsContainer = contentEl.createDiv({ cls: 'vtt-monster-results' });\n    \n    // Loading indicator\n    this.loadingEl = contentEl.createDiv({ cls: 'vtt-monster-loading' });\n    this.loadingEl.style.display = 'none';\n    this.loadingEl.textContent = '\u23F3 Searching...';\n    \n    // Tips\n    const tips = contentEl.createDiv({ cls: 'vtt-monster-tips' });\n    tips.innerHTML = `\n      <strong>\uD83D\uDCA1 Tips:</strong><br>\n      \u2022 Use English monster names for best results<br>\n      \u2022 Try variations: \"Red Dragon\", \"Ancient Red Dragon\", \"Dragon Red\"<br>\n      \u2022 Click an image to see options: Project to screen or Save to vault<br>\n    `;\n    \n    // Event handlers\n    searchBtn.addEventListener('click', () => this.doSearch());\n    this.searchInput.addEventListener('keypress', (e) => {\n      if (e.key === 'Enter') this.doSearch();\n    });\n    \n    // Focus input\n    setTimeout(() => this.searchInput?.focus(), 100);\n  }\n  \n  async doSearch() {\n    const query = this.searchInput?.value.trim();\n    if (!query) {\n      new Notice('Please enter a monster name');\n      return;\n    }\n    \n    if (!this.resultsContainer || !this.loadingEl) return;\n    \n    // Show loading\n    this.resultsContainer.empty();\n    this.loadingEl.style.display = 'block';\n    \n    try {\n      const results = await this.plugin.searchMonsterImages(query);\n      this.loadingEl.style.display = 'none';\n      \n      if (results.length === 0) {\n        const empty = this.resultsContainer.createDiv({ cls: 'vtt-monster-empty' });\n        empty.innerHTML = `\n          <p>\uD83D\uDE15 No images found for \"<strong>${query}</strong>\"</p>\n          <p style=\"font-size:11px\">Try a different spelling or a more common monster name</p>\n        `;\n        return;\n      }\n      \n      // Render results\n      for (const result of results) {\n        const card = this.resultsContainer.createDiv({ cls: 'vtt-monster-result' });\n        \n        const img = card.createEl('img');\n        img.src = result.url;\n        img.alt = result.title;\n        img.onerror = () => {\n          img.src = 'data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><text y=\"50\" x=\"50\" text-anchor=\"middle\" font-size=\"40\">\uD83D\uDDBC\uFE0F</text></svg>';\n        };\n        \n        const info = card.createDiv({ cls: 'vtt-monster-result-info' });\n        info.createEl('div', { text: result.title, cls: 'vtt-monster-result-title', attr: { title: result.title } });\n        info.createEl('div', { text: result.source, cls: 'vtt-monster-result-source' });\n        \n        const actions = card.createDiv({ cls: 'vtt-monster-result-actions' });\n        \n        const projectBtn = actions.createEl('button', { text: '\uD83D\uDDA5\uFE0F Project', cls: 'vtt-monster-action-project' });\n        projectBtn.addEventListener('click', async (e) => {\n          e.stopPropagation();\n          await this.plugin.projectMonsterImage(result.url, query);\n          new Notice(`Projecting: ${query}`);\n        });\n        \n        // Only show save button for non-local results (local files are already in vault)\n        if (result.source !== 'Local Vault') {\n          const saveBtn = actions.createEl('button', { text: '\uD83D\uDCBE Save', cls: 'vtt-monster-action-save' });\n          saveBtn.addEventListener('click', async (e) => {\n            e.stopPropagation();\n            // Open modal to enter the name before saving\n            new MonsterImageSaveModal(this.app, this.plugin, result.url, result.title || query).open();\n          });\n        } else {\n          // Show \"Already in Vault\" badge for local files\n          const localBadge = actions.createEl('span', { text: '\u2713 In Vault', cls: 'vtt-monster-action-save' });\n          localBadge.style.opacity = '0.6';\n          localBadge.style.cursor = 'default';\n          localBadge.style.textAlign = 'center';\n        }\n      }\n      \n    } catch (e) {\n      \n      this.loadingEl.style.display = 'none';\n      \n      const error = this.resultsContainer.createDiv({ cls: 'vtt-monster-empty' });\n      error.innerHTML = `<p>\u274C Search failed. Please try again.</p>`;\n    }\n  }\n  \n  onClose() {\n    this.contentEl.empty();\n  }\n}\n\n/**\n * Modal for searching battle maps from online sources\n */\nclass BattleMapSearchModal extends Modal {\n  plugin: VttCardDisplay;\n  searchInput: HTMLInputElement | null = null;\n  animatedCheckbox: HTMLInputElement | null = null;\n  resultsContainer: HTMLElement | null = null;\n  loadingEl: HTMLElement | null = null;\n  \n  constructor(app: any, plugin: VttCardDisplay) {\n    super(app);\n    this.plugin = plugin;\n  }\n  \n  onOpen() {\n    const { contentEl } = this;\n    contentEl.empty();\n    contentEl.addClass('vtt-map-search-modal');\n    // Add class to the modal container for width styling\n    this.modalEl.addClass('mod-vtt-map-search');\n    \n    // Add styles - also target the modal container for width\n    const style = contentEl.createEl('style');\n    style.textContent = `\n      .modal.mod-vtt-map-search {\n        width: 95vw !important;\n        max-width: 1400px !important;\n      }\n      .vtt-map-search-modal { \n        width: 100% !important; \n        max-width: 100% !important; \n        overflow: hidden !important;\n      }\n      .vtt-map-search-modal .modal-content {\n        overflow-x: hidden !important;\n        overflow-y: auto !important;\n        max-height: 80vh;\n        padding: 16px;\n      }\n      .vtt-map-search-header { margin-bottom: 16px; }\n      .vtt-map-search-header h2 { margin: 0 0 8px 0; }\n      .vtt-map-search-input-row { display: flex; gap: 8px; margin-bottom: 12px; flex-wrap: wrap; }\n      .vtt-map-search-input { \n        flex: 1; \n        min-width: 150px;\n        padding: 10px 14px; \n        border: 1px solid var(--background-modifier-border); \n        border-radius: 6px;\n        background: var(--background-primary);\n        color: var(--text-normal);\n        font-size: 15px;\n      }\n      .vtt-map-search-btn {\n        padding: 10px 20px;\n        background: var(--interactive-accent);\n        color: var(--text-on-accent);\n        border: none;\n        border-radius: 6px;\n        cursor: pointer;\n        font-weight: 500;\n        font-size: 14px;\n      }\n      .vtt-map-search-btn:hover { opacity: 0.9; }\n      .vtt-map-search-btn:disabled { opacity: 0.5; cursor: not-allowed; }\n      .vtt-map-results { \n        display: grid; \n        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); \n        gap: 12px;\n        max-height: 50vh;\n        overflow-y: auto;\n        overflow-x: hidden;\n        padding: 4px;\n        width: 100%;\n        box-sizing: border-box;\n      }\n      .vtt-map-result {\n        border: 2px solid var(--background-modifier-border);\n        border-radius: 10px;\n        overflow: hidden;\n        cursor: pointer;\n        transition: all 150ms ease;\n        background: var(--background-secondary);\n        position: relative;\n        min-width: 0;\n      }\n      .vtt-map-result.animated::before {\n        content: '\uD83C\uDFAC';\n        position: absolute;\n        top: 8px;\n        left: 8px;\n        background: rgba(0,0,0,0.7);\n        color: white;\n        padding: 2px 6px;\n        border-radius: 4px;\n        font-size: 12px;\n        z-index: 1;\n      }\n      .vtt-map-result:hover {\n        border-color: var(--interactive-accent);\n        transform: translateY(-2px);\n        box-shadow: 0 4px 12px rgba(0,0,0,0.2);\n      }\n      .vtt-map-result img {\n        width: 100%;\n        height: 140px;\n        object-fit: cover;\n        display: block;\n      }\n      .vtt-map-result-info {\n        padding: 8px;\n      }\n      .vtt-map-result-title {\n        font-size: 11px;\n        font-weight: 500;\n        color: var(--text-normal);\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n      .vtt-map-result-source {\n        font-size: 9px;\n        color: var(--text-muted);\n        margin-top: 2px;\n      }\n      .vtt-map-result-actions {\n        display: flex;\n        gap: 6px;\n        padding: 8px 10px;\n        border-top: 1px solid var(--background-modifier-border);\n      }\n      .vtt-map-result-actions button {\n        flex: 1;\n        padding: 6px 10px;\n        font-size: 11px;\n        border: none;\n        border-radius: 5px;\n        cursor: pointer;\n        font-weight: 500;\n      }\n      .vtt-map-action-project {\n        background: var(--interactive-accent);\n        color: var(--text-on-accent);\n      }\n      .vtt-map-action-save {\n        background: var(--background-modifier-success);\n        color: var(--text-on-accent);\n      }\n      .vtt-map-action-save:hover {\n        opacity: 0.9;\n      }\n      .vtt-map-loading {\n        text-align: center;\n        padding: 32px;\n        color: var(--text-muted);\n        font-size: 16px;\n      }\n      .vtt-map-empty {\n        text-align: center;\n        padding: 32px;\n        color: var(--text-muted);\n      }\n      .vtt-map-tips {\n        margin-top: 16px;\n        padding: 14px;\n        background: var(--background-secondary);\n        border-radius: 8px;\n        font-size: 13px;\n        color: var(--text-muted);\n      }\n      .vtt-map-tips strong { color: var(--text-normal); }\n    `;\n    \n    // Header\n    const header = contentEl.createDiv({ cls: 'vtt-map-search-header' });\n    header.createEl('h2', { text: '\uD83D\uDDFA\uFE0F Battle Map Search' });\n    header.createEl('p', { text: 'Search for battle maps from Reddit, DeviantArt and more' });\n    \n    // Search input row\n    const inputRow = contentEl.createDiv({ cls: 'vtt-map-search-input-row' });\n    this.searchInput = inputRow.createEl('input', { \n      cls: 'vtt-map-search-input',\n      attr: { \n        type: 'text', \n        placeholder: 'Enter map type (e.g., \"forest\", \"tavern\", \"dungeon\", \"cave\")...'\n      }\n    });\n    \n    const searchBtn = inputRow.createEl('button', { text: '\uD83D\uDD0D Search', cls: 'vtt-map-search-btn' });\n    \n    // Options row with animated checkbox\n    const optionsRow = contentEl.createDiv({ cls: 'vtt-map-options-row' });\n    optionsRow.style.cssText = 'display:flex;align-items:center;gap:12px;margin-bottom:12px;';\n    \n    const animatedLabel = optionsRow.createEl('label', { cls: 'vtt-map-option' });\n    animatedLabel.style.cssText = 'display:flex;align-items:center;gap:6px;cursor:pointer;font-size:13px;';\n    this.animatedCheckbox = animatedLabel.createEl('input') as HTMLInputElement;\n    this.animatedCheckbox.type = 'checkbox';\n    this.animatedCheckbox.style.cssText = 'width:16px;height:16px;cursor:pointer;accent-color:var(--interactive-accent);';\n    animatedLabel.createEl('span', { text: '\uD83C\uDFAC Search only animated maps (GIF/Video)' });\n    \n    // Results container\n    this.resultsContainer = contentEl.createDiv({ cls: 'vtt-map-results' });\n    \n    // Loading indicator\n    this.loadingEl = contentEl.createDiv({ cls: 'vtt-map-loading' });\n    this.loadingEl.style.display = 'none';\n    this.loadingEl.textContent = '\u23F3 Searching for maps...';\n    \n    // Tips\n    const tips = contentEl.createDiv({ cls: 'vtt-map-tips' });\n    tips.innerHTML = `\n      <strong>\uD83D\uDCA1 Tips:</strong><br>\n      \u2022 Try keywords like: forest, tavern, dungeon, cave, castle, ship, city, swamp<br>\n      \u2022 Add descriptors: \"dark forest\", \"abandoned tavern\", \"ice cave\"<br>\n      \u2022 <strong>\uD83D\uDDA5\uFE0F Project</strong> \u2014 Show the map directly on the popout screen<br>\n      \u2022 <strong>\uD83D\uDCBE Save</strong> \u2014 Creates a new map note with the image, Player Infos and DM Info sections<br>\n      \u2022 Sources: Reddit r/battlemaps, DeviantArt, Imgur\n    `;\n    \n    // Event handlers\n    searchBtn.addEventListener('click', () => this.doSearch());\n    this.searchInput.addEventListener('keypress', (e) => {\n      if (e.key === 'Enter') this.doSearch();\n    });\n    \n    // Focus input\n    setTimeout(() => this.searchInput?.focus(), 100);\n  }\n  \n  async doSearch() {\n    const query = this.searchInput?.value.trim();\n    if (!query) {\n      new Notice('Please enter a map type');\n      return;\n    }\n    \n    if (!this.resultsContainer || !this.loadingEl) return;\n    \n    const animatedOnly = this.animatedCheckbox?.checked || false;\n    \n    // Show loading\n    this.resultsContainer.empty();\n    this.loadingEl.style.display = 'block';\n    this.loadingEl.textContent = animatedOnly ? '\u23F3 Searching for animated maps...' : '\u23F3 Searching for maps...';\n    \n    try {\n      const results = await this.plugin.searchBattleMaps(query, animatedOnly);\n      this.loadingEl.style.display = 'none';\n      \n      if (results.length === 0) {\n        const empty = this.resultsContainer.createDiv({ cls: 'vtt-map-empty' });\n        empty.innerHTML = `\n          <p>\uD83D\uDE15 No ${animatedOnly ? 'animated ' : ''}maps found for \"<strong>${query}</strong>\"</p>\n          <p style=\"font-size:11px\">${animatedOnly ? 'Try broader terms like \"forest\", \"cave\", \"dungeon\"' : 'Try different keywords like \"forest path\", \"tavern interior\", \"dungeon corridor\"'}</p>\n        `;\n        return;\n      }\n      \n      // Show result count\n      const countEl = this.resultsContainer.createDiv({ cls: 'vtt-map-result-count' });\n      countEl.style.cssText = 'grid-column: 1/-1; padding: 8px 0; font-size: 12px; color: var(--text-muted);';\n      countEl.textContent = `Found ${results.length} ${animatedOnly ? 'animated ' : ''}map${results.length !== 1 ? 's' : ''}`;\n      \n      // Render results\n      for (const result of results) {\n        const isAnimated = result.source.includes('Animated');\n        const card = this.resultsContainer.createDiv({ cls: `vtt-map-result${isAnimated ? ' animated' : ''}` });\n        \n        const img = card.createEl('img');\n        // Use thumbnail if available (for videos), otherwise use URL directly\n        img.src = result.thumbnail || result.url;\n        img.alt = result.title;\n        img.onerror = () => {\n          // Try the actual URL if thumbnail fails\n          if (result.thumbnail && img.src === result.thumbnail) {\n            img.src = result.url;\n          } else {\n            img.src = 'data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><text y=\"50\" x=\"50\" text-anchor=\"middle\" font-size=\"40\">\uD83D\uDDFA\uFE0F</text></svg>';\n          }\n        };\n        \n        const info = card.createDiv({ cls: 'vtt-map-result-info' });\n        info.createEl('div', { text: result.title, cls: 'vtt-map-result-title', attr: { title: result.title } });\n        info.createEl('div', { text: result.source, cls: 'vtt-map-result-source' });\n        \n        const actions = card.createDiv({ cls: 'vtt-map-result-actions' });\n        \n        const projectBtn = actions.createEl('button', { text: '\uD83D\uDDA5\uFE0F Project', cls: 'vtt-map-action-project' });\n        projectBtn.addEventListener('click', async (e) => {\n          e.stopPropagation();\n          await this.plugin.projectBattleMapImage(result.url, result.title);\n          new Notice(`Projecting: ${result.title}`);\n        });\n        \n        const saveBtn = actions.createEl('button', { text: '\uD83D\uDCBE Save', cls: 'vtt-map-action-save' });\n        saveBtn.addEventListener('click', async (e) => {\n          e.stopPropagation();\n          // Open modal to enter the note name before saving\n          new BattleMapSaveModal(this.app, this.plugin, result.url, result.title).open();\n        });\n      }\n      \n    } catch (e) {\n      \n      this.loadingEl.style.display = 'none';\n      \n      const error = this.resultsContainer.createDiv({ cls: 'vtt-map-empty' });\n      error.innerHTML = `<p>\u274C Search failed. Please try again.</p>`;\n    }\n  }\n  \n  onClose() {\n    this.contentEl.empty();\n  }\n}\n\n// Modal to enter name before saving a battle map\nclass BattleMapSaveModal extends Modal {\n  nameInput!: HTMLInputElement;\n  \n  constructor(\n    app: any, \n    private plugin: VttCardDisplay, \n    private imageUrl: string, \n    private originalTitle: string\n  ) { \n    super(app); \n  }\n  \n  onOpen() {\n    const { contentEl } = this;\n    contentEl.empty();\n    contentEl.addClass('vtt-map-save-modal');\n    \n    // Header\n    contentEl.createEl('h2', { text: '\uD83D\uDCBE Save Battle Map' });\n    \n    // Preview image\n    const previewContainer = contentEl.createDiv({ cls: 'vtt-map-save-preview' });\n    previewContainer.style.cssText = 'margin-bottom:16px;text-align:center;';\n    \n    const previewImg = previewContainer.createEl('img');\n    previewImg.src = this.imageUrl;\n    previewImg.style.cssText = 'max-width:100%;max-height:200px;border-radius:6px;box-shadow:0 2px 8px rgba(0,0,0,0.3);';\n    previewImg.onerror = () => {\n      previewImg.style.display = 'none';\n    };\n    \n    // Name input section\n    const inputSection = contentEl.createDiv({ cls: 'vtt-modal-section' });\n    inputSection.style.cssText = 'margin-bottom:16px;';\n    \n    const label = inputSection.createEl('label', { text: 'Map Name' });\n    label.style.cssText = 'display:block;margin-bottom:6px;font-weight:500;';\n    \n    this.nameInput = inputSection.createEl('input') as HTMLInputElement;\n    this.nameInput.type = 'text';\n    this.nameInput.value = this.originalTitle.replace(/[^a-zA-Z0-9\\s\\-_\u00E4\u00F6\u00FC\u00C4\u00D6\u00DC\u00DF]/g, '').trim().substring(0, 50) || 'Battle Map';\n    this.nameInput.placeholder = 'e.g. Dragon\\'s Lair';\n    this.nameInput.style.cssText = 'width:100%;padding:8px;border:1px solid var(--background-modifier-border);border-radius:4px;background:var(--background-primary);color:var(--text-normal);';\n    \n    // Info text\n    const infoSection = contentEl.createDiv({ cls: 'vtt-modal-info' });\n    infoSection.style.cssText = 'margin-bottom:16px;padding:10px;background:var(--background-secondary);border-radius:6px;font-size:12px;color:var(--text-muted);';\n    \n    const folderPath = this.plugin.settings.mapsFolderPath || 'Maps';\n    infoSection.innerHTML = `\n      <div>\uD83D\uDCC1 Note will be saved to: <strong>${folderPath}/</strong></div>\n      <div>\uD83D\uDDBC\uFE0F Image will be saved to: <strong>${folderPath}/_resources/</strong></div>\n      <div style=\"margin-top:6px;\">\uD83D\uDCDD The note will contain Player Infos and DM Info sections.</div>\n    `;\n    \n    // Button row\n    const btnRow = contentEl.createDiv({ cls: 'vtt-modal-buttons' });\n    btnRow.style.cssText = 'display:flex;gap:8px;justify-content:flex-end;margin-top:16px;';\n    \n    const cancelBtn = btnRow.createEl('button', { text: 'Cancel' });\n    cancelBtn.addEventListener('click', () => this.close());\n    \n    const saveBtn = btnRow.createEl('button', { text: '\uD83D\uDCBE Save', cls: 'mod-cta' });\n    saveBtn.addEventListener('click', async () => {\n      const name = this.nameInput.value?.trim();\n      if (!name) { \n        new Notice('Please enter a map name'); \n        return; \n      }\n      \n      saveBtn.disabled = true;\n      saveBtn.textContent = '\u23F3 Saving...';\n      \n      try {\n        const saved = await this.plugin.saveBattleMapImage(this.imageUrl, name);\n        if (saved) {\n          new Notice(`\u2705 Saved: ${saved}`);\n          this.close();\n        }\n      } catch (e) {\n        \n        new Notice('\u274C Failed to save map');\n        saveBtn.disabled = false;\n        saveBtn.textContent = '\uD83D\uDCBE Save';\n      }\n    });\n    \n    // Enter key to save\n    this.nameInput.addEventListener('keypress', (e) => {\n      if (e.key === 'Enter') saveBtn.click();\n    });\n    \n    // Focus input and select text\n    setTimeout(() => {\n      this.nameInput?.focus();\n      this.nameInput?.select();\n    }, 100);\n  }\n  \n  onClose() {\n    this.contentEl.empty();\n  }\n}\n\n// Modal to enter name before saving a monster image\nclass MonsterImageSaveModal extends Modal {\n  nameInput!: HTMLInputElement;\n  \n  constructor(\n    app: any, \n    private plugin: VttCardDisplay, \n    private imageUrl: string, \n    private originalTitle: string\n  ) { \n    super(app); \n  }\n  \n  onOpen() {\n    const { contentEl } = this;\n    contentEl.empty();\n    contentEl.addClass('vtt-monster-save-modal');\n    \n    // Header\n    contentEl.createEl('h2', { text: '\uD83D\uDCBE Save Monster Image' });\n    \n    // Preview image\n    const previewContainer = contentEl.createDiv({ cls: 'vtt-monster-save-preview' });\n    previewContainer.style.cssText = 'margin-bottom:16px;text-align:center;';\n    \n    const previewImg = previewContainer.createEl('img');\n    previewImg.src = this.imageUrl;\n    previewImg.style.cssText = 'max-width:100%;max-height:200px;border-radius:6px;box-shadow:0 2px 8px rgba(0,0,0,0.3);';\n    previewImg.onerror = () => {\n      previewImg.style.display = 'none';\n    };\n    \n    // Name input section\n    const inputSection = contentEl.createDiv({ cls: 'vtt-modal-section' });\n    inputSection.style.cssText = 'margin-bottom:16px;';\n    \n    const label = inputSection.createEl('label', { text: 'Monster Name' });\n    label.style.cssText = 'display:block;margin-bottom:6px;font-weight:500;';\n    \n    this.nameInput = inputSection.createEl('input') as HTMLInputElement;\n    this.nameInput.type = 'text';\n    this.nameInput.value = this.originalTitle.replace(/[^a-zA-Z0-9\\s\\-_\u00E4\u00F6\u00FC\u00C4\u00D6\u00DC\u00DF]/g, '').trim().substring(0, 50) || 'Monster';\n    this.nameInput.placeholder = 'e.g. Ancient Red Dragon';\n    this.nameInput.style.cssText = 'width:100%;padding:8px;border:1px solid var(--background-modifier-border);border-radius:4px;background:var(--background-primary);color:var(--text-normal);';\n    \n    // Info text\n    const infoSection = contentEl.createDiv({ cls: 'vtt-modal-info' });\n    infoSection.style.cssText = 'margin-bottom:16px;padding:10px;background:var(--background-secondary);border-radius:6px;font-size:12px;color:var(--text-muted);';\n    \n    const cardsFolder = this.plugin.settings.folderPath || 'Cards';\n    infoSection.innerHTML = `\n      <div>\uD83D\uDCC1 Image will be saved to: <strong>${cardsFolder}/images/</strong></div>\n      <div style=\"margin-top:6px;\">\uD83C\uDCCF The image will appear in your Cards panel after saving.</div>\n    `;\n    \n    // Button row\n    const btnRow = contentEl.createDiv({ cls: 'vtt-modal-buttons' });\n    btnRow.style.cssText = 'display:flex;gap:8px;justify-content:flex-end;margin-top:16px;';\n    \n    const cancelBtn = btnRow.createEl('button', { text: 'Cancel' });\n    cancelBtn.addEventListener('click', () => this.close());\n    \n    const saveBtn = btnRow.createEl('button', { text: '\uD83D\uDCBE Save', cls: 'mod-cta' });\n    saveBtn.addEventListener('click', async () => {\n      const name = this.nameInput.value?.trim();\n      if (!name) { \n        new Notice('Please enter a monster name'); \n        return; \n      }\n      \n      saveBtn.disabled = true;\n      saveBtn.textContent = '\u23F3 Saving...';\n      \n      try {\n        const saved = await this.plugin.saveMonsterImage(this.imageUrl, name);\n        if (saved) {\n          new Notice(`\u2705 Saved: ${saved}`);\n          this.close();\n        }\n      } catch (e) {\n        console.error('Failed to save monster image:', e);\n        new Notice('\u274C Failed to save image');\n        saveBtn.disabled = false;\n        saveBtn.textContent = '\uD83D\uDCBE Save';\n      }\n    });\n    \n    // Enter key to save\n    this.nameInput.addEventListener('keypress', (e) => {\n      if (e.key === 'Enter') saveBtn.click();\n    });\n    \n    // Focus input and select text\n    setTimeout(() => {\n      this.nameInput?.focus();\n      this.nameInput?.select();\n    }, 100);\n  }\n  \n  onClose() {\n    this.contentEl.empty();\n  }\n}\n\n// Modal to pick a note file from the vault\nclass NotePickerModal extends SuggestModal<any> {\n  onChooseCallback: (path: string) => void;\n  constructor(app: any, onChoose: (path: string) => void) {\n    super(app);\n    this.onChooseCallback = onChoose;\n  }\n  getSuggestions(query: string) {\n    const files = this.app.vault.getFiles().filter((f: any) => f.extension === 'md');\n    if (!query) return files.slice(0, 50);\n    const lower = query.toLowerCase();\n    return files.filter((f: any) => f.path.toLowerCase().includes(lower) || f.name.toLowerCase().includes(lower)).slice(0, 50);\n  }\n  renderSuggestion(file: any, el: HTMLElement) {\n    el.createEl('div', { text: file.name.replace(/\\.md$/, '') });\n    el.createEl('small', { text: file.path });\n  }\n  onChooseSuggestion(file: any) {\n    this.close();\n    if (this.onChooseCallback) this.onChooseCallback(file.path);\n  }\n}\n\n// Modal to create a new Map page with a manually entered name\nclass MapCreateModal extends Modal {\n  nameInput!: HTMLInputElement;\n  constructor(app: any, private plugin: VttCardDisplay) { super(app); }\n  onOpen() {\n    const { contentEl } = this;\n    contentEl.empty();\n    contentEl.addClass('vtt-map-create-modal');\n    \n    // Header\n    contentEl.createEl('h2', { text: 'Create Map Page' });\n    \n    // Description\n    const desc = contentEl.createDiv({ cls: 'vtt-modal-desc' });\n    desc.style.cssText = 'margin-bottom:16px;color:var(--text-muted);font-size:13px;';\n    desc.textContent = 'Create a new map page with Player Info and DM Info sections for projection.';\n    \n    // Name input section\n    const inputSection = contentEl.createDiv({ cls: 'vtt-modal-section' });\n    inputSection.style.cssText = 'margin-bottom:16px;';\n    \n    const label = inputSection.createEl('label', { text: 'Map Name' });\n    label.style.cssText = 'display:block;margin-bottom:6px;font-weight:500;';\n    \n    this.nameInput = inputSection.createEl('input') as HTMLInputElement;\n    this.nameInput.type = 'text';\n    this.nameInput.placeholder = 'e.g. Dragon\\'s Lair';\n    this.nameInput.style.cssText = 'width:100%;padding:8px;border:1px solid var(--background-modifier-border);border-radius:4px;background:var(--background-primary);color:var(--text-normal);';\n    \n    // Preview section\n    const previewSection = contentEl.createDiv({ cls: 'vtt-modal-section' });\n    previewSection.style.cssText = 'margin-bottom:16px;padding:12px;background:var(--background-secondary);border-radius:6px;';\n    \n    const previewLabel = previewSection.createEl('div', { text: 'Template Preview:' });\n    previewLabel.style.cssText = 'font-weight:500;margin-bottom:8px;font-size:12px;color:var(--text-muted);';\n    \n    const previewContent = previewSection.createEl('pre');\n    previewContent.style.cssText = 'margin:0;padding:8px;background:var(--background-primary);border-radius:4px;font-size:11px;white-space:pre-wrap;color:var(--text-muted);';\n    previewContent.textContent = `# Map Name\n\n![[map-image.png]]\n\n# Player Infos\nInformation visible to players when projected.\n\n# DM Info\nSecret notes - never shown in projection.`;\n    \n    // Button row\n    const btnRow = contentEl.createDiv({ cls: 'vtt-modal-buttons' });\n    btnRow.style.cssText = 'display:flex;gap:8px;justify-content:flex-end;margin-top:16px;';\n    \n    const cancelBtn = btnRow.createEl('button', { text: 'Cancel' });\n    cancelBtn.addEventListener('click', () => this.close());\n    \n    const createBtn = btnRow.createEl('button', { text: 'Create', cls: 'mod-cta' });\n    createBtn.addEventListener('click', async () => {\n      const name = this.nameInput.value?.trim();\n      if (!name) { new (globalThis as any).Notice('Please enter a map name'); return; }\n      const folder = this.plugin.settings.mapsFolderPath || 'Maps';\n      const path = `${folder.replace(/\\/$/, '')}/${name}.md`;\n      try {\n        const exists = this.plugin.app.vault.getAbstractFileByPath(path);\n        if (exists) { new (globalThis as any).Notice('Map page already exists: ' + path); return; }\n        \n        // Create template with proper sections\n        const template = `# ${name}\n\n![[${name.toLowerCase().replace(/\\s+/g, '-')}-map.png]]\n\n# Player Infos\nAdd information that players should see here.\n\n# DM Info\nAdd secret DM notes here - this section is never projected.\n`;\n        await this.plugin.app.vault.create(path, template);\n        new (globalThis as any).Notice('Created map page: ' + path);\n        await this.plugin.loadMaps();\n        this.close();\n      } catch (e) { new (globalThis as any).Notice('Could not create map page: ' + e); }\n    });\n  }\n}\n\n// Suggest modal to pick registered items\nclass ItemSuggestModal extends SuggestModal<any> {\n  items: any[];\n  onChoose: (item: any) => void;\n  constructor(app: any, items: any[], onChoose: (item: any) => void) { super(app); this.items = items || []; this.onChoose = onChoose; }\n  getSuggestions(query: string) { return this.items.filter(i => (i.title && i.title.toLowerCase().includes(query.toLowerCase())) || (i.id && i.id.toLowerCase().includes(query.toLowerCase()))); }\n  renderSuggestion(item: any, el: HTMLElement) { (el as any).createEl('div', { text: item.title }); (el as any).createEl('small', { text: ` ${item.id}` }); }\n  onChooseSuggestion(item: any) { (this as any).close(); if (this.onChoose) this.onChoose(item); }\n}\n\n// Card viewer as a Workspace view - Windows Explorer style\nclass CardView extends ItemView {\n  plugin: VttCardDisplay;\n  constructor(leaf: any, plugin: VttCardDisplay) { super(leaf); this.plugin = plugin; }\n  getViewType() { return 'vtt-card-view'; }\n  getDisplayText() { return 'VTT Cards'; }\n  getIcon() { return 'image'; }\n  \n  async onOpen() {\n    const container = this.containerEl;\n    container.empty();\n    container.addClass('vtt-panel-view');\n    \n    // Inject custom styles\n    const styleEl = container.createEl('style');\n    styleEl.textContent = `\n      .vtt-panel-view { \n        padding: 0 !important; \n        background: var(--background-primary); \n        display: flex;\n        flex-direction: column;\n        height: 100%;\n        min-height: 0;\n        overflow: hidden;\n      }\n      .vtt-panel-content {\n        flex: 1 1 auto;\n        min-height: 0;\n        overflow-y: auto;\n        overflow-x: hidden;\n      }\n      .vtt-panel-header { \n        padding: 12px 16px; \n        background: var(--background-secondary); \n        border-bottom: 1px solid var(--background-modifier-border);\n        display: flex; \n        align-items: center; \n        gap: 8px;\n        flex-wrap: wrap;\n        flex-shrink: 0;\n      }\n      .vtt-search-row {\n        width: 100%;\n        display: flex;\n        gap: 8px;\n        margin-top: 8px;\n      }\n      .vtt-search-input {\n        flex: 1;\n        padding: 6px 10px;\n        border-radius: 6px;\n        border: 1px solid var(--background-modifier-border);\n        background: var(--background-primary);\n        color: var(--text-normal);\n        font-size: 12px;\n      }\n      .vtt-search-input:focus {\n        outline: none;\n        border-color: var(--interactive-accent);\n      }\n      .vtt-panel-header button {\n        padding: 6px 12px;\n        border-radius: 6px;\n        background: var(--interactive-normal);\n        border: 1px solid var(--background-modifier-border);\n        color: var(--text-normal);\n        cursor: pointer;\n        font-size: 12px;\n        transition: all 150ms ease;\n      }\n      .vtt-panel-header button:hover {\n        background: var(--interactive-hover);\n        border-color: var(--interactive-accent);\n      }\n      .vtt-panel-header button.mod-cta {\n        background: var(--interactive-accent);\n        color: var(--text-on-accent);\n        border-color: var(--interactive-accent);\n      }\n      .vtt-toggle-container {\n        display: flex;\n        align-items: center;\n        gap: 6px;\n        margin-left: auto;\n        padding: 4px 10px;\n        background: var(--background-primary);\n        border-radius: 6px;\n        font-size: 12px;\n      }\n      .vtt-toggle-container input[type=\"checkbox\"] {\n        width: 16px;\n        height: 16px;\n        cursor: pointer;\n        accent-color: var(--interactive-accent);\n      }\n      .vtt-section {\n        padding: 12px 16px;\n        flex-shrink: 0;\n      }\n      .vtt-section-header {\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        margin-bottom: 12px;\n        padding-bottom: 8px;\n        border-bottom: 1px solid var(--background-modifier-border);\n        cursor: pointer;\n        user-select: none;\n        transition: background 150ms ease;\n        border-radius: 6px;\n        margin: 0 -8px 12px -8px;\n        padding: 8px;\n      }\n      .vtt-section-header:hover {\n        background: var(--background-secondary);\n      }\n      .vtt-section-icon {\n        font-size: 12px;\n        transition: transform 150ms ease;\n      }\n      .vtt-section-icon.collapsed {\n        transform: rotate(-90deg);\n      }\n      .vtt-section-title {\n        font-size: 14px;\n        font-weight: 600;\n        color: var(--text-normal);\n        margin: 0;\n        flex: 1;\n      }\n      .vtt-section-content {\n        overflow: hidden;\n        transition: max-height 200ms ease;\n      }\n      .vtt-section-content.collapsed {\n        max-height: 0 !important;\n        padding: 0;\n        margin: 0;\n      }\n      .vtt-section-count {\n        font-size: 11px;\n        color: var(--text-muted);\n        background: var(--background-secondary);\n        padding: 2px 8px;\n        border-radius: 10px;\n      }\n      .vtt-folder-tree {\n        overflow-y: visible;\n        overflow-x: hidden;\n        padding: 4px;\n      }\n      .vtt-folder {\n        margin-bottom: 4px;\n      }\n      .vtt-folder-header {\n        display: flex;\n        align-items: center;\n        gap: 6px;\n        padding: 6px 8px;\n        border-radius: 6px;\n        cursor: pointer;\n        user-select: none;\n        transition: background 150ms ease;\n      }\n      .vtt-folder-header:hover {\n        background: var(--background-secondary);\n      }\n      .vtt-folder-icon {\n        font-size: 14px;\n        transition: transform 150ms ease;\n      }\n      .vtt-folder-icon.collapsed {\n        transform: rotate(-90deg);\n      }\n      .vtt-folder-name {\n        font-size: 13px;\n        font-weight: 500;\n        color: var(--text-normal);\n        flex: 1;\n      }\n      .vtt-folder-count {\n        font-size: 10px;\n        color: var(--text-muted);\n        background: var(--background-modifier-border);\n        padding: 1px 6px;\n        border-radius: 8px;\n      }\n      .vtt-folder-contents {\n        margin-left: 20px;\n        border-left: 1px solid var(--background-modifier-border);\n        padding-left: 8px;\n        overflow: hidden;\n        transition: max-height 200ms ease;\n      }\n      .vtt-folder-contents.collapsed {\n        max-height: 0 !important;\n        padding: 0;\n        margin: 0;\n      }\n      .vtt-file-grid {\n        display: grid;\n        grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));\n        gap: 8px;\n        padding: 8px 0;\n      }\n      .vtt-file-item {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        padding: 6px;\n        border-radius: 8px;\n        cursor: pointer;\n        transition: all 150ms ease;\n        background: transparent;\n        border: 2px solid transparent;\n      }\n      .vtt-file-item:hover {\n        background: var(--background-secondary);\n        border-color: var(--background-modifier-border);\n      }\n      .vtt-file-item.selected {\n        background: var(--interactive-accent-hover);\n        border-color: var(--interactive-accent);\n      }\n      .vtt-file-thumb {\n        width: 70px;\n        height: 70px;\n        border-radius: 6px;\n        overflow: hidden;\n        background: var(--background-secondary);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        margin-bottom: 4px;\n        box-shadow: 0 2px 6px rgba(0,0,0,0.15);\n        position: relative;\n      }\n      .vtt-file-thumb img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n      }\n      .vtt-file-thumb .vtt-note-icon {\n        font-size: 28px;\n        color: var(--text-muted);\n      }\n      .vtt-file-thumb .vtt-video-badge {\n        position: absolute;\n        bottom: 2px;\n        right: 2px;\n        background: rgba(0,0,0,0.7);\n        color: #fff;\n        font-size: 8px;\n        padding: 1px 4px;\n        border-radius: 3px;\n      }\n      .vtt-file-name {\n        font-size: 10px;\n        color: var(--text-normal);\n        text-align: center;\n        max-width: 80px;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n        line-height: 1.3;\n      }\n      .vtt-file-type {\n        font-size: 8px;\n        color: var(--text-muted);\n        text-transform: uppercase;\n        margin-top: 1px;\n      }\n      .vtt-favorite-btn {\n        position: absolute;\n        top: 2px;\n        right: 2px;\n        background: rgba(0,0,0,0.5);\n        border: none;\n        border-radius: 50%;\n        width: 20px;\n        height: 20px;\n        cursor: pointer;\n        font-size: 10px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        opacity: 0;\n        transition: opacity 150ms ease;\n      }\n      .vtt-file-item:hover .vtt-favorite-btn {\n        opacity: 1;\n      }\n      .vtt-favorite-btn.active {\n        opacity: 1;\n        color: gold;\n      }\n      .vtt-empty-state {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        justify-content: center;\n        padding: 24px;\n        color: var(--text-muted);\n        font-size: 12px;\n        text-align: center;\n      }\n      .vtt-empty-state svg {\n        width: 48px;\n        height: 48px;\n        margin-bottom: 8px;\n        opacity: 0.5;\n      }\n      .vtt-root-files {\n        margin-bottom: 8px;\n      }\n      .vtt-favorites-section {\n        background: var(--background-secondary-alt);\n        border-radius: 8px;\n        margin-bottom: 8px;\n        padding: 8px;\n      }\n      .vtt-favorites-title {\n        font-size: 11px;\n        font-weight: 600;\n        color: var(--text-muted);\n        margin-bottom: 8px;\n        display: flex;\n        align-items: center;\n        gap: 4px;\n      }\n    `;\n\n    // Header with controls\n    const header = container.createDiv({ cls: 'vtt-panel-header' });\n    \n    const openPopoutBtn = header.createEl('button', { text: '\uD83D\uDDA5\uFE0F Open Popout', cls: 'mod-cta' });\n    openPopoutBtn.addEventListener('click', () => this.plugin.openPopout());\n    \n    const prevBtn = header.createEl('button', { text: '\u25C0 Prev' });\n    prevBtn.addEventListener('click', () => this.plugin.prevCard());\n    \n    const nextBtn = header.createEl('button', { text: 'Next \u25B6' });\n    nextBtn.addEventListener('click', () => this.plugin.nextCard());\n    \n    const reloadBtn = header.createEl('button', { text: '\uD83D\uDD04' });\n    reloadBtn.title = 'Reload';\n    \n    const exportBtn = header.createEl('button', { text: '\uD83D\uDCCB' });\n    exportBtn.title = 'Export Session History';\n    exportBtn.addEventListener('click', () => this.exportSessionHistory());\n    reloadBtn.addEventListener('click', async () => {\n      reloadBtn.disabled = true;\n      reloadBtn.textContent = '\u23F3 Loading...';\n      try {\n        await this.plugin.loadCards();\n        await this.plugin.loadMaps();\n        await this.onOpen(); // Re-render the view\n        new Notice('Cards and Maps reloaded');\n      } catch (e) {\n        \n        new Notice('Failed to reload');\n      }\n    });\n    \n    // Player Info Toggle\n    const toggleContainer = header.createDiv({ cls: 'vtt-toggle-container' });\n    const toggleLabel = toggleContainer.createEl('label', { text: 'Player Info' });\n    const toggleCheckbox = toggleContainer.createEl('input') as HTMLInputElement;\n    toggleCheckbox.type = 'checkbox';\n    toggleCheckbox.checked = this.plugin.settings.showPlayerInfo || false;\n    toggleCheckbox.addEventListener('change', async () => {\n      this.plugin.settings.showPlayerInfo = toggleCheckbox.checked;\n      await this.plugin.saveData(this.plugin.settings);\n    });\n    \n    // Search row\n    const searchRow = header.createDiv({ cls: 'vtt-search-row' });\n    const searchInput = searchRow.createEl('input', { \n      cls: 'vtt-search-input',\n      attr: { type: 'text', placeholder: '\uD83D\uDD0D Filter cards and maps...' }\n    }) as HTMLInputElement;\n    \n    // Store filter state\n    let currentFilter = '';\n    \n    // Scrollable content area\n    const contentArea = container.createDiv({ cls: 'vtt-panel-content' });\n    \n    // Render function that can be called with filter\n    const renderContent = async (filter: string) => {\n      contentArea.empty();\n      \n      const filterLower = filter.toLowerCase();\n      \n      // Filter cards\n      const filteredCards = (this.plugin.cards || []).filter(card => {\n        if (!filter) return true;\n        const name = card.path ? card.path.split('/').pop()?.toLowerCase() || '' : '';\n        return name.includes(filterLower);\n      });\n      \n      // Filter maps\n      const filteredMaps = (this.plugin.maps || []).filter(map => {\n        if (!filter) return true;\n        const name = (map.title || map.path?.split('/').pop() || '').toLowerCase();\n        return name.includes(filterLower);\n      });\n      \n      // Render favorites section if there are favorites\n      const favorites = this.plugin.settings.favorites || [];\n      if (favorites.length > 0 && !filter) {\n        await this.renderFavoritesSection(contentArea, favorites);\n      }\n\n      // Cards section\n      await this.renderSection(contentArea, 'Cards', '\uD83C\uDFB4', filteredCards, 'card');\n      \n      // Maps section\n      await this.renderSection(contentArea, 'Maps', '\uD83D\uDDFA\uFE0F', filteredMaps, 'map');\n    };\n    \n    // Initial render\n    await renderContent('');\n    \n    // Search input handler with debounce\n    let searchTimeout: any = null;\n    searchInput.addEventListener('input', () => {\n      if (searchTimeout) clearTimeout(searchTimeout);\n      searchTimeout = setTimeout(async () => {\n        currentFilter = searchInput.value;\n        await renderContent(currentFilter);\n      }, 150);\n    });\n  }\n  \n  async renderFavoritesSection(container: HTMLElement, favorites: string[]) {\n    const favSection = container.createDiv({ cls: 'vtt-favorites-section' });\n    const title = favSection.createDiv({ cls: 'vtt-favorites-title' });\n    title.createEl('span', { text: '\u2B50' });\n    title.createEl('span', { text: `Favorites (${favorites.length})` });\n    \n    const grid = favSection.createDiv({ cls: 'vtt-file-grid' });\n    \n    for (const path of favorites) {\n      // Find the item in cards or maps\n      const card = (this.plugin.cards || []).find(c => c.path === path);\n      const map = (this.plugin.maps || []).find(m => m.path === path);\n      const item = card || map;\n      const type = card ? 'card' : 'map';\n      \n      if (item) {\n        await this.renderFileItem(grid, item, type, true);\n      }\n    }\n  }\n\n  async renderSection(container: HTMLElement, title: string, icon: string, items: any[], type: 'card' | 'map') {\n    const section = container.createDiv({ cls: 'vtt-section' });\n    \n    // Section header (clickable to collapse/expand)\n    const sectionHeader = section.createDiv({ cls: 'vtt-section-header' });\n    const collapseIcon = sectionHeader.createEl('span', { text: '\u25BC', cls: 'vtt-section-icon' });\n    sectionHeader.createEl('span', { text: icon });\n    sectionHeader.createEl('h3', { text: title, cls: 'vtt-section-title' });\n    sectionHeader.createEl('span', { text: `${items.length}`, cls: 'vtt-section-count' });\n    \n    // Section content container\n    const sectionContent = section.createDiv({ cls: 'vtt-section-content' });\n    \n    // Toggle collapse on header click\n    let isExpanded = true;\n    sectionHeader.addEventListener('click', () => {\n      isExpanded = !isExpanded;\n      if (isExpanded) {\n        sectionContent.removeClass('collapsed');\n        collapseIcon.removeClass('collapsed');\n      } else {\n        sectionContent.addClass('collapsed');\n        collapseIcon.addClass('collapsed');\n      }\n    });\n    \n    if (items.length === 0) {\n      const emptyState = sectionContent.createDiv({ cls: 'vtt-empty-state' });\n      emptyState.innerHTML = `\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\">\n          <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect>\n          <circle cx=\"8.5\" cy=\"8.5\" r=\"1.5\"></circle>\n          <polyline points=\"21 15 16 10 5 21\"></polyline>\n        </svg>\n        <span>No ${title.toLowerCase()} found</span>\n        <span style=\"font-size:10px;margin-top:4px\">Add files to the ${title} folder</span>\n      `;\n      return;\n    }\n    \n    // Get the base folder path for this section\n    const baseFolderPath = type === 'card' \n      ? (this.plugin.settings.folderPath || '').trim()\n      : (this.plugin.settings.mapsFolderPath || '').trim();\n    \n    // Build folder tree structure\n    const folderTree = this.buildFolderTree(items, baseFolderPath);\n    \n    // Create scrollable tree container inside section content\n    const treeContainer = sectionContent.createDiv({ cls: 'vtt-folder-tree' });\n    \n    // Render the folder tree\n    await this.renderFolderTree(treeContainer, folderTree, type, baseFolderPath);\n  }\n  \n  /**\n   * Build a hierarchical folder tree from flat item list\n   */\n  buildFolderTree(items: any[], baseFolderPath: string): Map<string, { items: any[], subfolders: Map<string, any> }> {\n    const root = new Map<string, { items: any[], subfolders: Map<string, any> }>();\n    \n    // Initialize root level\n    const rootNode = { items: [] as any[], subfolders: new Map<string, any>() };\n    root.set('__root__', rootNode);\n    \n    for (const item of items) {\n      if (!item.path) continue;\n      \n      // Get relative path from base folder\n      let relativePath = item.path;\n      if (baseFolderPath && item.path.startsWith(baseFolderPath + '/')) {\n        relativePath = item.path.substring(baseFolderPath.length + 1);\n      }\n      \n      const parts = relativePath.split('/');\n      const fileName = parts.pop(); // Remove filename\n      \n      if (parts.length === 0) {\n        // File is in root\n        rootNode.items.push(item);\n      } else {\n        // File is in a subfolder\n        let currentNode = rootNode;\n        for (const folderName of parts) {\n          if (!currentNode.subfolders.has(folderName)) {\n            currentNode.subfolders.set(folderName, { items: [], subfolders: new Map() });\n          }\n          currentNode = currentNode.subfolders.get(folderName);\n        }\n        currentNode.items.push(item);\n      }\n    }\n    \n    return root;\n  }\n  \n  /**\n   * Recursively render the folder tree\n   */\n  async renderFolderTree(\n    container: HTMLElement, \n    tree: Map<string, { items: any[], subfolders: Map<string, any> }>,\n    type: 'card' | 'map',\n    currentPath: string\n  ) {\n    const rootNode = tree.get('__root__');\n    if (!rootNode) return;\n    \n    // Sort subfolders alphabetically\n    const sortedFolders = Array.from(rootNode.subfolders.entries()).sort((a, b) => a[0].localeCompare(b[0]));\n    \n    // Render folders FIRST\n    for (const [folderName, folderData] of sortedFolders) {\n      await this.renderFolder(container, folderName, folderData, type, currentPath ? `${currentPath}/${folderName}` : folderName);\n    }\n    \n    // Then render root-level loose files\n    if (rootNode.items.length > 0) {\n      const rootFilesContainer = container.createDiv({ cls: 'vtt-root-files' });\n      await this.renderFileGrid(rootFilesContainer, rootNode.items, type);\n    }\n  }\n  \n  /**\n   * Render a single folder with its contents\n   */\n  async renderFolder(\n    container: HTMLElement,\n    folderName: string,\n    folderData: { items: any[], subfolders: Map<string, any> },\n    type: 'card' | 'map',\n    fullPath: string\n  ) {\n    const folder = container.createDiv({ cls: 'vtt-folder' });\n    \n    // Count total items in this folder and subfolders\n    const totalCount = this.countItemsRecursive(folderData);\n    \n    // Folder header (clickable to expand/collapse)\n    const header = folder.createDiv({ cls: 'vtt-folder-header' });\n    const iconSpan = header.createEl('span', { text: '\u25BC', cls: 'vtt-folder-icon collapsed' });\n    header.createEl('span', { text: '\uD83D\uDCC1' });\n    header.createEl('span', { text: folderName, cls: 'vtt-folder-name' });\n    header.createEl('span', { text: `${totalCount}`, cls: 'vtt-folder-count' });\n    \n    // Folder contents container - start collapsed\n    const contents = folder.createDiv({ cls: 'vtt-folder-contents collapsed' });\n    \n    // Render files in this folder\n    if (folderData.items.length > 0) {\n      await this.renderFileGrid(contents, folderData.items, type);\n    }\n    \n    // Recursively render subfolders\n    const sortedSubfolders = Array.from(folderData.subfolders.entries()).sort((a, b) => a[0].localeCompare(b[0]));\n    for (const [subName, subData] of sortedSubfolders) {\n      await this.renderFolder(contents, subName, subData, type, `${fullPath}/${subName}`);\n    }\n    \n    // Toggle expand/collapse on header click - start collapsed\n    let isExpanded = false;\n    header.addEventListener('click', () => {\n      isExpanded = !isExpanded;\n      if (isExpanded) {\n        contents.removeClass('collapsed');\n        iconSpan.removeClass('collapsed');\n      } else {\n        contents.addClass('collapsed');\n        iconSpan.addClass('collapsed');\n      }\n    });\n  }\n  \n  /**\n   * Count items recursively in a folder and its subfolders\n   */\n  countItemsRecursive(folderData: { items: any[], subfolders: Map<string, any> }): number {\n    let count = folderData.items.length;\n    for (const [, subData] of folderData.subfolders) {\n      count += this.countItemsRecursive(subData);\n    }\n    return count;\n  }\n  \n  /**\n   * Render a grid of files\n   */\n  async renderFileGrid(container: HTMLElement, items: any[], type: 'card' | 'map') {\n    const grid = container.createDiv({ cls: 'vtt-file-grid' });\n    \n    for (let idx = 0; idx < items.length; idx++) {\n      const entry = items[idx];\n      await this.renderFileItem(grid, entry, type, false);\n    }\n  }\n  \n  /**\n   * Render a single file item\n   */\n  async renderFileItem(container: HTMLElement, entry: any, type: 'card' | 'map', isFavoriteSection: boolean) {\n      const fileItem = container.createDiv({ cls: 'vtt-file-item' });\n      \n      const thumb = fileItem.createDiv({ cls: 'vtt-file-thumb' });\n      \n      // Determine the thumbnail\n      const isMarkdown = entry.path && entry.path.toLowerCase().endsWith('.md');\n      const isVideo = entry.path && /\\.(mp4|webm|ogg|mov)$/i.test(entry.path);\n      \n      if (isMarkdown) {\n        // For markdown files, try to extract first image for thumbnail\n        const thumbImg = await this.getNoteThumbnail(entry.path);\n        if (thumbImg && !thumbImg.startsWith('blob:')) {\n          const img = thumb.createEl('img');\n          img.loading = 'lazy';\n          img.src = thumbImg;\n          img.onerror = () => { img.style.display = 'none'; thumb.createEl('span', { text: '\uD83D\uDCC4', cls: 'vtt-note-icon' }); };\n        } else {\n          thumb.createEl('span', { text: '\uD83D\uDCC4', cls: 'vtt-note-icon' });\n        }\n      } else if (isVideo) {\n        // For videos, try to get/create a cached thumbnail\n        const videoThumbUrl = await this.plugin._getOrCreateVideoThumbnail(entry.path);\n        if (videoThumbUrl) {\n          const img = thumb.createEl('img');\n          img.loading = 'lazy';\n          img.src = videoThumbUrl;\n          img.onerror = () => { \n            img.style.display = 'none'; \n            thumb.createEl('span', { text: '\uD83C\uDFAC', cls: 'vtt-note-icon' }); \n          };\n          // Add video badge overlay\n          thumb.createEl('span', { text: 'VIDEO', cls: 'vtt-video-badge' });\n        } else {\n          // Fallback to video icon if thumbnail creation failed\n          thumb.createEl('span', { text: '\uD83C\uDFAC', cls: 'vtt-note-icon' });\n          thumb.createEl('span', { text: 'VIDEO', cls: 'vtt-video-badge' });\n        }\n      } else {\n        // For images, show the image using Obsidian's resource path (works in-app)\n        const img = thumb.createEl('img');\n        img.loading = 'lazy';\n        let srcVal = '';\n        if (entry.path && !isMarkdown) {\n          try {\n            const file = this.plugin.app.vault.getAbstractFileByPath(entry.path);\n            if (file) {\n              srcVal = this.plugin.app.vault.getResourcePath(file as any);\n            }\n          } catch (e) {\n            // File not found - no fallback to potentially stale URLs\n            srcVal = '';\n          }\n        }\n        // Only set src if we have a valid value (avoid stale app:// or blob: URLs)\n        if (srcVal && !srcVal.startsWith('blob:')) {\n          img.src = srcVal;\n        }\n        img.onerror = () => { img.style.display = 'none'; thumb.createEl('span', { text: '\uD83D\uDDBC\uFE0F', cls: 'vtt-note-icon' }); };\n      }\n      \n      // Favorite button\n      const path = entry.path;\n      const isFavorite = (this.plugin.settings.favorites || []).includes(path);\n      const favBtn = thumb.createEl('button', { \n        text: isFavorite ? '\u2B50' : '\u2606', \n        cls: 'vtt-favorite-btn' + (isFavorite ? ' active' : '') \n      });\n      favBtn.addEventListener('click', async (e) => {\n        e.stopPropagation();\n        const favorites = this.plugin.settings.favorites || [];\n        const idx = favorites.indexOf(path);\n        if (idx >= 0) {\n          favorites.splice(idx, 1);\n          favBtn.textContent = '\u2606';\n          favBtn.removeClass('active');\n        } else {\n          favorites.push(path);\n          favBtn.textContent = '\u2B50';\n          favBtn.addClass('active');\n        }\n        this.plugin.settings.favorites = favorites;\n        await this.plugin.saveData(this.plugin.settings);\n        \n        // Re-render if in favorites section\n        if (isFavoriteSection) {\n          await this.onOpen();\n        }\n      });\n      \n      // File name\n      const fileName = entry.title || ((entry.path ? ((entry.path || '').split('/').pop() || '').replace(/\\.[^.]+$/, '') : 'Untitled'));\n      fileItem.createEl('div', { text: fileName, cls: 'vtt-file-name', attr: { title: fileName } });\n      \n      // File type badge\n      const ext = entry.path ? (entry.path.split('.').pop() || '').toUpperCase() : '';\n      if (ext) {\n        fileItem.createEl('div', { text: ext, cls: 'vtt-file-type' });\n      }\n      \n      // Click handler\n      const allItems = type === 'card' ? this.plugin.cards : this.plugin.maps;\n      const globalIdx = allItems.findIndex((item: any) => item.path === path);\n      \n      fileItem.addEventListener('click', async () => {\n        // Visual feedback - clear all selections in this section\n        const section = fileItem.closest('.vtt-section, .vtt-favorites-section');\n        if (section) {\n          section.querySelectorAll('.vtt-file-item').forEach(el => el.removeClass('selected'));\n        }\n        fileItem.addClass('selected');\n        \n        // Add to session history\n        this.addToSessionHistory(path, type);\n        \n        if (type === 'card') {\n          this.plugin.current = globalIdx >= 0 ? globalIdx : 0;\n          this.plugin.openPopout();\n          this.plugin.sendCurrentToPopout();\n        } else {\n          await this.plugin.projectMapByPath(path);\n        }\n      });\n      \n      // Double click to open file in editor\n      fileItem.addEventListener('dblclick', async (e) => {\n        e.stopPropagation();\n        if (path) {\n          const file = this.plugin.app.vault.getAbstractFileByPath(path);\n          if (file) {\n            await this.plugin.app.workspace.openLinkText(path, '', false);\n          }\n        }\n      });\n  }\n  \n  addToSessionHistory(path: string, type: 'card' | 'map') {\n    if (!this.plugin.settings.sessionHistory) {\n      this.plugin.settings.sessionHistory = [];\n    }\n    this.plugin.settings.sessionHistory.push({\n      path,\n      timestamp: Date.now(),\n      type\n    });\n    // Keep only last 500 entries\n    if (this.plugin.settings.sessionHistory.length > 500) {\n      this.plugin.settings.sessionHistory = this.plugin.settings.sessionHistory.slice(-500);\n    }\n    this.plugin.saveData(this.plugin.settings);\n  }\n  \n  exportSessionHistory() {\n    const history = this.plugin.settings.sessionHistory || [];\n    if (history.length === 0) {\n      new Notice('No session history to export');\n      return;\n    }\n    \n    // Group by date\n    const grouped: Record<string, typeof history> = {};\n    for (const entry of history) {\n      const date = new Date(entry.timestamp).toLocaleDateString();\n      if (!grouped[date]) grouped[date] = [];\n      grouped[date].push(entry);\n    }\n    \n    // Build markdown\n    let md = '# Session History\\\\n\\\\n';\n    for (const [date, entries] of Object.entries(grouped)) {\n      md += `## ${date}\\\\n\\\\n`;\n      for (const entry of entries) {\n        const time = new Date(entry.timestamp).toLocaleTimeString();\n        const name = entry.path.split('/').pop()?.replace(/\\\\.[^.]+$/, '') || entry.path;\n        const icon = entry.type === 'card' ? '\uD83C\uDFB4' : '\uD83D\uDDFA\uFE0F';\n        md += `- ${time} ${icon} [[${entry.path}|${name}]]\\\\n`;\n      }\n      md += '\\\\n';\n    }\n    \n    // Create file\n    const fileName = `Session History ${new Date().toISOString().split('T')[0]}.md`;\n    this.plugin.app.vault.create(fileName, md.replace(/\\\\\\\\n/g, '\\\\n'))\n      .then(() => new Notice(`Exported to ${fileName}`))\n      .catch((e: any) => {\n        \n        new Notice('Failed to export session history');\n      });\n  }\n  \n  async getNoteThumbnail(notePath: string): Promise<string | null> {\n    try {\n      const file = this.plugin.app.vault.getAbstractFileByPath(notePath);\n      if (!file) return null;\n      \n      const content = await this.plugin.app.vault.read(file as any);\n      const noteDir = (file as any).parent?.path || '';\n      \n      // Supported media extensions\n      const imageExts = 'png|jpg|jpeg|gif|webp|svg';\n      const videoExts = 'mp4|webm|ogg|mov';\n      const allMediaExts = `${imageExts}|${videoExts}`;\n      \n      // Look for embedded media ![[file.ext]] or ![[_resources/file.ext]]\n      const embedRegex = new RegExp(`!\\\\[\\\\[([^\\\\]]+\\\\.(${allMediaExts}))\\\\]\\\\]`, 'i');\n      const embedMatch = content.match(embedRegex);\n      if (embedMatch) {\n        const mediaName = embedMatch[1];\n        const allFiles = this.plugin.app.vault.getFiles();\n        const isVideo = new RegExp(`\\\\.(${videoExts})$`, 'i').test(mediaName);\n        \n        // Try multiple resolution strategies\n        let mediaFile = allFiles.find((f: any) => f.path === mediaName);\n        \n        // Try relative to note directory (e.g., _resources/image.png -> Maps/_resources/image.png)\n        if (!mediaFile && noteDir) {\n          const relativePath = noteDir + '/' + mediaName;\n          mediaFile = allFiles.find((f: any) => f.path === relativePath);\n        }\n        \n        // Try by filename only\n        if (!mediaFile) {\n          const baseName = mediaName.split('/').pop();\n          mediaFile = allFiles.find((f: any) => f.name === baseName);\n        }\n        \n        // Try path ending\n        if (!mediaFile) {\n          mediaFile = allFiles.find((f: any) => f.path.endsWith(mediaName));\n        }\n        \n        if (mediaFile) {\n          if (isVideo) {\n            // For videos, get or create a cached thumbnail\n            return await this.plugin._getOrCreateVideoThumbnail(mediaFile.path);\n          } else {\n            // Use getResourcePath for images (returns app:// URL, no memory overhead)\n            return this.plugin.app.vault.getResourcePath(mediaFile);\n          }\n        }\n      }\n      \n      // Look for markdown image/video syntax ![](path)\n      const mdRegex = new RegExp(`!\\\\[[^\\\\]]*\\\\]\\\\(([^)]+\\\\.(${allMediaExts}))\\\\)`, 'i');\n      const mdMatch = content.match(mdRegex);\n      if (mdMatch) {\n        const mediaPath = mdMatch[1];\n        const isVideo = new RegExp(`\\\\.(${videoExts})$`, 'i').test(mediaPath);\n        \n        // Try absolute path first\n        let mediaFile = this.plugin.app.vault.getAbstractFileByPath(mediaPath);\n        // Try relative to note directory\n        if (!mediaFile && noteDir) {\n          mediaFile = this.plugin.app.vault.getAbstractFileByPath(noteDir + '/' + mediaPath);\n        }\n        if (mediaFile) {\n          if (isVideo) {\n            // For videos, get or create a cached thumbnail\n            return await this.plugin._getOrCreateVideoThumbnail((mediaFile as any).path);\n          } else {\n            // Use getResourcePath for images (returns app:// URL, no memory overhead)\n            return this.plugin.app.vault.getResourcePath(mediaFile as any);\n          }\n        }\n      }\n      \n      return null;\n    } catch (e) {\n      \n      return null;\n    }\n  }\n  \n  async onClose() {}\n}\n", "/**\n * VTT Card Display - Constants\n */\nimport type { Settings } from './types';\n\n/** Default plugin settings */\nexport const DEFAULT_SETTINGS: Settings = {\n  folderPath: 'Cards',\n  mapsFolderPath: 'Maps',\n  popoutLeft: 1920,\n  popoutTop: 0,\n  popoutWidth: 800,\n  popoutHeight: 600,\n  statblockSelectors: '.statblock,.stat-block,.quickmonster,.qm,.statblock-render,.statblock-container',\n  showPlayerInfo: false,\n  favorites: [],\n  sessionHistory: [],\n  gridSize: 50,\n  gridColor: '#ffffff',\n  gridOpacity: 0.3,\n  fogRevealSize: 30\n};\n\n/** Supported image and video file extensions */\nexport const IMAGE_EXTENSIONS = ['.png', '.jpg', '.jpeg', '.bmp', '.tif', '.tiff', '.gif', '.webp', '.svg', '.ico', '.mp4', '.webm', '.ogg', '.mov'];\n\n/** View type identifier */\nexport const VIEW_TYPE_CARD = 'vtt-card-view';\n", "/**\n * VTT Card Display - Search API Functions\n * \n * All external API searches for monster images and battle maps\n */\nimport type { SearchResult, BattleMapResult } from './types';\nimport { IMAGE_EXTENSIONS } from './constants';\nimport type { App, Vault, TFile } from 'obsidian';\n\n/**\n * Search local vault for monster images\n */\nexport async function searchLocalVault(\n  vault: Vault, \n  searchQuery: string\n): Promise<SearchResult[]> {\n  const results: SearchResult[] = [];\n  const searchTerms = searchQuery.toLowerCase().split(/\\s+/);\n  \n  try {\n    const allFiles = vault.getFiles();\n    const imageFiles = allFiles.filter((f: TFile) => \n      IMAGE_EXTENSIONS.some(ext => f.name.toLowerCase().endsWith(ext))\n    );\n    \n    for (const file of imageFiles) {\n      const fileName = file.name.toLowerCase();\n      const filePath = file.path.toLowerCase();\n      \n      const matchesAll = searchTerms.every(term => \n        fileName.includes(term) || filePath.includes(term)\n      );\n      \n      const matchesSome = searchTerms.some(term => \n        fileName.includes(term) || filePath.includes(term)\n      );\n      \n      if (matchesAll) {\n        const resourcePath = vault.getResourcePath(file);\n        results.unshift({\n          url: resourcePath,\n          source: 'Local Vault',\n          title: file.name.replace(/\\.[^.]+$/, '')\n        });\n      } else if (matchesSome && results.length < 20) {\n        const resourcePath = vault.getResourcePath(file);\n        results.push({\n          url: resourcePath,\n          source: 'Local Vault',\n          title: file.name.replace(/\\.[^.]+$/, '')\n        });\n      }\n      \n      if (results.length >= 20) break;\n    }\n  } catch (e) { /* ignore */ }\n  \n  return results;\n}\n\n/**\n * Search Fandom wikis\n */\nexport async function searchFandomWikis(monsterName: string): Promise<SearchResult[]> {\n  const results: SearchResult[] = [];\n  \n  const wikis = [\n    { base: 'forgottenrealms.fandom.com', name: 'Forgotten Realms Wiki' },\n    { base: 'dnd.fandom.com', name: 'D&D Wiki' },\n  ];\n  \n  const searchVariants = [\n    monsterName,\n    monsterName.replace(/\\s+/g, '_'),\n  ];\n  \n  for (const wiki of wikis) {\n    for (const searchName of searchVariants) {\n      try {\n        const url = `https://${wiki.base}/api.php?action=query&titles=${encodeURIComponent(searchName)}&prop=pageimages|images&piprop=original&format=json&origin=*&imlimit=10`;\n        const response = await fetch(url);\n        if (!response.ok) continue;\n        \n        const data = await response.json();\n        const pages = data.query?.pages || {};\n        \n        for (const pageId in pages) {\n          if (pageId === '-1') continue;\n          const page = pages[pageId];\n          \n          if (page.original?.source) {\n            results.push({\n              url: page.original.source,\n              source: wiki.name,\n              title: page.title || monsterName\n            });\n          }\n        }\n        if (results.length > 0) break;\n      } catch (e) { /* CORS error expected */ }\n    }\n  }\n  \n  return results;\n}\n\n/**\n * Search D&D Beyond known monster images\n */\nexport function searchDndBeyond(monsterName: string): SearchResult[] {\n  const results: SearchResult[] = [];\n  \n  const knownMonsters: Record<string, string[]> = {\n    'beholder': ['https://www.dndbeyond.com/avatars/thumbnails/30783/57/1000/1000/638062024584880857.png'],\n    'mind flayer': ['https://www.dndbeyond.com/avatars/thumbnails/30835/570/1000/1000/638063842570726627.png'],\n    'owlbear': ['https://www.dndbeyond.com/avatars/thumbnails/30835/876/1000/1000/638063843970232932.png'],\n    'dragon': ['https://www.dndbeyond.com/avatars/thumbnails/30761/974/1000/1000/638061113344926498.png'],\n    'goblin': ['https://www.dndbeyond.com/avatars/thumbnails/30784/623/1000/1000/638062027226498498.png'],\n    'orc': ['https://www.dndbeyond.com/avatars/thumbnails/30835/914/1000/1000/638063844132752513.png'],\n    'skeleton': ['https://www.dndbeyond.com/avatars/thumbnails/30836/389/1000/1000/638063846088583498.png'],\n    'zombie': ['https://www.dndbeyond.com/avatars/thumbnails/30837/79/1000/1000/638063848914306498.png'],\n    'troll': ['https://www.dndbeyond.com/avatars/thumbnails/30836/890/1000/1000/638063848107658498.png'],\n    'giant': ['https://www.dndbeyond.com/avatars/thumbnails/30784/333/1000/1000/638062026084648498.png'],\n    'wolf': ['https://www.dndbeyond.com/avatars/thumbnails/30837/28/1000/1000/638063848711583498.png'],\n    'spider': ['https://www.dndbeyond.com/avatars/thumbnails/30836/440/1000/1000/638063846307193498.png'],\n    'mimic': ['https://www.dndbeyond.com/avatars/thumbnails/30835/495/1000/1000/638063842254523498.png'],\n    'gelatinous cube': ['https://www.dndbeyond.com/avatars/thumbnails/30784/295/1000/1000/638062025946428498.png'],\n    'lich': ['https://www.dndbeyond.com/avatars/thumbnails/30835/305/1000/1000/638063841536473498.png'],\n    'vampire': ['https://www.dndbeyond.com/avatars/thumbnails/30836/930/1000/1000/638063848269628498.png'],\n    'werewolf': ['https://www.dndbeyond.com/avatars/thumbnails/30836/995/1000/1000/638063848531823498.png'],\n    'demon': ['https://www.dndbeyond.com/avatars/thumbnails/30783/400/1000/1000/638062025308243498.png'],\n    'devil': ['https://www.dndbeyond.com/avatars/thumbnails/30783/474/1000/1000/638062025514888498.png'],\n    'elemental': ['https://www.dndbeyond.com/avatars/thumbnails/30783/808/1000/1000/638062026634568498.png'],\n  };\n  \n  const lowerName = monsterName.toLowerCase();\n  for (const [key, urls] of Object.entries(knownMonsters)) {\n    if (lowerName.includes(key)) {\n      for (const url of urls) {\n        results.push({ url, source: 'D&D Beyond', title: monsterName });\n      }\n    }\n  }\n  \n  return results;\n}\n\n/**\n * Search ArtStation\n */\nexport async function searchArtStation(monsterName: string): Promise<SearchResult[]> {\n  const results: SearchResult[] = [];\n  \n  try {\n    const searchQuery = encodeURIComponent(`dnd ${monsterName}`);\n    const url = `https://www.artstation.com/api/v2/search/projects.json?query=${searchQuery}&page=1&per_page=5`;\n    \n    const response = await fetch(url, { headers: { 'Accept': 'application/json' } });\n    \n    if (response.ok) {\n      const data = await response.json();\n      const projects = data.data || [];\n      \n      for (const project of projects.slice(0, 5)) {\n        if (project.cover?.medium_image_url) {\n          results.push({\n            url: project.cover.medium_image_url.replace('/medium/', '/large/'),\n            source: 'ArtStation',\n            title: project.title || monsterName\n          });\n        }\n      }\n    }\n  } catch (e) { /* CORS error expected */ }\n  \n  return results;\n}\n\n/**\n * Search DeviantArt\n */\nexport async function searchDeviantArt(monsterName: string): Promise<SearchResult[]> {\n  const results: SearchResult[] = [];\n  \n  try {\n    const searchQuery = encodeURIComponent(`dnd ${monsterName} fantasy`);\n    const url = `https://backend.deviantart.com/rss.xml?type=deviation&q=${searchQuery}`;\n    \n    const response = await fetch(url);\n    if (response.ok) {\n      const text = await response.text();\n      const parser = new DOMParser();\n      const xml = parser.parseFromString(text, 'text/xml');\n      const items = xml.querySelectorAll('item');\n      \n      for (let i = 0; i < Math.min(items.length, 5); i++) {\n        const item = items[i];\n        const title = item.querySelector('title')?.textContent || monsterName;\n        const mediaContent = item.getElementsByTagName('media:content')[0];\n        const mediaThumbnail = item.getElementsByTagName('media:thumbnail')[0];\n        const imageUrl = mediaContent?.getAttribute('url') || mediaThumbnail?.getAttribute('url');\n        \n        if (imageUrl) {\n          results.push({ url: imageUrl, source: 'DeviantArt', title });\n        }\n      }\n    }\n  } catch (e) { /* CORS error expected */ }\n  \n  return results;\n}\n\n/**\n * Search Reddit for monster art\n */\nexport async function searchReddit(monsterName: string): Promise<SearchResult[]> {\n  const results: SearchResult[] = [];\n  \n  const subreddits = [\n    'DnD', 'dndart', 'ImaginaryMonsters', 'ImaginaryDragons', \n    'DungeonsAndDragons', 'battlemaps'\n  ];\n  \n  for (const subreddit of subreddits) {\n    try {\n      const searchQuery = encodeURIComponent(monsterName);\n      const url = `https://www.reddit.com/r/${subreddit}/search.json?q=${searchQuery}&restrict_sr=1&limit=5&sort=relevance&t=all`;\n      \n      const response = await fetch(url, {\n        headers: { 'User-Agent': 'ObsidianVTTCardDisplay/1.0' }\n      });\n      \n      if (response.ok) {\n        const data = await response.json();\n        const posts = data.data?.children || [];\n        \n        for (const post of posts) {\n          const postData = post.data;\n          let imageUrl = '';\n          \n          if (postData.url && /\\.(jpg|jpeg|png|gif|webp)$/i.test(postData.url)) {\n            imageUrl = postData.url;\n          } else if (postData.url && postData.url.includes('i.redd.it')) {\n            imageUrl = postData.url;\n          } else if (postData.preview?.images?.[0]?.source?.url) {\n            imageUrl = postData.preview.images[0].source.url.replace(/&amp;/g, '&');\n          } else if (postData.url && postData.url.includes('imgur.com')) {\n            imageUrl = postData.url;\n            if (!imageUrl.match(/\\.(jpg|jpeg|png|gif|webp)$/i)) {\n              imageUrl = imageUrl.replace('imgur.com', 'i.imgur.com') + '.jpg';\n            }\n          }\n          \n          if (imageUrl) {\n            results.push({\n              url: imageUrl,\n              source: `Reddit r/${subreddit}`,\n              title: postData.title || monsterName\n            });\n          }\n        }\n      }\n    } catch (e) { /* CORS or network error */ }\n    \n    if (results.length >= 15) break;\n  }\n  \n  return results;\n}\n\n/**\n * Search Reddit for battle maps\n */\nexport async function searchRedditBattlemaps(\n  query: string, \n  animatedOnly: boolean = false\n): Promise<BattleMapResult[]> {\n  const results: BattleMapResult[] = [];\n  \n  try {\n    const searchQuery = encodeURIComponent(query + ' battle map');\n    const url = `https://www.reddit.com/r/battlemaps+dndmaps+dungeondraft/search.json?q=${searchQuery}&restrict_sr=1&limit=25&sort=top&t=all`;\n    \n    const response = await fetch(url, {\n      headers: { 'User-Agent': 'ObsidianVTTCardDisplay/1.0' }\n    });\n    \n    if (response.ok) {\n      const data = await response.json();\n      const posts = data?.data?.children || [];\n      \n      for (const post of posts) {\n        const postData = post.data;\n        if (!postData) continue;\n        \n        let imageUrl = '';\n        let thumbnail = '';\n        let isAnimated = false;\n        \n        // Get thumbnail\n        if (postData.preview?.images?.[0]?.source?.url) {\n          thumbnail = postData.preview.images[0].source.url.replace(/&amp;/g, '&');\n        }\n        \n        // Check content type\n        if (postData.url && /\\.(jpg|jpeg|png|webp)$/i.test(postData.url)) {\n          imageUrl = postData.url;\n        } else if (postData.url && /\\.gif$/i.test(postData.url)) {\n          imageUrl = postData.url;\n          isAnimated = true;\n        } else if (postData.is_video && postData.media?.reddit_video?.fallback_url) {\n          imageUrl = postData.media.reddit_video.fallback_url;\n          isAnimated = true;\n        } else if (postData.preview?.images?.[0]?.source?.url) {\n          imageUrl = postData.preview.images[0].source.url.replace(/&amp;/g, '&');\n        } else if (postData.url && postData.url.includes('i.redd.it')) {\n          imageUrl = postData.url;\n        }\n        \n        if (imageUrl && (!animatedOnly || isAnimated)) {\n          results.push({\n            url: imageUrl,\n            title: postData.title || 'Battle Map',\n            source: 'Reddit r/battlemaps',\n            thumbnail: thumbnail || imageUrl,\n            animated: isAnimated\n          });\n        }\n      }\n    }\n  } catch (e) { /* ignore */ }\n  \n  return results;\n}\n\n/**\n * Search DeviantArt for battle maps\n */\nexport async function searchDeviantArtMaps(\n  query: string, \n  animatedOnly: boolean = false\n): Promise<BattleMapResult[]> {\n  if (animatedOnly) return []; // DeviantArt doesn't have animated maps\n  \n  const results: BattleMapResult[] = [];\n  \n  try {\n    const searchQuery = encodeURIComponent(`${query} battle map dnd`);\n    const url = `https://backend.deviantart.com/rss.xml?type=deviation&q=${searchQuery}`;\n    \n    const response = await fetch(url);\n    if (response.ok) {\n      const text = await response.text();\n      const parser = new DOMParser();\n      const xml = parser.parseFromString(text, 'text/xml');\n      const items = xml.querySelectorAll('item');\n      \n      for (let i = 0; i < Math.min(items.length, 10); i++) {\n        const item = items[i];\n        const title = item.querySelector('title')?.textContent || 'Battle Map';\n        const mediaContent = item.getElementsByTagName('media:content')[0];\n        const mediaThumbnail = item.getElementsByTagName('media:thumbnail')[0];\n        const imageUrl = mediaContent?.getAttribute('url') || mediaThumbnail?.getAttribute('url');\n        \n        if (imageUrl) {\n          results.push({\n            url: imageUrl,\n            title,\n            source: 'DeviantArt',\n            thumbnail: imageUrl\n          });\n        }\n      }\n    }\n  } catch (e) { /* ignore */ }\n  \n  return results;\n}\n\n/**\n * Remove duplicate results based on URL\n */\nexport function deduplicateResults<T extends { url: string }>(results: T[]): T[] {\n  const seen = new Set<string>();\n  return results.filter(r => {\n    if (seen.has(r.url)) return false;\n    seen.add(r.url);\n    return true;\n  });\n}\n", "/**\n * VTT Card Display - Popout HTML Builder\n * \n * Contains the HTML template for the popout projection window\n */\nimport type { Settings } from './types';\n\n/**\n * Build the HTML content for the popout projection window\n */\nexport function buildPopoutHtml(settings: Settings): string {\n  const gridSize = settings.gridSize ?? 50;\n  const gridColor = settings.gridColor ?? '#ffffff';\n  const gridOpacity = settings.gridOpacity ?? 0.3;\n  const fogRevealSize = settings.fogRevealSize ?? 30;\n  \n  return `<!doctype html>\n<html>\n<head>\n  <meta charset=\"utf-8\">\n  <title>VTT Projection</title>\n  <style>\n    * { box-sizing: border-box; margin: 0; padding: 0; }\n    html, body { \n      width: 100vw; \n      height: 100vh; \n      overflow: hidden; \n      background: #000; \n      font-family: system-ui, -apple-system, sans-serif;\n    }\n    \n    /* Main container */\n    #container {\n      position: relative;\n      width: 100%;\n      height: 100%;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      overflow: hidden;\n    }\n    \n    /* Content wrapper for zoom/pan */\n    #content-wrapper {\n      position: relative;\n      transform-origin: center center;\n      transition: none;\n    }\n    \n    /* Image display */\n    #img {\n      max-width: 100vw;\n      max-height: 100vh;\n      object-fit: contain;\n      display: block;\n    }\n    \n    /* Grid overlay */\n    #grid-overlay {\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      pointer-events: none;\n      display: none;\n      z-index: 10;\n    }\n    \n    /* Fog of war canvas - positioned over container, doesn't rotate */\n    #fog-canvas {\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100vw;\n      height: 100vh;\n      pointer-events: none;\n      display: none;\n      z-index: 20;\n    }\n    \n    /* HTML content (statblocks, notes with images, etc.) */\n    #html {\n      display: none;\n      background: transparent;\n      color: #eee;\n      overflow: visible;\n      width: 100%;\n      height: 100%;\n    }\n    \n    /* Style for HTML content that should be scrollable (statblocks) */\n    #html.scrollable {\n      background: #1a1a2e;\n      padding: 24px;\n      overflow: auto;\n      max-height: 100vh;\n    }\n    \n    /* Make images/videos in HTML content behave like the main img */\n    #html img, #html video {\n      max-width: 100vw;\n      max-height: 100vh;\n      object-fit: contain;\n      display: block;\n      margin: auto;\n    }\n    \n    /* Controls panel */\n    #controls {\n      position: fixed;\n      top: 10px;\n      right: 10px;\n      background: rgba(0,0,0,0.85);\n      padding: 12px;\n      border-radius: 8px;\n      z-index: 1000;\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n      min-width: 200px;\n      backdrop-filter: blur(10px);\n      border: 1px solid rgba(255,255,255,0.1);\n    }\n    \n    #controls.collapsed {\n      min-width: auto;\n      padding: 8px;\n    }\n    \n    #controls.collapsed .control-content {\n      display: none;\n    }\n    \n    .control-header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      color: #fff;\n      font-weight: 600;\n      font-size: 12px;\n    }\n    \n    .toggle-btn {\n      background: none;\n      border: none;\n      color: #fff;\n      cursor: pointer;\n      font-size: 16px;\n      padding: 4px;\n    }\n    \n    .control-section {\n      margin-top: 8px;\n      padding-top: 8px;\n      border-top: 1px solid rgba(255,255,255,0.1);\n    }\n    \n    .control-section label {\n      color: #aaa;\n      font-size: 11px;\n      display: block;\n      margin-bottom: 4px;\n    }\n    \n    .control-row {\n      display: flex;\n      gap: 8px;\n      align-items: center;\n      margin-bottom: 6px;\n    }\n    \n    .control-row input[type=\"range\"] {\n      flex: 1;\n      height: 4px;\n    }\n    \n    .control-row input[type=\"color\"] {\n      width: 30px;\n      height: 24px;\n      border: none;\n      border-radius: 4px;\n      cursor: pointer;\n    }\n    \n    .control-row input[type=\"checkbox\"] {\n      width: 16px;\n      height: 16px;\n    }\n    \n    .control-btn {\n      background: rgba(255,255,255,0.1);\n      border: 1px solid rgba(255,255,255,0.2);\n      color: #fff;\n      padding: 6px 10px;\n      border-radius: 4px;\n      cursor: pointer;\n      font-size: 11px;\n      transition: all 150ms;\n    }\n    \n    .control-btn:hover {\n      background: rgba(255,255,255,0.2);\n    }\n    \n    .control-btn.active {\n      background: var(--accent-color, #7c3aed);\n      border-color: var(--accent-color, #7c3aed);\n    }\n    \n    .zoom-display {\n      color: #fff;\n      font-size: 11px;\n      min-width: 40px;\n      text-align: center;\n    }\n    \n    /* Rotation info */\n    #rotation-info {\n      position: fixed;\n      bottom: 10px;\n      left: 10px;\n      background: rgba(0,0,0,0.7);\n      color: #fff;\n      padding: 6px 12px;\n      border-radius: 4px;\n      font-size: 12px;\n      display: none;\n      z-index: 100;\n    }\n    \n    /* Player info overlay */\n    #player-info-overlay {\n      position: fixed;\n      top: 60px;\n      right: 10px;\n      background: rgba(0,0,0,0.85);\n      color: #fff;\n      padding: 12px 16px;\n      border-radius: 8px;\n      font-size: 14px;\n      max-width: 300px;\n      max-height: 40vh;\n      overflow-y: auto;\n      z-index: 999;\n      display: none;\n      backdrop-filter: blur(10px);\n      border: 1px solid rgba(255,255,255,0.1);\n    }\n    \n    #player-info-overlay h1, #player-info-overlay h2, #player-info-overlay h3 {\n      margin-top: 0;\n      font-size: 1.1em;\n    }\n    \n    /* Auto-hide controls when collapsed after timeout */\n    #controls.collapsed.auto-hidden {\n      opacity: 0;\n      pointer-events: none;\n      transition: opacity 300ms ease;\n    }\n    \n    #controls.collapsed:not(.auto-hidden) {\n      opacity: 1;\n      transition: opacity 300ms ease;\n    }\n    \n    #controls:hover, #controls:focus-within {\n      opacity: 1 !important;\n      pointer-events: auto !important;\n    }\n  </style>\n</head>\n<body>\n  <div id=\"container\">\n    <div id=\"content-wrapper\">\n      <img id=\"img\" src=\"\" alt=\"Card\" />\n      <video id=\"video\" style=\"display:none;max-width:100vw;max-height:100vh;object-fit:contain;\" loop></video>\n      <div id=\"html\"></div>\n      <canvas id=\"grid-overlay\"></canvas>\n    </div>\n    <!-- Fog canvas outside wrapper so it doesn't rotate with image -->\n    <canvas id=\"fog-canvas\"></canvas>\n  </div>\n  \n  <!-- Controls Panel -->\n  <div id=\"controls\">\n    <div class=\"control-header\">\n      <span>\uD83C\uDFAE Controls</span>\n      <button class=\"toggle-btn\" id=\"toggle-controls\">\u2212</button>\n    </div>\n    <div class=\"control-content\">\n      <!-- Zoom/Pan Section -->\n      <div class=\"control-section\">\n        <label>Zoom & Pan</label>\n        <div class=\"control-row\">\n          <button class=\"control-btn\" id=\"zoom-out\">\u2212</button>\n          <span class=\"zoom-display\" id=\"zoom-level\">100%</span>\n          <button class=\"control-btn\" id=\"zoom-in\">+</button>\n          <button class=\"control-btn\" id=\"zoom-reset\">Reset</button>\n        </div>\n      </div>\n      \n      <!-- Grid Section -->\n      <div class=\"control-section\">\n        <label>Grid Overlay</label>\n        <div class=\"control-row\">\n          <input type=\"checkbox\" id=\"grid-toggle\" />\n          <span style=\"color:#fff;font-size:11px;\">Show Grid</span>\n        </div>\n        <div class=\"control-row\">\n          <label style=\"min-width:40px;\">Size</label>\n          <input type=\"range\" id=\"grid-size\" min=\"10\" max=\"200\" value=\"${gridSize}\" />\n          <span id=\"grid-size-value\" style=\"color:#fff;font-size:11px;min-width:35px;\">${gridSize}px</span>\n        </div>\n        <div class=\"control-row\">\n          <label style=\"min-width:40px;\">Color</label>\n          <input type=\"color\" id=\"grid-color\" value=\"${gridColor}\" />\n          <input type=\"range\" id=\"grid-opacity\" min=\"5\" max=\"100\" value=\"${Math.round(gridOpacity * 100)}\" style=\"flex:1;\" />\n        </div>\n      </div>\n      \n      <!-- Fog of War Section -->\n      <div class=\"control-section\">\n        <label>Fog of War</label>\n        <div class=\"control-row\">\n          <input type=\"checkbox\" id=\"fog-toggle\" />\n          <span style=\"color:#fff;font-size:11px;\">Enable Fog</span>\n        </div>\n        <div class=\"control-row\">\n          <label style=\"min-width:50px;\">Brush</label>\n          <input type=\"range\" id=\"fog-size\" min=\"10\" max=\"150\" value=\"${fogRevealSize}\" />\n          <span id=\"fog-size-value\" style=\"color:#fff;font-size:11px;min-width:35px;\">${fogRevealSize}px</span>\n        </div>\n        <div class=\"control-row\">\n          <button class=\"control-btn\" id=\"fog-reset\">Reset Fog</button>\n          <button class=\"control-btn\" id=\"fog-reveal-all\">Reveal All</button>\n        </div>\n      </div>\n      \n      <!-- Rotation Section -->\n      <div class=\"control-section\">\n        <label>Rotation</label>\n        <div class=\"control-row\">\n          <button class=\"control-btn\" id=\"rotate-left\">\u21BA 90\u00B0</button>\n          <span class=\"zoom-display\" id=\"rotation-display\">0\u00B0</span>\n          <button class=\"control-btn\" id=\"rotate-right\">\u21BB 90\u00B0</button>\n          <button class=\"control-btn\" id=\"rotate-reset\">Reset</button>\n        </div>\n      </div>\n      \n      <!-- Player Info Section -->\n      <div class=\"control-section\">\n        <label>Player Info</label>\n        <div class=\"control-row\">\n          <input type=\"checkbox\" id=\"player-info-toggle\" />\n          <span style=\"color:#fff;font-size:11px;\">Show Player Info</span>\n        </div>\n      </div>\n      \n      <!-- Export Section -->\n      <div class=\"control-section\">\n        <div class=\"control-row\">\n          <button class=\"control-btn\" id=\"export-btn\" style=\"flex:1;\">\uD83D\uDCF8 Export Image</button>\n        </div>\n      </div>\n    </div>\n  </div>\n  \n  <div id=\"player-info-overlay\"></div>\n  <div id=\"rotation-info\"></div>\n  \n  <script>\n    // State\n    let currentZoom = 1;\n    let panX = 0, panY = 0;\n    let isDragging = false;\n    let dragStartX = 0, dragStartY = 0;\n    let gridEnabled = false;\n    let fogEnabled = false;\n    let currentRotation = 0;\n    let showPlayerInfo = false;\n    let playerInfoContent = '';\n    let controlsAutoHideTimer = null;\n    let controlsCollapsed = false;\n    let fogRevealSize = ${fogRevealSize};\n    let isDrawingFog = false;\n    \n    // Elements\n    const container = document.getElementById('container');\n    const wrapper = document.getElementById('content-wrapper');\n    const img = document.getElementById('img');\n    const video = document.getElementById('video');\n    const htmlEl = document.getElementById('html');\n    const gridCanvas = document.getElementById('grid-overlay');\n    const fogCanvas = document.getElementById('fog-canvas');\n    const gridCtx = gridCanvas.getContext('2d');\n    const fogCtx = fogCanvas.getContext('2d');\n    \n    // Controls\n    const toggleBtn = document.getElementById('toggle-controls');\n    const controls = document.getElementById('controls');\n    const playerInfoOverlay = document.getElementById('player-info-overlay');\n    const rotationInfo = document.getElementById('rotation-info');\n    \n    // Auto-hide timer for collapsed controls\n    function startAutoHideTimer() {\n      if (controlsAutoHideTimer) clearTimeout(controlsAutoHideTimer);\n      if (controlsCollapsed) {\n        controlsAutoHideTimer = setTimeout(() => {\n          controls.classList.add('auto-hidden');\n        }, 3000);\n      }\n    }\n    \n    function showControls() {\n      controls.classList.remove('auto-hidden');\n      startAutoHideTimer();\n    }\n    \n    // Show controls on mouse move anywhere\n    document.addEventListener('mousemove', showControls);\n    \n    toggleBtn.addEventListener('click', () => {\n      controls.classList.toggle('collapsed');\n      controlsCollapsed = controls.classList.contains('collapsed');\n      toggleBtn.textContent = controlsCollapsed ? '+' : '\u2212';\n      if (controlsCollapsed) {\n        startAutoHideTimer();\n      } else {\n        if (controlsAutoHideTimer) clearTimeout(controlsAutoHideTimer);\n        controls.classList.remove('auto-hidden');\n      }\n    });\n    \n    // Zoom controls\n    document.getElementById('zoom-in').addEventListener('click', () => setZoom(currentZoom + 0.25));\n    document.getElementById('zoom-out').addEventListener('click', () => setZoom(currentZoom - 0.25));\n    document.getElementById('zoom-reset').addEventListener('click', () => { currentZoom = 1; panX = 0; panY = 0; updateTransform(); });\n    \n    // Rotation controls\n    document.getElementById('rotate-left').addEventListener('click', () => setRotation(currentRotation - 90));\n    document.getElementById('rotate-right').addEventListener('click', () => setRotation(currentRotation + 90));\n    document.getElementById('rotate-reset').addEventListener('click', () => setRotation(0));\n    \n    function setRotation(deg) {\n      currentRotation = ((deg % 360) + 360) % 360;\n      // Reset pan\n      panX = 0;\n      panY = 0;\n      \n      // Calculate optimal zoom to fit content (touch at least 2 sides)\n      fitContentToViewport();\n      \n      document.getElementById('rotation-display').textContent = currentRotation + '\u00B0';\n      // Show rotation info briefly\n      rotationInfo.textContent = 'Rotation: ' + currentRotation + '\u00B0';\n      rotationInfo.style.display = 'block';\n      setTimeout(() => { rotationInfo.style.display = 'none'; }, 1500);\n    }\n    \n    // Fit content to viewport so it touches at least 2 sides\n    function fitContentToViewport() {\n      const vw = window.innerWidth;\n      const vh = window.innerHeight;\n      const isRotated90 = (currentRotation === 90 || currentRotation === 270);\n      \n      // Get content natural dimensions\n      let naturalW = 0, naturalH = 0;\n      \n      if (img.style.display !== 'none' && img.src && img.naturalWidth) {\n        naturalW = img.naturalWidth;\n        naturalH = img.naturalHeight;\n      } else if (video.style.display !== 'none' && video.src && video.videoWidth) {\n        naturalW = video.videoWidth;\n        naturalH = video.videoHeight;\n      } else if (htmlEl.style.display !== 'none') {\n        const htmlImg = htmlEl.querySelector('img');\n        const htmlVid = htmlEl.querySelector('video');\n        if (htmlImg && htmlImg.naturalWidth) {\n          naturalW = htmlImg.naturalWidth;\n          naturalH = htmlImg.naturalHeight;\n        } else if (htmlVid && htmlVid.videoWidth) {\n          naturalW = htmlVid.videoWidth;\n          naturalH = htmlVid.videoHeight;\n        }\n      }\n      \n      if (!naturalW || !naturalH) {\n        currentZoom = 1;\n        updateTransform();\n        return;\n      }\n      \n      // CSS already scales image to fit viewport with object-fit: contain\n      // So the displayed size is determined by CSS max-width/max-height\n      // Calculate what CSS displays the image as:\n      const cssScaleX = vw / naturalW;\n      const cssScaleY = vh / naturalH;\n      const cssScale = Math.min(cssScaleX, cssScaleY);\n      const displayedW = naturalW * cssScale;\n      const displayedH = naturalH * cssScale;\n      \n      // When rotated 90/270, the displayed dimensions are swapped\n      let effectiveW = isRotated90 ? displayedH : displayedW;\n      let effectiveH = isRotated90 ? displayedW : displayedH;\n      \n      // Calculate zoom needed to make content fit viewport after rotation\n      const neededScaleX = vw / effectiveW;\n      const neededScaleY = vh / effectiveH;\n      currentZoom = Math.min(neededScaleX, neededScaleY);\n      \n      updateTransform();\n    }\n    \n    // Player Info toggle\n    document.getElementById('player-info-toggle').addEventListener('change', (e) => {\n      showPlayerInfo = e.target.checked;\n      updatePlayerInfoOverlay();\n    });\n    \n    function updatePlayerInfoOverlay() {\n      if (showPlayerInfo && playerInfoContent) {\n        playerInfoOverlay.innerHTML = playerInfoContent;\n        playerInfoOverlay.style.display = 'block';\n      } else {\n        playerInfoOverlay.style.display = 'none';\n      }\n    }\n    \n    function setZoom(z) {\n      currentZoom = Math.max(0.25, Math.min(5, z));\n      updateTransform();\n    }\n    \n    function updateTransform() {\n      wrapper.style.transform = 'translate(' + panX + 'px, ' + panY + 'px) scale(' + currentZoom + ') rotate(' + currentRotation + 'deg)';\n      document.getElementById('zoom-level').textContent = Math.round(currentZoom * 100) + '%';\n    }\n    \n    // Mouse wheel zoom\n    container.addEventListener('wheel', (e) => {\n      e.preventDefault();\n      const delta = e.deltaY > 0 ? -0.1 : 0.1;\n      setZoom(currentZoom + delta);\n    });\n    \n    // Pan with mouse drag on container\n    container.addEventListener('mousedown', (e) => {\n      if (e.button === 0 || e.button === 1) {\n        isDragging = true;\n        dragStartX = e.clientX - panX;\n        dragStartY = e.clientY - panY;\n        container.style.cursor = 'grabbing';\n      }\n    });\n    \n    container.addEventListener('mousemove', (e) => {\n      if (isDragging) {\n        panX = e.clientX - dragStartX;\n        panY = e.clientY - dragStartY;\n        updateTransform();\n      }\n    });\n    \n    container.addEventListener('mouseup', () => {\n      isDragging = false;\n      container.style.cursor = 'default';\n    });\n    \n    container.addEventListener('mouseleave', () => {\n      isDragging = false;\n    });\n    \n    // Fog drawing events on fog canvas (only active when fog enabled)\n    fogCanvas.addEventListener('mousedown', (e) => {\n      if (fogEnabled && e.button === 0) {\n        isDrawingFog = true;\n        revealFogAt(e);\n        e.stopPropagation(); // Don't trigger pan\n      }\n    });\n    \n    fogCanvas.addEventListener('mousemove', (e) => {\n      if (isDrawingFog) {\n        revealFogAt(e);\n      }\n    });\n    \n    fogCanvas.addEventListener('mouseup', () => {\n      isDrawingFog = false;\n    });\n    \n    fogCanvas.addEventListener('mouseleave', () => {\n      isDrawingFog = false;\n    });\n    \n    // Grid controls\n    document.getElementById('grid-toggle').addEventListener('change', (e) => {\n      gridEnabled = e.target.checked;\n      gridCanvas.style.display = gridEnabled ? 'block' : 'none';\n      if (gridEnabled) drawGrid();\n    });\n    \n    document.getElementById('grid-size').addEventListener('input', (e) => {\n      document.getElementById('grid-size-value').textContent = e.target.value + 'px';\n      if (gridEnabled) drawGrid();\n    });\n    \n    document.getElementById('grid-color').addEventListener('input', () => { if (gridEnabled) drawGrid(); });\n    document.getElementById('grid-opacity').addEventListener('input', () => { if (gridEnabled) drawGrid(); });\n    \n    function drawGrid() {\n      const size = parseInt(document.getElementById('grid-size').value);\n      const color = document.getElementById('grid-color').value;\n      const opacity = parseInt(document.getElementById('grid-opacity').value) / 100;\n      \n      // Get dimensions from active content\n      let contentW = 0, contentH = 0;\n      let displayW = 0, displayH = 0;\n      \n      if (img.style.display !== 'none' && img.src) {\n        contentW = img.naturalWidth || 800;\n        contentH = img.naturalHeight || 600;\n        displayW = img.width || img.clientWidth;\n        displayH = img.height || img.clientHeight;\n      } else if (video.style.display !== 'none' && video.src) {\n        contentW = video.videoWidth || 800;\n        contentH = video.videoHeight || 600;\n        displayW = video.width || video.clientWidth;\n        displayH = video.height || video.clientHeight;\n      } else if (htmlEl.style.display !== 'none') {\n        // For HTML content, get first image/video or use container size\n        const htmlImg = htmlEl.querySelector('img');\n        const htmlVid = htmlEl.querySelector('video');\n        if (htmlImg) {\n          contentW = htmlImg.naturalWidth || htmlImg.width || 800;\n          contentH = htmlImg.naturalHeight || htmlImg.height || 600;\n          displayW = htmlImg.width || htmlImg.clientWidth;\n          displayH = htmlImg.height || htmlImg.clientHeight;\n        } else if (htmlVid) {\n          contentW = htmlVid.videoWidth || 800;\n          contentH = htmlVid.videoHeight || 600;\n          displayW = htmlVid.width || htmlVid.clientWidth;\n          displayH = htmlVid.height || htmlVid.clientHeight;\n        } else {\n          // Fallback to viewport\n          contentW = window.innerWidth;\n          contentH = window.innerHeight;\n          displayW = window.innerWidth;\n          displayH = window.innerHeight;\n        }\n      }\n      \n      if (!contentW || !contentH) {\n        contentW = 800;\n        contentH = 600;\n      }\n      if (!displayW || !displayH) {\n        displayW = contentW;\n        displayH = contentH;\n      }\n      \n      gridCanvas.width = contentW;\n      gridCanvas.height = contentH;\n      gridCanvas.style.width = displayW + 'px';\n      gridCanvas.style.height = displayH + 'px';\n      \n      gridCtx.clearRect(0, 0, gridCanvas.width, gridCanvas.height);\n      gridCtx.strokeStyle = color;\n      gridCtx.globalAlpha = opacity;\n      gridCtx.lineWidth = 1;\n      \n      for (let x = 0; x <= gridCanvas.width; x += size) {\n        gridCtx.beginPath();\n        gridCtx.moveTo(x, 0);\n        gridCtx.lineTo(x, gridCanvas.height);\n        gridCtx.stroke();\n      }\n      \n      for (let y = 0; y <= gridCanvas.height; y += size) {\n        gridCtx.beginPath();\n        gridCtx.moveTo(0, y);\n        gridCtx.lineTo(gridCanvas.width, y);\n        gridCtx.stroke();\n      }\n    }\n    \n    // Fog of War controls\n    document.getElementById('fog-toggle').addEventListener('change', (e) => {\n      fogEnabled = e.target.checked;\n      fogCanvas.style.display = fogEnabled ? 'block' : 'none';\n      // When fog is enabled, fog canvas needs pointer events to capture drawing\n      fogCanvas.style.pointerEvents = fogEnabled ? 'auto' : 'none';\n      if (fogEnabled) initFog();\n    });\n    \n    document.getElementById('fog-size').addEventListener('input', (e) => {\n      fogRevealSize = parseInt(e.target.value);\n      document.getElementById('fog-size-value').textContent = fogRevealSize + 'px';\n    });\n    \n    document.getElementById('fog-reset').addEventListener('click', initFog);\n    document.getElementById('fog-reveal-all').addEventListener('click', () => {\n      fogCtx.clearRect(0, 0, fogCanvas.width, fogCanvas.height);\n    });\n    \n    function initFog() {\n      // Fog canvas covers the entire viewport (fixed position)\n      fogCanvas.width = window.innerWidth;\n      fogCanvas.height = window.innerHeight;\n      fogCanvas.style.width = window.innerWidth + 'px';\n      fogCanvas.style.height = window.innerHeight + 'px';\n      \n      // Simple solid dark fog - no textures to save memory\n      fogCtx.fillStyle = '#000000';\n      fogCtx.fillRect(0, 0, fogCanvas.width, fogCanvas.height);\n    }\n    \n    // Reinit fog on window resize (simplified - doesn't preserve revealed areas to save memory)\n    window.addEventListener('resize', () => {\n      if (fogEnabled) {\n        initFog();\n      }\n      if (gridEnabled) drawGrid();\n    });\n    \n    function revealFogAt(e) {\n      // Fog canvas is fixed to viewport, so use clientX/clientY directly\n      const x = e.clientX;\n      const y = e.clientY;\n      \n      // Use clearRect in a circular pattern by using clip\n      fogCtx.save();\n      fogCtx.beginPath();\n      fogCtx.arc(x, y, fogRevealSize, 0, Math.PI * 2);\n      fogCtx.clip();\n      fogCtx.clearRect(x - fogRevealSize, y - fogRevealSize, fogRevealSize * 2, fogRevealSize * 2);\n      fogCtx.restore();\n    }\n    \n    // Export\n    document.getElementById('export-btn').addEventListener('click', exportImage);\n    \n    function exportImage() {\n      const canvas = document.createElement('canvas');\n      canvas.width = img.naturalWidth || img.width;\n      canvas.height = img.naturalHeight || img.height;\n      const ctx = canvas.getContext('2d');\n      \n      ctx.drawImage(img, 0, 0);\n      if (gridEnabled) ctx.drawImage(gridCanvas, 0, 0);\n      if (fogEnabled) ctx.drawImage(fogCanvas, 0, 0);\n      \n      const link = document.createElement('a');\n      link.download = 'vtt-export-' + Date.now() + '.png';\n      link.href = canvas.toDataURL('image/png');\n      link.click();\n    }\n    \n    // Image load handler\n    img.onload = () => {\n      if (gridEnabled) drawGrid();\n      if (fogEnabled) initFog();\n      // Fit to viewport when new image loads\n      fitContentToViewport();\n    };\n    \n    // Video load handler\n    video.onloadedmetadata = () => {\n      if (gridEnabled) drawGrid();\n      if (fogEnabled) initFog();\n      fitContentToViewport();\n    };\n    \n    // Message handling from plugin\n    window.addEventListener('message', (ev) => {\n      if (!ev.data || ev.data.plugin !== 'vtt-card-display') return;\n      \n      if (ev.data.type === 'show') {\n        try { console.log('popout show', ev.data); } catch (e) {}\n        // Reset rotation for new content\n        currentRotation = 0;\n        document.getElementById('rotation-display').textContent = '0\u00B0';\n        \n        const src = ev.data.src || '';\n        const isVideo = src && (src.startsWith('data:video') || /\\\\.(mp4|webm|ogg|mov)$/i.test(src));\n        \n        // Handle videos\n        if (isVideo) {\n          img.style.display = 'none';\n          htmlEl.style.display = 'none';\n          video.style.display = 'block';\n          try { video.src = src; } catch (e) { console.error('video.src set error', e); }\n          video.load();\n          video.play().catch((err) => { try { console.error('video play error', err); } catch(e){} });\n        }\n        // Handle images - with or without 'kind' property\n        else if (ev.data.kind === 'image' || ev.data.kind === 'card' || ev.data.kind === 'map' || (!ev.data.kind && src)) {\n          video.pause();\n          video.src = '';\n          video.style.display = 'none';\n          img.style.display = 'block';\n          htmlEl.style.display = 'none';\n          try { img.src = src; } catch (e) { console.error('img.src set error', e); }\n        } else if (ev.data.kind === 'html') {\n          video.pause();\n          video.src = '';\n          video.style.display = 'none';\n          img.style.display = 'none';\n          htmlEl.style.display = 'block';\n          htmlEl.innerHTML = ev.data.html || '';\n        }\n        \n        // Handle player info content\n        if (ev.data.playerInfo) {\n          playerInfoContent = ev.data.playerInfo;\n          updatePlayerInfoOverlay();\n        } else {\n          playerInfoContent = '';\n          updatePlayerInfoOverlay();\n        }\n        \n        // attach error handlers for debug\n        img.onerror = (err) => { try { console.error('img error', err, img.src); } catch (e) {} };\n        video.onerror = (err) => { try { console.error('video error', err, video.src); } catch (e) {} };\n\n        updateTransform();\n      }\n      \n      if (ev.data.type === 'showHTML') {\n        // Reset rotation for new content\n        currentRotation = 0;\n        document.getElementById('rotation-display').textContent = '0\u00B0';\n        \n        video.pause();\n        video.src = '';\n        video.style.display = 'none';\n        img.style.display = 'none';\n        htmlEl.style.display = 'block';\n        htmlEl.innerHTML = ev.data.html || '';\n        \n        // Check if HTML contains images/videos - if so, it's a map projection\n        // Otherwise it's a statblock and should be scrollable\n        const hasMedia = htmlEl.querySelector('img, video');\n        if (hasMedia) {\n          htmlEl.classList.remove('scrollable');\n        } else {\n          htmlEl.classList.add('scrollable');\n        }\n        \n        // Handle player info for HTML content\n        if (ev.data.playerInfo) {\n          playerInfoContent = ev.data.playerInfo;\n          updatePlayerInfoOverlay();\n        }\n        \n        updateTransform();\n      }\n      \n      if (ev.data.type === 'settings') {\n        if (ev.data.gridSize) document.getElementById('grid-size').value = ev.data.gridSize;\n        if (ev.data.gridColor) document.getElementById('grid-color').value = ev.data.gridColor;\n        if (ev.data.gridOpacity) document.getElementById('grid-opacity').value = Math.round(ev.data.gridOpacity * 100);\n        if (ev.data.fogRevealSize) {\n          fogRevealSize = ev.data.fogRevealSize;\n          document.getElementById('fog-size').value = fogRevealSize;\n        }\n        if (typeof ev.data.showPlayerInfo === 'boolean') {\n          showPlayerInfo = ev.data.showPlayerInfo;\n          document.getElementById('player-info-toggle').checked = showPlayerInfo;\n          updatePlayerInfoOverlay();\n        }\n        if (gridEnabled) drawGrid();\n      }\n    });\n    \n    // Request current content\n    if (window.opener) {\n      window.opener.postMessage({ plugin: 'vtt-card-display', type: 'requestCurrent' }, '*');\n    }\n  </script>\n</body>\n</html>`;\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAcA,sBAAmJ;;;ACR5I,IAAM,mBAA6B;AAAA,EACxC,YAAY;AAAA,EACZ,gBAAgB;AAAA,EAChB,YAAY;AAAA,EACZ,WAAW;AAAA,EACX,aAAa;AAAA,EACb,cAAc;AAAA,EACd,oBAAoB;AAAA,EACpB,gBAAgB;AAAA,EAChB,WAAW,CAAC;AAAA,EACZ,gBAAgB,CAAC;AAAA,EACjB,UAAU;AAAA,EACV,WAAW;AAAA,EACX,aAAa;AAAA,EACb,eAAe;AACjB;AAGO,IAAM,mBAAmB,CAAC,QAAQ,QAAQ,SAAS,QAAQ,QAAQ,SAAS,QAAQ,SAAS,QAAQ,QAAQ,QAAQ,SAAS,QAAQ,MAAM;;;ACZnJ,eAAsB,iBACpB,OACA,aACyB;AACzB,QAAM,UAA0B,CAAC;AACjC,QAAM,cAAc,YAAY,YAAY,EAAE,MAAM,KAAK;AAEzD,MAAI;AACF,UAAM,WAAW,MAAM,SAAS;AAChC,UAAM,aAAa,SAAS;AAAA,MAAO,CAAC,MAClC,iBAAiB,KAAK,SAAO,EAAE,KAAK,YAAY,EAAE,SAAS,GAAG,CAAC;AAAA,IACjE;AAEA,eAAW,QAAQ,YAAY;AAC7B,YAAM,WAAW,KAAK,KAAK,YAAY;AACvC,YAAM,WAAW,KAAK,KAAK,YAAY;AAEvC,YAAM,aAAa,YAAY;AAAA,QAAM,UACnC,SAAS,SAAS,IAAI,KAAK,SAAS,SAAS,IAAI;AAAA,MACnD;AAEA,YAAM,cAAc,YAAY;AAAA,QAAK,UACnC,SAAS,SAAS,IAAI,KAAK,SAAS,SAAS,IAAI;AAAA,MACnD;AAEA,UAAI,YAAY;AACd,cAAM,eAAe,MAAM,gBAAgB,IAAI;AAC/C,gBAAQ,QAAQ;AAAA,UACd,KAAK;AAAA,UACL,QAAQ;AAAA,UACR,OAAO,KAAK,KAAK,QAAQ,YAAY,EAAE;AAAA,QACzC,CAAC;AAAA,MACH,WAAW,eAAe,QAAQ,SAAS,IAAI;AAC7C,cAAM,eAAe,MAAM,gBAAgB,IAAI;AAC/C,gBAAQ,KAAK;AAAA,UACX,KAAK;AAAA,UACL,QAAQ;AAAA,UACR,OAAO,KAAK,KAAK,QAAQ,YAAY,EAAE;AAAA,QACzC,CAAC;AAAA,MACH;AAEA,UAAI,QAAQ,UAAU;AAAI;AAAA,IAC5B;AAAA,EACF,SAAS,GAAG;AAAA,EAAe;AAE3B,SAAO;AACT;AAKA,eAAsB,kBAAkB,aAA8C;AACpF,QAAM,UAA0B,CAAC;AAEjC,QAAM,QAAQ;AAAA,IACZ,EAAE,MAAM,8BAA8B,MAAM,wBAAwB;AAAA,IACpE,EAAE,MAAM,kBAAkB,MAAM,WAAW;AAAA,EAC7C;AAEA,QAAM,iBAAiB;AAAA,IACrB;AAAA,IACA,YAAY,QAAQ,QAAQ,GAAG;AAAA,EACjC;AAEA,aAAW,QAAQ,OAAO;AACxB,eAAW,cAAc,gBAAgB;AACvC,UAAI;AACF,cAAM,MAAM,WAAW,KAAK,IAAI,gCAAgC,mBAAmB,UAAU,CAAC;AAC9F,cAAM,WAAW,MAAM,MAAM,GAAG;AAChC,YAAI,CAAC,SAAS;AAAI;AAElB,cAAM,OAAO,MAAM,SAAS,KAAK;AACjC,cAAM,QAAQ,KAAK,OAAO,SAAS,CAAC;AAEpC,mBAAW,UAAU,OAAO;AAC1B,cAAI,WAAW;AAAM;AACrB,gBAAM,OAAO,MAAM,MAAM;AAEzB,cAAI,KAAK,UAAU,QAAQ;AACzB,oBAAQ,KAAK;AAAA,cACX,KAAK,KAAK,SAAS;AAAA,cACnB,QAAQ,KAAK;AAAA,cACb,OAAO,KAAK,SAAS;AAAA,YACvB,CAAC;AAAA,UACH;AAAA,QACF;AACA,YAAI,QAAQ,SAAS;AAAG;AAAA,MAC1B,SAAS,GAAG;AAAA,MAA4B;AAAA,IAC1C;AAAA,EACF;AAEA,SAAO;AACT;AAKO,SAAS,gBAAgB,aAAqC;AACnE,QAAM,UAA0B,CAAC;AAEjC,QAAM,gBAA0C;AAAA,IAC9C,YAAY,CAAC,wFAAwF;AAAA,IACrG,eAAe,CAAC,yFAAyF;AAAA,IACzG,WAAW,CAAC,yFAAyF;AAAA,IACrG,UAAU,CAAC,yFAAyF;AAAA,IACpG,UAAU,CAAC,yFAAyF;AAAA,IACpG,OAAO,CAAC,yFAAyF;AAAA,IACjG,YAAY,CAAC,yFAAyF;AAAA,IACtG,UAAU,CAAC,wFAAwF;AAAA,IACnG,SAAS,CAAC,yFAAyF;AAAA,IACnG,SAAS,CAAC,yFAAyF;AAAA,IACnG,QAAQ,CAAC,wFAAwF;AAAA,IACjG,UAAU,CAAC,yFAAyF;AAAA,IACpG,SAAS,CAAC,yFAAyF;AAAA,IACnG,mBAAmB,CAAC,yFAAyF;AAAA,IAC7G,QAAQ,CAAC,yFAAyF;AAAA,IAClG,WAAW,CAAC,yFAAyF;AAAA,IACrG,YAAY,CAAC,yFAAyF;AAAA,IACtG,SAAS,CAAC,yFAAyF;AAAA,IACnG,SAAS,CAAC,yFAAyF;AAAA,IACnG,aAAa,CAAC,yFAAyF;AAAA,EACzG;AAEA,QAAM,YAAY,YAAY,YAAY;AAC1C,aAAW,CAAC,KAAK,IAAI,KAAK,OAAO,QAAQ,aAAa,GAAG;AACvD,QAAI,UAAU,SAAS,GAAG,GAAG;AAC3B,iBAAW,OAAO,MAAM;AACtB,gBAAQ,KAAK,EAAE,KAAK,QAAQ,cAAc,OAAO,YAAY,CAAC;AAAA,MAChE;AAAA,IACF;AAAA,EACF;AAEA,SAAO;AACT;AAKA,eAAsB,iBAAiB,aAA8C;AACnF,QAAM,UAA0B,CAAC;AAEjC,MAAI;AACF,UAAM,cAAc,mBAAmB,OAAO,WAAW,EAAE;AAC3D,UAAM,MAAM,gEAAgE,WAAW;AAEvF,UAAM,WAAW,MAAM,MAAM,KAAK,EAAE,SAAS,EAAE,UAAU,mBAAmB,EAAE,CAAC;AAE/E,QAAI,SAAS,IAAI;AACf,YAAM,OAAO,MAAM,SAAS,KAAK;AACjC,YAAM,WAAW,KAAK,QAAQ,CAAC;AAE/B,iBAAW,WAAW,SAAS,MAAM,GAAG,CAAC,GAAG;AAC1C,YAAI,QAAQ,OAAO,kBAAkB;AACnC,kBAAQ,KAAK;AAAA,YACX,KAAK,QAAQ,MAAM,iBAAiB,QAAQ,YAAY,SAAS;AAAA,YACjE,QAAQ;AAAA,YACR,OAAO,QAAQ,SAAS;AAAA,UAC1B,CAAC;AAAA,QACH;AAAA,MACF;AAAA,IACF;AAAA,EACF,SAAS,GAAG;AAAA,EAA4B;AAExC,SAAO;AACT;AAKA,eAAsB,iBAAiB,aAA8C;AACnF,QAAM,UAA0B,CAAC;AAEjC,MAAI;AACF,UAAM,cAAc,mBAAmB,OAAO,WAAW,UAAU;AACnE,UAAM,MAAM,2DAA2D,WAAW;AAElF,UAAM,WAAW,MAAM,MAAM,GAAG;AAChC,QAAI,SAAS,IAAI;AACf,YAAM,OAAO,MAAM,SAAS,KAAK;AACjC,YAAM,SAAS,IAAI,UAAU;AAC7B,YAAM,MAAM,OAAO,gBAAgB,MAAM,UAAU;AACnD,YAAM,QAAQ,IAAI,iBAAiB,MAAM;AAEzC,eAAS,IAAI,GAAG,IAAI,KAAK,IAAI,MAAM,QAAQ,CAAC,GAAG,KAAK;AAClD,cAAM,OAAO,MAAM,CAAC;AACpB,cAAM,QAAQ,KAAK,cAAc,OAAO,GAAG,eAAe;AAC1D,cAAM,eAAe,KAAK,qBAAqB,eAAe,EAAE,CAAC;AACjE,cAAM,iBAAiB,KAAK,qBAAqB,iBAAiB,EAAE,CAAC;AACrE,cAAM,WAAW,cAAc,aAAa,KAAK,KAAK,gBAAgB,aAAa,KAAK;AAExF,YAAI,UAAU;AACZ,kBAAQ,KAAK,EAAE,KAAK,UAAU,QAAQ,cAAc,MAAM,CAAC;AAAA,QAC7D;AAAA,MACF;AAAA,IACF;AAAA,EACF,SAAS,GAAG;AAAA,EAA4B;AAExC,SAAO;AACT;AAKA,eAAsB,aAAa,aAA8C;AAC/E,QAAM,UAA0B,CAAC;AAEjC,QAAM,aAAa;AAAA,IACjB;AAAA,IAAO;AAAA,IAAU;AAAA,IAAqB;AAAA,IACtC;AAAA,IAAsB;AAAA,EACxB;AAEA,aAAW,aAAa,YAAY;AAClC,QAAI;AACF,YAAM,cAAc,mBAAmB,WAAW;AAClD,YAAM,MAAM,4BAA4B,SAAS,kBAAkB,WAAW;AAE9E,YAAM,WAAW,MAAM,MAAM,KAAK;AAAA,QAChC,SAAS,EAAE,cAAc,6BAA6B;AAAA,MACxD,CAAC;AAED,UAAI,SAAS,IAAI;AACf,cAAM,OAAO,MAAM,SAAS,KAAK;AACjC,cAAM,QAAQ,KAAK,MAAM,YAAY,CAAC;AAEtC,mBAAW,QAAQ,OAAO;AACxB,gBAAM,WAAW,KAAK;AACtB,cAAI,WAAW;AAEf,cAAI,SAAS,OAAO,8BAA8B,KAAK,SAAS,GAAG,GAAG;AACpE,uBAAW,SAAS;AAAA,UACtB,WAAW,SAAS,OAAO,SAAS,IAAI,SAAS,WAAW,GAAG;AAC7D,uBAAW,SAAS;AAAA,UACtB,WAAW,SAAS,SAAS,SAAS,CAAC,GAAG,QAAQ,KAAK;AACrD,uBAAW,SAAS,QAAQ,OAAO,CAAC,EAAE,OAAO,IAAI,QAAQ,UAAU,GAAG;AAAA,UACxE,WAAW,SAAS,OAAO,SAAS,IAAI,SAAS,WAAW,GAAG;AAC7D,uBAAW,SAAS;AACpB,gBAAI,CAAC,SAAS,MAAM,6BAA6B,GAAG;AAClD,yBAAW,SAAS,QAAQ,aAAa,aAAa,IAAI;AAAA,YAC5D;AAAA,UACF;AAEA,cAAI,UAAU;AACZ,oBAAQ,KAAK;AAAA,cACX,KAAK;AAAA,cACL,QAAQ,YAAY,SAAS;AAAA,cAC7B,OAAO,SAAS,SAAS;AAAA,YAC3B,CAAC;AAAA,UACH;AAAA,QACF;AAAA,MACF;AAAA,IACF,SAAS,GAAG;AAAA,IAA8B;AAE1C,QAAI,QAAQ,UAAU;AAAI;AAAA,EAC5B;AAEA,SAAO;AACT;AAkHO,SAAS,mBAA8C,SAAmB;AAC/E,QAAM,OAAO,oBAAI,IAAY;AAC7B,SAAO,QAAQ,OAAO,OAAK;AACzB,QAAI,KAAK,IAAI,EAAE,GAAG;AAAG,aAAO;AAC5B,SAAK,IAAI,EAAE,GAAG;AACd,WAAO;AAAA,EACT,CAAC;AACH;;;AC3XO,SAAS,gBAAgB,UAA4B;AAC1D,QAAM,WAAW,SAAS,YAAY;AACtC,QAAM,YAAY,SAAS,aAAa;AACxC,QAAM,cAAc,SAAS,eAAe;AAC5C,QAAM,gBAAgB,SAAS,iBAAiB;AAEhD,SAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yEAwSgE,QAAQ;AAAA,yFACQ,QAAQ;AAAA;AAAA;AAAA;AAAA,uDAI1C,SAAS;AAAA,2EACW,KAAK,MAAM,cAAc,GAAG,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wEAahC,aAAa;AAAA,wFACG,aAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAqD3E,aAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;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",
  "names": ["el", "i", "url"]
}
